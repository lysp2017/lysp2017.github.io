<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lysp2017.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="高山流水">
<meta property="og:url" content="http://lysp2017.github.io/page/61/index.html">
<meta property="og:site_name" content="高山流水">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Louyan">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://lysp2017.github.io/page/61/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>高山流水</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="/custom_css_source.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">高山流水</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">但问耕耘，莫问收获</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/21/Markdownmath/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/21/Markdownmath/" class="post-title-link" itemprop="url">在Markdown中写数学公式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-21 23:54:36" itemprop="dateCreated datePublished" datetime="2018-07-21T23:54:36+08:00">2018-07-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 02:08:32" itemprop="dateModified" datetime="2022-02-14T02:08:32+08:00">2022-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">数学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="行内公式">行内公式</h2>
<p>语法是<code>$行内公式$</code>。可以让公式在文中与文字或其他东西混编，不独占一行。</p>
<ol type="1">
<li>示例
<ul>
<li><code>质能方程$E = mc^2$</code></li>
</ul></li>
<li>显示
<ul>
<li>质能方程<span class="math inline">\(E = mc^2\)</span></li>
</ul></li>
</ol>
<h2 id="独立公式">独立公式</h2>
<p>语法是<code>$$行内公式$$</code>。使公式单独占一行，不与文中其他文字等混编。</p>
<ol type="1">
<li>示例
<ul>
<li><code>质能方程$$E = mc^2$$</code></li>
</ul></li>
<li>显示
<ul>
<li>质能方程<span class="math display">\[E = mc^2\]</span></li>
</ul></li>
</ol>
<h2 id="普通公式">普通公式</h2>
<p>普通的加减乘除数学公式的输入方法与平常的书写一样。</p>
<ol type="1">
<li>示例
<ul>
<li><code>$$x = 100 * y + z - 10 / 33 + 10 % 3$$</code></li>
</ul></li>
<li>显示
<ul>
<li><span class="math display">\[x = 100 * y + z - 10 / 33 + 10 %
3\]</span></li>
</ul></li>
</ol>
<h2 id="上下标">上下标</h2>
<p>使用<code>^</code>来表示上标，<code>_</code>来表示下标，同时如果上下标的内容多于一个字符，可以使用<code>&#123;&#125;</code>来将这些内容括起来当做一个整体。</p>
<ol type="1">
<li>示例
<ul>
<li><code>$$x = a_&#123;1&#125;^n + a_&#123;2&#125;^n + a_&#123;3&#125;^n$$</code></li>
</ul></li>
<li>显示
<ul>
<li><span class="math display">\[x = a_{1}^n + a_{2}^n +
a_{3}^n\]</span></li>
</ul></li>
</ol>
<p>如果希望左右两边都能有上下标，可以使用<code>\sideset</code>语法</p>
<ol type="1">
<li>示例
<ul>
<li><code>$$\sideset&#123;^1_2&#125;&#123;^3_4&#125;A$$</code></li>
</ul></li>
<li>显示
<ul>
<li><span class="math display">\[\sideset{^1_2}{^3_4}A\]</span></li>
</ul></li>
</ol>
<h2 id="括号">括号</h2>
<p><code>()</code>，<code>[]</code>和<code>|</code>都表示它们自己，但是<code>&#123;&#125;</code>因为有特殊作用因此当需要显示大括号时一般使用<code>\lbrace \rbrace</code>来表示。</p>
<ol type="1">
<li>示例
<ul>
<li><code>$$f(x, y) = 100 * \lbrace[(x + y) * 3] - 5\rbrace$$</code></li>
</ul></li>
<li>显示
<ul>
<li><span class="math display">\[f(x, y) = 100 * \lbrace[(x + y) * 3] -
5\rbrace\]</span></li>
</ul></li>
</ol>
<h2 id="分数">分数</h2>
<p>分数使用<code>\frac&#123;分子&#125;&#123;分母&#125;</code>这样的语法，不过推荐使用<code>\cfrac</code>来代替<code>\frac</code>，显示公式不会太挤。</p>
<ol type="1">
<li>示例
<ul>
<li><code>$$\frac&#123;1&#125;&#123;3&#125; 与 \cfrac&#123;1&#125;&#123;3&#125;$$</code></li>
</ul></li>
<li>显示
<ul>
<li><span class="math display">\[\frac{1}{3} 与
\cfrac{1}{3}\]</span></li>
</ul></li>
</ol>
<h2 id="开方">开方</h2>
<p>开方使用<code>\sqrt[次数]&#123;被开方数&#125;</code>这样的语法</p>
<ol type="1">
<li>示例
<ul>
<li><code>$$\sqrt[3]&#123;X&#125;$$</code></li>
<li><code>$$\sqrt&#123;5 - x&#125;$$</code></li>
</ul></li>
<li>显示
<ul>
<li><span class="math display">\[\sqrt[3]{X}\]</span></li>
<li><span class="math display">\[\sqrt{5 - x}\]</span></li>
</ul></li>
</ol>
<h2 id="希腊字母">希腊字母</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">代码</th>
<th style="text-align: center;">大写</th>
<th style="text-align: center;">代码</th>
<th style="text-align: center;">小写</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>A</code></td>
<td style="text-align: center;"><span
class="math inline">\(A\)</span></td>
<td style="text-align: center;"><code>\alpha</code></td>
<td style="text-align: center;"><span
class="math inline">\(\alpha\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>B</code></td>
<td style="text-align: center;"><span
class="math inline">\(B\)</span></td>
<td style="text-align: center;"><code>\beta</code></td>
<td style="text-align: center;"><span
class="math inline">\(\beta\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\Gamma</code></td>
<td style="text-align: center;"><span
class="math inline">\(\Gamma\)</span></td>
<td style="text-align: center;"><code>\gamma</code></td>
<td style="text-align: center;"><span
class="math inline">\(\gamma\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\Delta</code></td>
<td style="text-align: center;"><span
class="math inline">\(\Delta\)</span></td>
<td style="text-align: center;"><code>\delta</code></td>
<td style="text-align: center;"><span
class="math inline">\(\delta\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>E</code></td>
<td style="text-align: center;"><span
class="math inline">\(E\)</span></td>
<td style="text-align: center;"><code>\epsilon</code></td>
<td style="text-align: center;"><span
class="math inline">\(\epsilon\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>Z</code></td>
<td style="text-align: center;"><span
class="math inline">\(Z\)</span></td>
<td style="text-align: center;"><code>\zeta</code></td>
<td style="text-align: center;"><span
class="math inline">\(\zeta\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>H</code></td>
<td style="text-align: center;"><span
class="math inline">\(H\)</span></td>
<td style="text-align: center;"><code>\eta</code></td>
<td style="text-align: center;"><span
class="math inline">\(\eta\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\Theta</code></td>
<td style="text-align: center;"><span
class="math inline">\(\Theta\)</span></td>
<td style="text-align: center;"><code>\theta</code></td>
<td style="text-align: center;"><span
class="math inline">\(\theta\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>I</code></td>
<td style="text-align: center;"><span
class="math inline">\(I\)</span></td>
<td style="text-align: center;"><code>\iota</code></td>
<td style="text-align: center;"><span
class="math inline">\(\iota\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>K</code></td>
<td style="text-align: center;"><span
class="math inline">\(K\)</span></td>
<td style="text-align: center;"><code>\kappa</code></td>
<td style="text-align: center;"><span
class="math inline">\(\kappa\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\Lambda</code></td>
<td style="text-align: center;"><span
class="math inline">\(\Lambda\)</span></td>
<td style="text-align: center;"><code>\lambda</code></td>
<td style="text-align: center;"><span
class="math inline">\(\lambda\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>M</code></td>
<td style="text-align: center;"><span
class="math inline">\(M\)</span></td>
<td style="text-align: center;"><code>\mu</code></td>
<td style="text-align: center;"><span
class="math inline">\(\mu\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>N</code></td>
<td style="text-align: center;"><span
class="math inline">\(N\)</span></td>
<td style="text-align: center;"><code>\nu</code></td>
<td style="text-align: center;"><span
class="math inline">\(\nu\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\Xi</code></td>
<td style="text-align: center;"><span
class="math inline">\(\Xi\)</span></td>
<td style="text-align: center;"><code>\xi</code></td>
<td style="text-align: center;"><span
class="math inline">\(\xi\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>O</code></td>
<td style="text-align: center;"><span
class="math inline">\(O\)</span></td>
<td style="text-align: center;"><code>\omicron</code></td>
<td style="text-align: center;"><span
class="math inline">\(\omicron\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\Pi</code></td>
<td style="text-align: center;"><span
class="math inline">\(\Pi\)</span></td>
<td style="text-align: center;"><code>\pi</code></td>
<td style="text-align: center;"><span
class="math inline">\(\pi\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>P</code></td>
<td style="text-align: center;"><span
class="math inline">\(P\)</span></td>
<td style="text-align: center;"><code>\rho</code></td>
<td style="text-align: center;"><span
class="math inline">\(\rho\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\Sigma</code></td>
<td style="text-align: center;"><span
class="math inline">\(\Sigma\)</span></td>
<td style="text-align: center;"><code>\sigma</code></td>
<td style="text-align: center;"><span
class="math inline">\(\sigma\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>T</code></td>
<td style="text-align: center;"><span
class="math inline">\(T\)</span></td>
<td style="text-align: center;"><code>\tau</code></td>
<td style="text-align: center;"><span
class="math inline">\(\tau\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\Upsilon</code></td>
<td style="text-align: center;"><span
class="math inline">\(\Upsilon\)</span></td>
<td style="text-align: center;"><code>\upsilon</code></td>
<td style="text-align: center;"><span
class="math inline">\(\upsilon\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\Phi</code></td>
<td style="text-align: center;"><span
class="math inline">\(\Phi\)</span></td>
<td style="text-align: center;"><code>\phi</code></td>
<td style="text-align: center;"><span
class="math inline">\(\phi\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>X</code></td>
<td style="text-align: center;"><span
class="math inline">\(X\)</span></td>
<td style="text-align: center;"><code>\chi</code></td>
<td style="text-align: center;"><span
class="math inline">\(\chi\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\Psi</code></td>
<td style="text-align: center;"><span
class="math inline">\(\Psi\)</span></td>
<td style="text-align: center;"><code>\psi</code></td>
<td style="text-align: center;"><span
class="math inline">\(\psi\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\Omega</code></td>
<td style="text-align: center;"><span
class="math inline">\(\Omega\)</span></td>
<td style="text-align: center;"><code>\omega</code></td>
<td style="text-align: center;"><span
class="math inline">\(\omega\)</span></td>
</tr>
</tbody>
</table>
<h2 id="关系运算符">关系运算符</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">代码</th>
<th style="text-align: center;">符号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>\pm</code></td>
<td style="text-align: center;"><span
class="math inline">\(\pm\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\times</code></td>
<td style="text-align: center;"><span
class="math inline">\(\times\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\div</code></td>
<td style="text-align: center;"><span
class="math inline">\(\div\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\mid</code></td>
<td style="text-align: center;"><span
class="math inline">\(\mid\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\nmid</code></td>
<td style="text-align: center;"><span
class="math inline">\(\nmid\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\cdot</code></td>
<td style="text-align: center;"><span
class="math inline">\(\cdot\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\circ</code></td>
<td style="text-align: center;"><span
class="math inline">\(\circ\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\ast</code></td>
<td style="text-align: center;"><span
class="math inline">\(\ast\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\bigodot</code></td>
<td style="text-align: center;"><span
class="math inline">\(\bigodot\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\bigotimes</code></td>
<td style="text-align: center;"><span
class="math inline">\(\bigotimes\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\bigoplus</code></td>
<td style="text-align: center;"><span
class="math inline">\(\bigoplus\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\leq</code></td>
<td style="text-align: center;"><span
class="math inline">\(\leq\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\geq</code></td>
<td style="text-align: center;"><span
class="math inline">\(\geq\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\neq</code></td>
<td style="text-align: center;"><span
class="math inline">\(\neq\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\approx</code></td>
<td style="text-align: center;"><span
class="math inline">\(\approx\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\equiv</code></td>
<td style="text-align: center;"><span
class="math inline">\(\equiv\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\sum</code></td>
<td style="text-align: center;"><span
class="math inline">\(\sum\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\prod</code></td>
<td style="text-align: center;"><span
class="math inline">\(\prod\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\coprod</code></td>
<td style="text-align: center;"><span
class="math inline">\(\coprod\)</span></td>
</tr>
</tbody>
</table>
<h2 id="集合运算符">集合运算符</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">代码</th>
<th style="text-align: center;">符号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>\emptyset</code></td>
<td style="text-align: center;"><span
class="math inline">\(\emptyset\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\in</code></td>
<td style="text-align: center;"><span
class="math inline">\(\in\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\notin</code></td>
<td style="text-align: center;"><span
class="math inline">\(\notin\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\subset</code></td>
<td style="text-align: center;"><span
class="math inline">\(\subset\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\supset</code></td>
<td style="text-align: center;"><span
class="math inline">\(\supset\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\subseteq</code></td>
<td style="text-align: center;"><span
class="math inline">\(\subseteq\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\supseteq</code></td>
<td style="text-align: center;"><span
class="math inline">\(\supseteq\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\bigcap</code></td>
<td style="text-align: center;"><span
class="math inline">\(\bigcap\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\bigcup</code></td>
<td style="text-align: center;"><span
class="math inline">\(\bigcup\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\bigvee</code></td>
<td style="text-align: center;"><span
class="math inline">\(\bigvee\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\bigwedge</code></td>
<td style="text-align: center;"><span
class="math inline">\(\bigwedge\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\biguplus</code></td>
<td style="text-align: center;"><span
class="math inline">\(\biguplus\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\bigsqcup</code></td>
<td style="text-align: center;"><span
class="math inline">\(\bigsqcup\)</span></td>
</tr>
</tbody>
</table>
<h2 id="对数运算符">对数运算符</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">代码</th>
<th style="text-align: center;">符号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>\log</code></td>
<td style="text-align: center;"><span
class="math inline">\(\log\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\lg</code></td>
<td style="text-align: center;"><span
class="math inline">\(\lg\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\ln</code></td>
<td style="text-align: center;"><span
class="math inline">\(\ln\)</span></td>
</tr>
</tbody>
</table>
<h2 id="三角运算符">三角运算符</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">代码</th>
<th style="text-align: center;">符号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>\bot</code></td>
<td style="text-align: center;"><span
class="math inline">\(\bot\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\angle</code></td>
<td style="text-align: center;"><span
class="math inline">\(\angle\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\sin</code></td>
<td style="text-align: center;"><span
class="math inline">\(\sin\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\cos</code></td>
<td style="text-align: center;"><span
class="math inline">\(\cos\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\tan</code></td>
<td style="text-align: center;"><span
class="math inline">\(\tan\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\cot</code></td>
<td style="text-align: center;"><span
class="math inline">\(\cot\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\sec</code></td>
<td style="text-align: center;"><span
class="math inline">\(\sec\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\csc</code></td>
<td style="text-align: center;"><span
class="math inline">\(\csc\)</span></td>
</tr>
</tbody>
</table>
<h2 id="微积分运算符">微积分运算符</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">代码</th>
<th style="text-align: center;">符号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>\prime</code></td>
<td style="text-align: center;"><span
class="math inline">\(\prime\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\int</code></td>
<td style="text-align: center;"><span
class="math inline">\(\int\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\iint</code></td>
<td style="text-align: center;"><span
class="math inline">\(\iint\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\iiint</code></td>
<td style="text-align: center;"><span
class="math inline">\(\iiint\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\iiiint</code></td>
<td style="text-align: center;"><span
class="math inline">\(\iiiint\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\oint</code></td>
<td style="text-align: center;"><span
class="math inline">\(\oint\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\lim</code></td>
<td style="text-align: center;"><span
class="math inline">\(\lim\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\infty</code></td>
<td style="text-align: center;"><span
class="math inline">\(\infty\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>\nabla</code></td>
<td style="text-align: center;"><span
class="math inline">\(\nabla\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>\mathrm&#123;d&#125;</code></td>
<td style="text-align: center;"><span
class="math inline">\(\mathrm{d}\)</span></td>
</tr>
</tbody>
</table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/21/mathjax/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/21/mathjax/" class="post-title-link" itemprop="url">使用mathjax引擎在Markdown中插入数学公式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-21 08:02:28" itemprop="dateCreated datePublished" datetime="2018-07-21T08:02:28+08:00">2018-07-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-28 00:50:29" itemprop="dateModified" datetime="2019-02-28T00:50:29+08:00">2019-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">数学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1.
部分参考自博客[始终]上文章：<a target="_blank" rel="noopener" href="https://liam0205.me/2015/09/09/fix-conflict-between-mathjax-and-markdown/">解决MathJax与Markdown的冲突</a><br>
2.
部分参考自博客[天空的城]上的文章：<a target="_blank" rel="noopener" href="http://shomy.top/2016/10/22/hexo-markdown-mathjax/">Hexo下mathjax的转义问题</a></p>
</blockquote>
<p><img
src="http://qiniup.louyanspine.com/2018-07-22-Tutorial%20add%20MathJax%20with%20Blogger%20-1-.png" /></p>
<h2 id="启用mathjax插件">启用Mathjax插件</h2>
<ol type="1">
<li><p>安装：<code>cd</code>进入Hexo的根目录</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-math --save</span><br></pre></td></tr></table></figure></p></li>
<li><p>配置</p>
<p>在站点配置文件<code>_config.yml</code>中加入下述代码：</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">math:</span><br><span class="line">  engine: &#x27;mathjax&#x27; # or &#x27;katex&#x27;</span><br><span class="line">  mathjax:</span><br><span class="line">    src: custom_mathjax_source</span><br><span class="line">    config:</span><br><span class="line">      # MathJax config</span><br><span class="line">  katex:</span><br><span class="line">    css: custom_css_source</span><br><span class="line">    js: custom_js_source # not used</span><br><span class="line">    config:</span><br><span class="line">      # KaTeX config</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h2 id="next如何集成mathjax">NexT如何集成mathjax？</h2>
<p>可以在<code>next</code>文件中的主题配置文件<code>_config.xml</code>下做类似如下配置后便可用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># MathJax Support</span><br><span class="line">mathjax:</span><br><span class="line">  enable: true</span><br><span class="line">  per_page: false</span><br><span class="line">  cdn: //cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML</span><br></pre></td></tr></table></figure>
<h2
id="如果框架不提供配置怎么集成mathjax">如果框架不提供配置怎么集成mathjax?</h2>
<p>只要在需要集成的页面上加载一个script即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;</span><br><span class="line">   src=&quot;http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;&gt;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="如何复制别人的mathjax代码">如何复制别人的mathjax代码？</h2>
<ol type="1">
<li><p>可以查看网页源码。</p></li>
<li><p>可以直接在公式上右键，按照如下图的操作后便可看到代码。</p>
<p><img
src="http://qiniup.louyanspine.com/2018-07-22-mathjax.jpg" /></p></li>
<li><p>在线识别手写数学公式并转换为的mathjax代码<a target="_blank" rel="noopener" href="https://webdemo.myscript.com/views/main/math.html">网站</a></p></li>
</ol>
<h2 id="mathjax与markdown的冲突">MathJax与Markdown的冲突</h2>
<p>MathJax是一个JavaScript引擎，能够将LaTeX语法书写的公式在网页上显示出来。Markdown是一种轻量级的标记语言。用Markdown书写的文章，可以用Markdown解释器处理成标准的HTML文档。因此Markdown很适合用来写博客。</p>
<p>在Markdown中，下划线<code>_</code>被保留，用作标记符号。比如<code>_Slant_</code>会生成倾斜的_Slant_。在LaTeX中，下划线<code>_</code>被用作下标记号。比如<code>x_i</code>会生成<span
class="math inline">\(x_i\)</span>。</p>
<p>由于 Markdown 在 MathJax 之前起作用，有时下标记号会被 Markdown
吃掉，变成 HTML 标记<code>&lt;i&gt;</code>而失去 LaTeX
的下标效果，造成数学公式显示不正常。</p>
<p>比如<code>This is an example: $f_i = f_&#123;i + 1&#125;$</code>里的两个下划线会被Markdown理解成倾斜的标记，显示成这样：</p>
<p><img
src="http://qiniup.louyanspine.com/2018-07-22-%E9%94%99%E8%AF%AF%E6%98%BE%E7%A4%BA.png" /></p>
<h3 id="解决方案">解决方案</h3>
<ol type="1">
<li><p>更换Hexo的markdown引擎</p>
<p>把Hexo默认的渲染markdown的引擎替换成插件pandoc<a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-renderer-pandoc">(hexo-renderer-pandoc)</a>进行渲染。但pandoc的语法与markdown有些微的差异，需要注意。</p>
<ul>
<li><p>安装<a target="_blank" rel="noopener" href="https://pandoc.org/installing.html">pandoc</a></p></li>
<li><p><code>cd</code>进入Hexo的根目录，卸载Hexo默认的markd，再安装pandoc</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall hexo-renderer-marked --save</span><br><span class="line">npm install hexo-renderer-pandoc --save</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/18/confounding-biases-estimatess/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/18/confounding-biases-estimatess/" class="post-title-link" itemprop="url">Visualizing how confounding biases estimates of population-wide (or marginal) average causal effects？？？(未完)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-18 21:46:11" itemprop="dateCreated datePublished" datetime="2018-07-18T21:46:11+08:00">2018-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-28 01:02:11" itemprop="dateModified" datetime="2019-02-28T01:02:11+08:00">2019-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%9F%E8%AE%A1%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">统计学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1. 译自Keith Goldfeld的文章Visualizing how confounding
biases estimates of population-wide (or marginal) average causal
effects</p>
</blockquote>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>
<p>当我们试图评估暴露或干预对结果的影响时，混淆因素(confounding)对我们得出正确结论的能力始终存在威胁。我的目标是考虑一下如何描述混淆的方式，使得有可能从表面上看出为什么不正确地估计干预效应(intervention
effects)可能会导致偏倚。</p>
<h3 id="混淆潜在的结果和因果效应">混淆、潜在的结果和因果效应</h3>
<p>通常，我们认为混淆因素会影响暴露和结果。如果，我们在评价暴露效果的时候，忽略混杂因素，我们可能轻易地高估或低估由于暴露所造成的效果大小。</p>
<p>如果病情较重的患者比健康的患者更有可能服用某种特定的药物，那么服用该药的患者，其相对较差的预后，可能是由于最初的健康状况而不是药物造成的。</p>
<p>一个稍微不同的混淆因素的观点与潜在结果的概念性框架相关联。如果一个个体受到特定的暴露，我们可能会观察到一个潜在的结果。我们可能会或可能不会观察到潜在的结果：这取决于实际的暴露程度。（为了简化，假定我们只对两种不同的暴露感兴趣。）</p>
<p><span class="math inline">\(Y_0\)</span>代表患者未受到暴露，<span
class="math inline">\(Y_1\)</span>代表患者受到暴露。暴露因素对个人i的因果影响(causal
effect)可以被定义为<span
class="math inline">\(Y_{1i}-Y_{0i}\)</span>。</p>
<p>如果我们有足够长的时间来观察两种状态（有或没有暴露）下，每一个研究对象的结局<span
class="math inline">\(Y\)</span>，并测量两种潜在的结局以及因果效应。对样本中所有个体进行平均，可以估计人口平均因果效应。(Think
of a crossover or N-of-1 study.)</p>
<p>不幸的是，在现实世界中，将个体暴露于多种条件下几乎是不可行的。只能设置对照组和暴露组，进行比较（除了暴露因素以外，两组其他情况都相同）。</p>
<p>我们的目标是比较对照组与暴露组的结果分布。我们经常通过查看每个分布的均值来简化这种比较。</p>
<p>平均因果效应（所有个体）可以写成<span
class="math inline">\(E(Y_{1i}-Y_{0i})\)</span>。<span
class="math inline">\(E()\)</span>是期望值或平均值。实际上，我们无法直接衡量这一点，因为每个人只能观察到一个潜在的结果。</p>
<p>我们可以使用观察到的测量值来估计无法观察的平均因果效应。 <img
src="http://qiniup.louyanspine.com/2018-07-20-%E6%B7%B7%E6%B7%86%E5%9B%A0%E7%B4%A0-%E6%9C%9F%E6%9C%9B.jpg"
alt="混淆因素-期望" /></p>
<ol type="1">
<li>因为期望是线性的。故此：E(Y<sub>1</sub>-Y<sub>0</sub>)=E(Y<sub>1</sub>)-E(Y<sub>0</sub>)</li>
<li>可以说<span class="math display">\[A_1 = 5 \]</span></li>
</ol>
<p><span class="math display">\[\frac{a}{b}\]</span></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/18/IPTW/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/18/IPTW/" class="post-title-link" itemprop="url">逆概率加权处理（未完）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-18 21:39:21" itemprop="dateCreated datePublished" datetime="2018-07-18T21:39:21+08:00">2018-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-10-29 14:47:00" itemprop="dateModified" datetime="2018-10-29T14:47:00+08:00">2018-10-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%9F%E8%AE%A1%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">统计学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1. 部分参考O'Reilly Media出版的HTML and CSS和HTML with CSS
&amp; XHTML<br> 2.
部分参考作者兼续在简书上的笔记https://www.jianshu.com/p/727dbfcef685</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/18/Rtableone/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/18/Rtableone/" class="post-title-link" itemprop="url">利用tableone包绘制研究人群基线特征表</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-18 14:28:41" itemprop="dateCreated datePublished" datetime="2018-07-18T14:28:41+08:00">2018-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-10-29 14:47:00" itemprop="dateModified" datetime="2018-10-29T14:47:00+08:00">2018-10-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>在医学研究领域，通常用Table 1来描述所研究人群的特征情况。Table
1包含连续性变量的均值、分类变量所占百分比以及p值等信息。为了创建Table
1有时可能会非常耗时。想象一下：我们有3组数据，每组数据10个变量（如年龄，性别等），需对变量计算均值（标准差）、参与人数（百分比）。这样的话我们需要在表中填充60个数据。</p>
<p><code>tableone</code>包的作者是Kazuki Yoshida和Justin
Bohn，利用这个包可以很方便的在R中创建表格。</p>
<h2 id="一创建table-1">一、创建Table 1</h2>
<h3 id="一创建并导入数据">（一）创建并导入数据</h3>
<p>本文数据是由<code>rnorm()</code>和<code>sample()</code>函数模拟产生的，从<a target="_blank" rel="noopener" href="https://datascienceplus.com/wp-content/uploads/2016/02/dt_simulated.csv">这里</a>下载。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dt <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span>file.choose<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> header<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;,&quot;</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>dt<span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line">   Age Gender Cholesterol SystolicBP  BMI Smoking Education</span><br><span class="line"><span class="number">1</span> <span class="number">67.9</span> Female       <span class="number">236.4</span>      <span class="number">129.8</span> <span class="number">26.4</span>     Yes      High</span><br><span class="line"><span class="number">2</span> <span class="number">54.8</span> Female       <span class="number">256.3</span>      <span class="number">133.4</span> <span class="number">28.4</span>      No    Medium</span><br><span class="line"><span class="number">3</span> <span class="number">68.4</span>   Male       <span class="number">198.7</span>      <span class="number">158.5</span> <span class="number">24.1</span>     Yes      High</span><br><span class="line"><span class="number">4</span> <span class="number">67.9</span>   Male       <span class="number">205.0</span>      <span class="number">136.0</span> <span class="number">19.9</span>      No       Low</span><br><span class="line"><span class="number">5</span> <span class="number">60.9</span>   Male       <span class="number">207.7</span>      <span class="number">145.4</span> <span class="number">26.7</span>      No    Medium</span><br><span class="line"><span class="number">6</span> <span class="number">44.9</span> Female       <span class="number">222.5</span>      <span class="number">130.6</span> <span class="number">30.6</span>      No       Low</span><br></pre></td></tr></table></figure>
<h3 id="二设定变量并定义分类变量">（二）设定变量并定义分类变量</h3>
<p>现在，我们使用<code>tableone包</code>来创建Table 1。</p>
<ol type="1">
<li>首先加载<code>tableone包</code>，并创建我们想要放到Table
1中的变量列表。</li>
<li>定义分类变量。</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#加载tableone包</span></span><br><span class="line">library<span class="punctuation">(</span>tableone<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建变量列表</span></span><br><span class="line">listVars <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Age&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Gender&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Cholesterol&quot;</span><span class="punctuation">,</span> <span class="string">&quot;SystolicBP&quot;</span><span class="punctuation">,</span> <span class="string">&quot;BMI&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Smoking&quot;</span><span class="punctuation">,</span> </span><br><span class="line"><span class="string">&quot;Education&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义分类变量</span></span><br><span class="line">catVars <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Gender&quot;</span><span class="punctuation">,</span><span class="string">&quot;Smoking&quot;</span><span class="punctuation">,</span><span class="string">&quot;Education&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="三总体人群表格">（三）总体人群表格</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">table1 <span class="operator">&lt;-</span> CreateTableOne<span class="punctuation">(</span>vars <span class="operator">=</span> listVars<span class="punctuation">,</span> data <span class="operator">=</span> dt<span class="punctuation">,</span> factorVars <span class="operator">=</span> catVars<span class="punctuation">)</span></span><br><span class="line">  </span><br><span class="line">                              Overall       </span><br><span class="line">     n                          <span class="number">250</span>        </span><br><span class="line">  Age <span class="punctuation">(</span>mean <span class="punctuation">(</span>sd<span class="punctuation">)</span><span class="punctuation">)</span>          <span class="number">57.50</span> <span class="punctuation">(</span><span class="number">7.85</span><span class="punctuation">)</span> </span><br><span class="line">  Gender <span class="operator">=</span> Male <span class="punctuation">(</span><span class="operator">%)          107 (42.8) </span></span><br><span class="line"><span class="operator">  Cholesterol (mean (sd)) 224.12 (24.90)</span></span><br><span class="line"><span class="operator">  SystolicBP (mean (sd))  145.51 (10.08)</span></span><br><span class="line"><span class="operator">  BMI (mean (sd))          26.79 (4.37) </span></span><br><span class="line"><span class="operator">  Smoking = Yes (%</span><span class="punctuation">)</span>           <span class="number">72</span> <span class="punctuation">(</span><span class="number">28.8</span><span class="punctuation">)</span> </span><br><span class="line">  Education <span class="punctuation">(</span>%<span class="punctuation">)</span>                         </span><br><span class="line">     High                    <span class="number">108</span> <span class="punctuation">(</span><span class="number">43.2</span><span class="punctuation">)</span> </span><br><span class="line">     Low                      <span class="number">71</span> <span class="punctuation">(</span><span class="number">28.4</span><span class="punctuation">)</span> </span><br><span class="line">     Medium                   <span class="number">71</span> <span class="punctuation">(</span><span class="number">28.4</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="四特定人群分类表格">（四）特定人群（分类）表格</h3>
<p>我们更感兴趣的是分别为男性和女性创建Table
1，并比较他们的均值和百分比。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从变量列表中移除Gender</span></span><br><span class="line">listVar <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Age&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Cholesterol&quot;</span><span class="punctuation">,</span> <span class="string">&quot;SystolicBP&quot;</span><span class="punctuation">,</span> <span class="string">&quot;BMI&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Smoking&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Education&quot;</span><span class="punctuation">)</span></span><br><span class="line">table1 <span class="operator">&lt;-</span> CreateTableOne<span class="punctuation">(</span>listVars<span class="punctuation">,</span> dt<span class="punctuation">,</span> catVars<span class="punctuation">,</span> strata <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Gender&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">                         Stratified by Gender</span><br><span class="line">                            Female         Male           p test</span><br><span class="line">  n                          <span class="number">143</span>            <span class="number">107</span>                    </span><br><span class="line">  Age <span class="punctuation">(</span>mean <span class="punctuation">(</span>sd<span class="punctuation">)</span><span class="punctuation">)</span>          <span class="number">56.94</span> <span class="punctuation">(</span><span class="number">8.05</span><span class="punctuation">)</span>   <span class="number">58.25</span> <span class="punctuation">(</span><span class="number">7.55</span><span class="punctuation">)</span>   <span class="number">0.191</span>     </span><br><span class="line">  Cholesterol <span class="punctuation">(</span>mean <span class="punctuation">(</span>sd<span class="punctuation">)</span><span class="punctuation">)</span> <span class="number">224.80</span> <span class="punctuation">(</span><span class="number">25.06</span><span class="punctuation">)</span> <span class="number">223.21</span> <span class="punctuation">(</span><span class="number">24.78</span><span class="punctuation">)</span>  <span class="number">0.620</span>     </span><br><span class="line">  SystolicBP <span class="punctuation">(</span>mean <span class="punctuation">(</span>sd<span class="punctuation">)</span><span class="punctuation">)</span>  <span class="number">144.95</span> <span class="punctuation">(</span><span class="number">10.99</span><span class="punctuation">)</span> <span class="number">146.27</span> <span class="punctuation">(</span><span class="number">8.71</span><span class="punctuation">)</span>   <span class="number">0.305</span>     </span><br><span class="line">  BMI <span class="punctuation">(</span>mean <span class="punctuation">(</span>sd<span class="punctuation">)</span><span class="punctuation">)</span>          <span class="number">26.74</span> <span class="punctuation">(</span><span class="number">4.58</span><span class="punctuation">)</span>   <span class="number">26.84</span> <span class="punctuation">(</span><span class="number">4.09</span><span class="punctuation">)</span>   <span class="number">0.859</span>     </span><br><span class="line">  Smoking <span class="operator">=</span> Yes <span class="punctuation">(</span><span class="operator">%)           37 (25.9)      35 (32.7)   0.298     </span></span><br><span class="line"><span class="operator">  Education (%</span><span class="punctuation">)</span>                                          <span class="number">0.289</span>     </span><br><span class="line">     High                     <span class="number">56</span> <span class="punctuation">(</span><span class="number">39.2</span><span class="punctuation">)</span>      <span class="number">52</span> <span class="punctuation">(</span><span class="number">48.6</span><span class="punctuation">)</span>             </span><br><span class="line">     Low                      <span class="number">45</span> <span class="punctuation">(</span><span class="number">31.5</span><span class="punctuation">)</span>      <span class="number">26</span> <span class="punctuation">(</span><span class="number">24.3</span><span class="punctuation">)</span>             </span><br><span class="line">     Medium                   <span class="number">42</span> <span class="punctuation">(</span><span class="number">29.4</span><span class="punctuation">)</span>      <span class="number">29</span> <span class="punctuation">(</span><span class="number">27.1</span><span class="punctuation">)</span> </span><br></pre></td></tr></table></figure>
<p><code>tableone包</code>还可以做更多事情。例如：计算非正态分布变量的中位数和四分位数，对不同组之间作各种假设检验的对比。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/17/propensityscoreR-JCO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/17/propensityscoreR-JCO/" class="post-title-link" itemprop="url">倾向性评分在临床研究中的应用（未完）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-17 20:47:28" itemprop="dateCreated datePublished" datetime="2018-07-17T20:47:28+08:00">2018-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-28 00:44:21" itemprop="dateModified" datetime="2019-02-28T00:44:21+08:00">2019-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%9F%E8%AE%A1%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">统计学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1. 译自Rajyaguru DJ于2018年发表在JCO上的文章：Radiofrequency
Ablation Versus Stereotactic BodyRadiotherapy for Localized
Hepatocellular Carcinoma inNonsurgically Managed Patients: Analysis of
the National Cancer Database.</p>
</blockquote>
<h2
id="射频消融与立体定向放疗对非手术治疗的局限性肝癌患者的影响国家癌症数据库分析">射频消融与立体定向放疗对非手术治疗的局限性肝癌患者的影响：国家癌症数据库分析</h2>
<h3 id="摘要">摘要</h3>
<h4 id="研究目的">研究目的</h4>
<p>对于局部肝细胞癌（HCC）的管理，目前尚缺乏指导（医生）如何选择最佳局部消融治疗的数据。由于这些治疗方式的前瞻性、可比较数据有限，因此我们的目的是通过使用国家癌症数据库比较射频消融（radiofrequency
ablation,RFA）与立体定向放射治疗（stereotactic body
radiotherapy,SBRT）的有效性(effectiveness)。</p>
<h4 id="方法">方法</h4>
<ol type="1">
<li>我们进行了一项观察性研究，以比较RFA与SBRT在非手术治疗肝癌患者(stage
I or II)中的有效性。</li>
<li>通过使用基于患者(patient-)，医疗设施(facility-)和肿瘤水平(tumor-level)特征的倾向性评分加权和倾向性评分匹配分析来比较总体生存率。</li>
<li>进行敏感性分析(A sensitivity
analysis)以评估严重的肝纤维化/肝硬化程度。</li>
<li>此外，我们进行了探索性分析(exploratory
analyses)，以确定RFA和SBRT在临床相关患者子集中的有效性。</li>
</ol>
<h4 id="结果">结果</h4>
<ol type="1">
<li>3,684例（92.6％）和296例（7.4％）非手术治疗的I期或II期HCC患者分别接受RFA或SBRT治疗。</li>
<li>在倾向性评分匹配后，RFA组的5年总体生存率为29.8％（95％CI，24.5％-35.3％），而SBRT组则为19.3％（95％CI，13.5％-25.9％），两者差异显著(P=0.001)。</li>
<li>逆概率加权分析(Inverse probability–weighted
analysis)也获得类似的结果。</li>
<li>RFA的获益在所有亚组中都是一致的，并且对严重肝纤维化/肝硬化的效果是稳健的。</li>
</ol>
<h4 id="结论">结论</h4>
<ol type="1">
<li>我们的研究表明，对于I或II期HCC的非手术治疗患者，与SBRT相比，RFA治疗可获得更高的存活率。</li>
<li>尽管我们的结果受限于回顾性研究设计相关的偏倚。但我们认为，在没有随机临床试验的情况下，在推荐局部无法切除的HCC患者进行局部消融治疗时应考虑我们的研究结果。</li>
</ol>
<h3 id="前言">前言</h3>
<ol type="1">
<li>对于局限性肝细胞癌，可以通过手术切除或肝移植实现治愈。然而，大多数患者不适合手术，而是采用局部消融治疗(local
ablative therapies)，包括射频消融（radiofrequency
ablation,RFA），微波消融(microwave
ablation)，冷冻消融(cryoablation)和立体定向放射治疗（stereotactic body
radiation therapy,SBRT）。</li>
<li>RFA广泛应用于体积较小（&lt;
3cm）的不可切除肝癌，可实现70％到90％的优良局部控制率，并且在某些情况下被认为是治愈性治疗。</li>
<li>其他介入技术，例如微波消融或联合热-经动脉化学栓塞已被用于改善局部控制率，特别是对于在3cm和5cm之间的HCC肿瘤。</li>
<li>SBRT是RFA的新兴替代方法，似乎为较小的HCC提供了类似的局部控制率。</li>
<li>尽管对SBRT的研究正在逐渐增加，但大多数SBRT的数据来自单中心，易于受到选择偏倚的影响。
此外，许多单中心的样本量相对较少，缺乏长期生存数据。</li>
<li>前瞻性随机试验对于比较RFA与SBRT治疗局部不可切除HCC的有效性是必要的。然而，目前尚无前瞻性随机试验，且进行此类试验面临许多挑战，耗时且花费较高。</li>
</ol>
<h3 id="研究方法">研究方法</h3>
<h4 id="数据来源">数据来源</h4>
<ol type="1">
<li>我们使用NCDB进行了回顾性分析，属于不受机构审查委员会监督的去标志数据(de-identified
data)。</li>
<li>NCDB是美国外科医师学会(American College of
Surgeons)癌症委员会（Commission on Cancer,CoC）和美国癌症协会(the
American Cancer Society)的联合项目。</li>
<li>NCDB包含来自美国1500多家拥有CoC认证项目的医院的数据，其中包括约70％全美所有新诊断的癌症病例，即超过2900万个独特的癌症病例。</li>
<li>根据与每个认证机构签订的协议，删除来自美国退伍军人事务部、国防部，波多黎各的设施和其他某些计划的数据。</li>
<li>我们从NCDB参与者用户文件（Participant User Files,PUF）获得数据。The
data elements are collected prospectively from cancer registries of
CoC-accredited programs by using nationally standardized data item and
coding definitions as specified in the CoC’s facility oncology registry
data standards and nationally standardized data transmission format
specifications coordinated by the North American Association of Central
Cancer Registries.</li>
<li>数据元素包括患者特征、癌症分期、肿瘤的组织学特征、首次治疗的类型和时间以及结果。</li>
<li>对于所有在5年内诊断出的符合条件的患者，合格评定(accreditation)要求每年有90％的随访率。</li>
</ol>
<h4 id="研究人群">研究人群</h4>
<ol type="1">
<li><p>从2004年至2013年间诊断为原发性HCC的119,933名男性和女性人群中共识别了47,634例临床I期（T1N0M0）或II期（T2N0M0）患者</p>
<blockquote>
<p>International Classification of Disease-Oncology-3rd Edition code
C22.0, histology codes 8170-8175</p>
</blockquote></li>
<li><p>排除接受过肺叶切除术，扩大肺叶切除术，肝切除术或肝移植的患者。</p></li>
<li><p>以RFA或SBRT作为主要治疗方式，排除接受其他形式的局部消融治疗的患者。</p></li>
<li><p>排除接受任何形式的化疗（辅助或新辅助）或化疗信息未知的患者。</p></li>
<li><p>本研究最终纳入3,980名患者。</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-17-CONSORT%20diagram.jpg"
alt="CONSORT diagram" />
<figcaption aria-hidden="true">CONSORT diagram</figcaption>
</figure></li>
</ol>
<h4 id="covariates协变量">Covariates/协变量</h4>
<blockquote>
<p>可以在NCDB PUF数据dictionary中找到所有变量的完整详细描述。</p>
</blockquote>
<ol type="1">
<li>Patient-level variables
<ul>
<li>诊断时的年龄</li>
<li>性别</li>
<li>种族</li>
<li>保险状况</li>
<li>根据患者邮政编码的家庭收入中位数</li>
<li>患者人口普查区内低于高中教育的人口百分比</li>
<li>Charlson-Deyo合并症评分(被NCDB分为0,1,≥2的得分类别)</li>
</ul></li>
<li>Facility-level variables
<ul>
<li>从患者居住区到治疗设施的距离</li>
<li>case volume in quartiles</li>
<li>地理区域</li>
<li>type of treatment facilities(由CoC accreditation
category指定，基于case volume和available services)
<ul>
<li>社区</li>
<li>综合性社区</li>
<li>学术</li>
<li>integrated network cancer program</li>
</ul></li>
</ul></li>
<li>Tumor-level variables
<ul>
<li>TNM分期</li>
<li>肿瘤大小</li>
<li>诊断年份（2004-2008 v 2009-2013）</li>
<li>甲胎蛋白</li>
<li>肿瘤分级和Ishak纤维化评分可用于接受活检以评估肿瘤的患者</li>
</ul></li>
</ol>
<h4 id="目标">目标</h4>
<ol type="1">
<li><p>本研究的主要目的是比较非手术治疗的I期或II期HCC患者的总体生存期（overall
survival,OS），同时比较接受RFA治疗的患者与接受SBRT治疗的患者的OS。 &gt;
OS的定义：从诊断日期到死亡(任何原因所导致)日期。</p></li>
<li><p>次要目标是确定RFA和SBRT在临床相关患者子集中的有效性。</p></li>
</ol>
<h4 id="统计分析">统计分析</h4>
<ol type="1">
<li>评估治疗方式与患者的特点，临床特点及和医疗设施特征之间的相关性
<ul>
<li>分类数据：Pearson卡方,Fisher’s exact test</li>
<li>计量数据：Wilcoxon rank sum test</li>
</ul></li>
<li>对于主要结果，构建了两种OS与治疗方式之间相关性的模型
<ul>
<li>a propensity score-and time-to-treatment-matched univariable Cox
proportional hazards model
/倾向性评分和治疗时间匹配的单因素Cox比例风险模型</li>
<li>an unmatched univariable analysis based on the Kaplan-Meier
estimator of inverse probability of treatment weight
(IPTW)/基于IPTW的Kaplan-Meier估计量的未匹配的单因素分析</li>
</ul></li>
<li>构建以接受SBRT为目标事件构建模型的倾向性评分模型。
<ul>
<li>通过逐步多因素logistic回归模型。</li>
<li>变量选择：先进行单因素分析，纳入所有与治疗方法显著相关的变量(a
threshold of P &lt;0.20 required for initial inclusion and P &lt;0.10
required to remain in the model)。</li>
</ul></li>
<li>在倾向性评分的基础上，计算稳定的IPTW。IPTWs were truncated at
第5和第95百分位</li>
<li>构建倾向性评分和治疗时间匹配的OS模型
<ul>
<li>通过使用a greedy, nearest neighbor matching
algorithm，接受SBRT治疗的患者与接受RFA治疗的患者，在倾向性评分和诊断到治疗的时间上，匹配为1：2。倾向性评分的最大允许差异为±2％，诊断到治疗的时间的最大允许差异为±14天。</li>
<li>计算每组的Kaplan-Meier估计量，并使用对数秩检验(log-rank
test)进行比较。</li>
</ul></li>
<li>对于OS的最终模型，计算所有患者的IPTW
Kaplan-Meier估计量，并通过对数秩检验在各组之间进行比较。</li>
<li>所有计算均使用SAS软件9.4版进行。</li>
<li>在匹配的患者组中，我们通过交互作用(interaction)和亚组分析(subgroup
analyses)评估了治疗效果的异质性(heterogeneity of treatment
effects)，探讨了年龄，性别，临床T分期，肿瘤大小，肿瘤分级，Charlson-Deyo合并症评分和设施类型的影响。</li>
<li>由于在NCDB中纤维化/肝硬化例数较少，以及纤维化/肝硬化与OS减少之间的已知关联。我们在匹配的患者组中进行了敏感性分析，以研究这种未测量的混杂因素对我们的结果的潜在影响。</li>
<li>敏感性分析的目标是探索假设的结果情景，并在其中调整观察到的治疗效果以解释潜在的未测量的混杂因素。</li>
<li>除了观察到的治疗效果外，敏感性分析还纳入了关于生存效应和未测量混杂因子的不同暴露的假设信息，以计算如果去除未测量的混杂因素将会观察到的真实治疗效果。</li>
</ol>
<h3 id="结果-1">结果</h3>
<h4 id="factors-associated-with-use-of-sbrt">Factors Associated With Use
of SBRT</h4>
<ol type="1">
<li>开始SBRT和RFA治疗的中位时间分别为72天和48天。</li>
<li>患者基线特征列于表1中。 <img
src="http://qiniup.louyanspine.com/2018-07-17-Table%201.jpg"
alt="Table 1" /> <img
src="http://qiniup.louyanspine.com/2018-07-17-Table%201c.jpg"
alt="Table 1_c" /></li>
<li>通过倾向性评分和time to
treatment进行匹配，两组患者所有的协变量均取得了足够的组间平衡（见表A1）。
<img src="http://qiniup.louyanspine.com/2018-07-17-Table%20A1.jpg"
alt="表A1" /> <img
src="http://qiniup.louyanspine.com/2018-07-17-Table%20A1c.jpg"
alt="表A1_c" /></li>
<li>接受SBRT的患者比例随时间逐渐增加，年增长率为12％（P&lt;0.001;图2），大多数患者（79.7％）接受三至五次治疗。</li>
</ol>
<h4 id="生存分析">生存分析</h4>
<h4 id="严重纤维化肝硬化的影响">严重纤维化/肝硬化的影响</h4>
<h3 id="讨论">讨论</h3>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/17/propensityscoreR/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/17/propensityscoreR/" class="post-title-link" itemprop="url">倾向性评分匹配的R语言实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-17 18:13:44" itemprop="dateCreated datePublished" datetime="2018-07-17T18:13:44+08:00">2018-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-27 23:44:15" itemprop="dateModified" datetime="2019-02-27T23:44:15+08:00">2019-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%9F%E8%AE%A1%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">统计学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1. 译自Norbert Köhler的文章How to use R for matching samples
(propensity score)</p>
</blockquote>
<p>根据维基百科，倾向性评分匹配（propensity score
matching,PSM）是一种用来评估处置效应的统计方法。</p>
<blockquote>
<p><strong>Propensity score matching (PSM)</strong> is a statistical
matching technique that attempts to estimate the effect of a treatment,
policy, or other intervention by accounting for the covariates that
predict receiving the treatment</p>
</blockquote>
<p>广义说来，倾向性评分分析假设只有当两组样本的研究对象具有相似特征时才能进行两组样本之间的无偏比较(unbiased
comparison)。因此，PSM不仅仅是随机试验的一种替代方法，它也是流行病研究中进行样本比较的重要方法之一。让我们举个例子：</p>
<blockquote>
<p>与健康相关的生活质量（Health-related quality of
life,HRQOL）被认为是癌症治疗的重要结果之一。对癌症患者而言，最常用的HRQOL测度是通过欧洲癌症研究与治疗中心(European
Organisation for Research and Treatment of
Cancer,EORTC)的调查问卷计算得出的。</p>
<p>EORTC
QLD-C30是一个由30个项目组成，包括5个功能量表，9个症状量表和一个整体生活质量量表的的问卷。所有量表都会给出一个0-100之间的得分。症状量表得分越高代表被调查人症状越重，其余两个量表得分越高代表生活质量越高。</p>
</blockquote>
<p>然而，如果没有任何参照，直接对数据进行解释是很困难的。幸运的是，<a target="_blank" rel="noopener" href="http://groups.eortc.be/qol/sites/default/files/img/slider/specimen_qlq-c30_english.pdf">EORTC
QLQ-C30问卷</a>也在一些正常人群调查中使用，我们可以对比患者的得分和正常人群的得分差异，从而判断患者的一些症状和功能障碍是否能归因于癌症（或治疗）。PSM可以通过相似年龄和相同性别等特征，将患者和一般人群进行匹配。</p>
<h3 id="生成两个随机数据框">生成两个随机数据框</h3>
<blockquote>
<p>本文用到的所有包可通过如下代码加载：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman::p_load(knitr, wakefield, MatchIt, tableone, captioner)</span><br></pre></td></tr></table></figure>
<p>由于我们不希望在博客文章中使用真实数据，因此需要生成一些模拟数据。使用<code>wakefield</code>包可以很容易地实现这个功能。</p>
<ol type="1">
<li><p>创建一个名为<code>df.patients</code>的数据框，包含250个病人的年龄和性别数据，所有病人的年龄都要在30-78岁之间，并且70%的病人被设定为男性。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">set.seed(180717)</span><br><span class="line">library(wakefield)</span><br><span class="line">df.patients &lt;- r_data_frame(n = 250, </span><br><span class="line">			age(x = 30:78, name = &#x27;Age&#x27;), </span><br><span class="line">			sex(x = c(&quot;Male&quot;, &quot;Female&quot;), </span><br><span class="line">			prob = c(0.70, 0.30), name = &quot;Sex&quot;))</span><br><span class="line">df.patients$Sample &lt;- as.factor(&#x27;Patients&#x27;)</span><br></pre></td></tr></table></figure></p></li>
<li><p><code>summary函数</code>会返回创建的数据框的基本信息。患者平均年龄为53.7岁，并且大约70%为男性(66.8%)。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">summary(df.patients)</span><br><span class="line">     </span><br><span class="line">      Age            Sex           Sample   </span><br><span class="line">Min.   :30.00   Male  :167   Patients:250  </span><br><span class="line">1st Qu.:44.00   Female: 83                 </span><br><span class="line">Median :57.00                              </span><br><span class="line">Mean   :55.24                              </span><br><span class="line">3rd Qu.:67.00                              </span><br><span class="line">Max.   :78.00 </span><br></pre></td></tr></table></figure></p></li>
<li><p>接下来，需要创建另一个名为<code>df.population</code>的数据框。我们希望这个数据集的数据和患者<code>df.patients</code>有些不同，因此正常人群的年龄区间被设定为18-80岁，并且男女各占一半。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">set.seed(180717)</span><br><span class="line"></span><br><span class="line">df.population &lt;- r_data_frame(n = 1000, age(x = 18:80, name = &#x27;Age&#x27;), </span><br><span class="line">sex(x = c(&quot;Male&quot;, &quot;Female&quot;),</span><br><span class="line">prob = c(0.50, 0.50), </span><br><span class="line">name = &quot;Sex&quot;))</span><br><span class="line"></span><br><span class="line">df.population$Sample &lt;- as.factor(&#x27;Population&#x27;)</span><br><span class="line"> </span><br><span class="line">#下方表格显示样本平均年龄为50.1岁，男女比例也大致相等。</span><br><span class="line"></span><br><span class="line">summary(df.population)</span><br><span class="line">     </span><br><span class="line">	Age           Sex             Sample    </span><br><span class="line">Min.   :18.0   Male  :489   Population:1000  </span><br><span class="line">1st Qu.:34.0   Female:511                    </span><br><span class="line">Median :51.0                                 </span><br><span class="line">Mean   :50.1                                 </span><br><span class="line">3rd Qu.:66.0                                 </span><br><span class="line">Max.   :80.0  </span><br></pre></td></tr></table></figure></p></li>
</ol>
<h3 id="合并数据框">合并数据框</h3>
<p>在匹配样本之前，我们需要把两个数据框合并。首先，生成一个新变量<code>Group</code>来代表研究对象来自哪个全体（逻辑型变量），再添加另一个变量<code>Distress</code>来表示个体的痛苦程度。<code>Distress</code>变量是利用<code>wakefield包</code>中的<code>age函数</code>创建的，可以发现，女性承受的痛苦级别更高。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mydata &lt;- rbind(df.patients, df.population)</span><br><span class="line">mydata$Group &lt;- as.logical(mydata$Sample == &#x27;Patients&#x27;)</span><br><span class="line">mydata$Distress &lt;- ifelse(mydata$Sex == &#x27;Male&#x27;, </span><br><span class="line">                age(nrow(mydata), x = 0:42, name = &#x27;Distress&#x27;),</span><br><span class="line">                age(nrow(mydata), x = 15:42, name = &#x27;Distress&#x27;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; mydata</span><br><span class="line"># A tibble: 1,250 x 5</span><br><span class="line">     Age Sex    Sample   Group Distress</span><br><span class="line">   &lt;int&gt; &lt;fct&gt;  &lt;fct&gt;    &lt;lgl&gt;    &lt;int&gt;</span><br><span class="line"> 1    76 Female Patients TRUE        39</span><br><span class="line"> 2    49 Female Patients TRUE        25</span><br><span class="line"> 3    57 Male   Patients TRUE        39</span><br><span class="line"> 4    62 Male   Patients TRUE        32</span><br><span class="line"> 5    61 Male   Patients TRUE        21</span><br><span class="line"> 6    44 Male   Patients TRUE        27</span><br><span class="line"> 7    56 Female Patients TRUE        21</span><br><span class="line"> 8    54 Female Patients TRUE        28</span><br><span class="line"> 9    49 Male   Patients TRUE        17</span><br><span class="line">10    64 Male   Patients TRUE        28</span><br><span class="line"># ... with 1,240 more rows</span><br></pre></td></tr></table></figure>
<blockquote>
<p>if..else语句的基本语法是</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(boolean_expression) &#123;</span><br><span class="line">   // statement(s) will execute if the boolean expression is true.</span><br><span class="line">&#125; else &#123;</span><br><span class="line">   // statement(s) will execute if the boolean expression is false.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们比较两组样本的年龄和性别分布时，我们可以发现明显的区别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">library(pacman)</span><br><span class="line">pacman::p_load(tableone)</span><br><span class="line">table1 &lt;- CreateTableOne(vars = c(&#x27;Age&#x27;, &#x27;Sex&#x27;, &#x27;Distress&#x27;), </span><br><span class="line">                         data = mydata, </span><br><span class="line">                         factorVars = &#x27;Sex&#x27;, </span><br><span class="line">                         strata = &#x27;Sample&#x27;)</span><br><span class="line">table1 &lt;- print(table1, </span><br><span class="line">                printToggle = FALSE, </span><br><span class="line">                noSpaces = TRUE)</span><br><span class="line"></span><br><span class="line">library(knitr)</span><br><span class="line">kable(table1[,1:3],  </span><br><span class="line">      align = &#x27;c&#x27;, </span><br><span class="line">      caption = &#x27;Table 1: Comparison of unmatched samples&#x27;)</span><br></pre></td></tr></table></figure>
<p><strong>Table 1: Comparison of unmatched samples</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Patients</th>
<th style="text-align: center;">Population</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">n</td>
<td style="text-align: center;">250</td>
<td style="text-align: center;">1000</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">Age (mean (sd))</td>
<td style="text-align: center;">55.24 (14.24)</td>
<td style="text-align: center;">50.10 (18.37)</td>
<td style="text-align: center;">&lt;0.001</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Sex = Female (%)</td>
<td style="text-align: center;">83 (33.2)</td>
<td style="text-align: center;">511 (51.1)</td>
<td style="text-align: center;">&lt;0.001</td>
</tr>
<tr class="even">
<td style="text-align: center;">Distress (mean (sd))</td>
<td style="text-align: center;">25.12 (11.58)</td>
<td style="text-align: center;">24.35 (11.34)</td>
<td style="text-align: center;">0.344</td>
</tr>
</tbody>
</table>
<h3 id="样本匹配">样本匹配</h3>
<p>现在，我们已经完成了全部的准备工作，可以开始使用<code>MatchIT包</code>中的<code>matchit函数</code>来匹配两组样本了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">library(MatchIt)</span><br><span class="line">set.seed(180717)</span><br><span class="line"></span><br><span class="line">match.it &lt;- matchit(Group ~ Age + Sex, </span><br><span class="line">data = mydata, </span><br><span class="line">method=&quot;nearest&quot;, </span><br><span class="line">ratio=1)</span><br><span class="line"></span><br><span class="line">a &lt;- summary(match.it)</span><br></pre></td></tr></table></figure>
<ol type="1">
<li>函数中<code>method=‘nearest’</code>的设定指明了使用近邻法(the
nearest neighbors method)进行匹配。</li>
<li>其他方法包括exact matching,subclassification,optimal
matching,genetic matching,ull
matching等（<code>method = c("exact", "subclass", "optimal", ""genetic", "full")</code>）。</li>
<li><code>ratio=1</code>意味着这是一一配对。在我们的例子里，对于患者组中的每一个病例，将恰好匹配正常人群样本中的一个人。</li>
<li>同时也请注意<code>Group变量</code>需要是逻辑型变量（TRUE与FALSE）。</li>
</ol>
<p>为了后续工作的便利，我们将<code>summary函数</code>的输出赋值给名为<code>a</code>的变量。在匹配完样本后，正常人群样本量减少到了和患者样本一致（n=250，详见Table
2）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kable(a$nn, digits = 2, align = &#x27;c&#x27;, caption = &#x27;Table 2: Sample sizes&#x27;)</span><br></pre></td></tr></table></figure>
<p><strong>Table 2: Sample sizes</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Control</th>
<th style="text-align: center;">Treated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">All</td>
<td style="text-align: center;">1000</td>
<td style="text-align: center;">250</td>
</tr>
<tr class="even">
<td style="text-align: center;">Matched</td>
<td style="text-align: center;">250</td>
<td style="text-align: center;">250</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Unmatched</td>
<td style="text-align: center;">750</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Discarded</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p>根据输出结果，匹配后的年龄和性别分布基本一致了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kable(a$sum.matched[c(1,2,4)], digits = 2, align = &#x27;c&#x27;, caption = &#x27;Table 3: Summary of balance for matched data&#x27;)</span><br></pre></td></tr></table></figure>
<p><strong>Table 3: Summary of balance for matched data</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Means Treated</th>
<th style="text-align: center;">Means Control</th>
<th style="text-align: center;">Mean Diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">distance</td>
<td style="text-align: center;">0.23</td>
<td style="text-align: center;">0.23</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: center;">Age</td>
<td style="text-align: center;">55.24</td>
<td style="text-align: center;">55.22</td>
<td style="text-align: center;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: center;">SexMale</td>
<td style="text-align: center;">0.67</td>
<td style="text-align: center;">0.67</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: center;">SexFemale</td>
<td style="text-align: center;">0.33</td>
<td style="text-align: center;">0.33</td>
<td style="text-align: center;">0.00</td>
</tr>
</tbody>
</table>
<p>倾向性评分的分布可以使用<code>MatchIt包</code>中的<code>plot函数</code>进行绘制。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot(match.it, type = &#x27;jitter&#x27;, interactive = FALSE)</span><br></pre></td></tr></table></figure>
<p><img
src="http://qiniup.louyanspine.com/2018-07-17-%E5%80%BE%E5%90%91%E6%80%A7%E8%AF%84%E5%88%86%E7%9A%84%E5%88%86%E5%B8%83.jpg" /></p>
<h3 id="保存匹配样本">保存匹配样本</h3>
<p>最后，匹配的样本将保存到名为<code>df.match</code>的新数据框中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 获得匹配数据集(含distance和weights列)的第1~ncol(mydata)列</span><br><span class="line"></span><br><span class="line">df.match &lt;- match.data(match.it)[1:ncol(mydata)]</span><br><span class="line"></span><br><span class="line"># rm()函数：删除变量函数</span><br><span class="line">rm(df.patients, df.population)</span><br><span class="line"></span><br><span class="line"># 我们可以对比两类人群间痛苦程度的差异是否依旧显著</span><br><span class="line">pacman::p_load(tableone)</span><br><span class="line">table4 &lt;- CreateTableOne(vars = c(&#x27;Age&#x27;, &#x27;Sex&#x27;, &#x27;Distress&#x27;), </span><br><span class="line">                         data = df.match, </span><br><span class="line">                         factorVars = &#x27;Sex&#x27;, </span><br><span class="line">                         strata = &#x27;Sample&#x27;)</span><br><span class="line"></span><br><span class="line"># printToggle：是否打印输出。如果为FALSE，则不创建输出，并返回一个矩阵。</span><br><span class="line"># noSpaces：是否删除为对齐添加的空格。如果您希望自己在其他软件中对齐数字，请使用此选项。</span><br><span class="line"></span><br><span class="line">table4 &lt;- print(table4, </span><br><span class="line">                printToggle = FALSE, </span><br><span class="line">                noSpaces = TRUE)</span><br><span class="line"></span><br><span class="line"># align/列对齐: &#x27;l&#x27; (left), &#x27;c&#x27; (center) and/or &#x27;r&#x27; (right). 默认则align = NULL, 数值列右对齐, 其他列左对齐.</span><br><span class="line"># kable函数：Create Tables In LaTeX, HTML, Markdown And ReStructuredText</span><br><span class="line"></span><br><span class="line">kable(table4[,1:3],  </span><br><span class="line">      align = &#x27;c&#x27;, </span><br><span class="line">      caption = &#x27;Table 4: Comparison of matched samples&#x27;)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Patients</th>
<th style="text-align: center;">Population</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">n</td>
<td style="text-align: center;">250</td>
<td style="text-align: center;">250</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">Age (mean (sd))</td>
<td style="text-align: center;">55.24 (14.24)</td>
<td style="text-align: center;">55.22 (14.21)</td>
<td style="text-align: center;">0.987</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Sex = Female (%)</td>
<td style="text-align: center;">83 (33.2)</td>
<td style="text-align: center;">83 (33.2)</td>
<td style="text-align: center;">1.000</td>
</tr>
<tr class="even">
<td style="text-align: center;">Distress (mean (sd))</td>
<td style="text-align: center;">25.12 (11.58)</td>
<td style="text-align: center;">22.87 (11.72)</td>
<td style="text-align: center;">0.032</td>
</tr>
</tbody>
</table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/16/PropensityScore/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/16/PropensityScore/" class="post-title-link" itemprop="url">倾向性评分（The Propensity Score）总述</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-16 20:26:22" itemprop="dateCreated datePublished" datetime="2018-07-16T20:26:22+08:00">2018-07-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-10-29 14:47:00" itemprop="dateModified" datetime="2018-10-29T14:47:00+08:00">2018-10-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%9F%E8%AE%A1%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">统计学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明：<br> 1. 部分参考自Jason S. Haukoos, MD, MSc的文章The Propensity
Score<br> 2.
部分参考孙婷，秦国友等的文章自不同混杂结构条件下各倾向性评分方法的模拟比较研究</p>
</blockquote>
<h2 id="一前言">一、前言</h2>
<p>2015年有2项发表在JAMA上的研究涉及对观察性数据(observational
data)的分析，以评估治疗对患者预后的影响。</p>
<ol type="1">
<li><p>在Rozé等人的研究中<sup>[1]</sup>，分析了一个大型观察性数据集，以评估早期超声心动图(early
echocardiography screening)筛查动脉导管未闭(patent ductus
arteriosus)与早产儿死亡率之间的关系。作者比较了847名接受了筛查的婴儿和666名未接受筛查的婴儿的死亡率。</p>
<p>两个婴儿组不太相同：筛查组的婴儿年龄更小，女婴较多，并且很少接受过皮质类固醇激素的治疗。作者使用倾向性评分匹配(propensity
score
matching)创建了来自原始队列的605个匹配的婴儿对以调整这些差异因素。</p></li>
<li><p>另一项在Huybrechts等人的研究中<sup>[2]</sup>，分析了Medicaid
Analytic
eXtract数据集，以评估妊娠期使用抗抑郁药与新生儿持续性肺动脉高压之间的关系。</p>
<p>作者纳入了3 789 330名妇女，其中128
950名在妊娠期使用过抗抑郁药。使用抗抑郁药的妇女与没有使用抗抑郁药的妇女在年龄、种族/民族、慢性病、肥胖、吸烟和health
care use方面存在差异。作者使用倾向性评分分层(propensity score
stratification)方法部分地调整了这些差异。</p></li>
</ol>
<h2 id="二使用方法">二、使用方法</h2>
<h3 id="一为什么使用倾向性方法">（一）为什么使用倾向性方法？</h3>
<p>许多因素会影响治疗方法的选择。在许多情况下，患者会接受多种治疗方法。此外，接受不同治疗方法的患者显然不能混为一谈。这通常会导致患者影响结果的特征与治疗方法之间存在相关性(correlation)或混淆(confounding)。（通常称为“confounding
by indication”）。</p>
<p>如果从常规的临床实践中获得观察性数据以比较使用不同治疗方法的患者的结局/预后，观察到的差异将是不同的患者特征和不同治疗方法的共同作用结果，难以描绘某一种治疗与另一种治疗的真实效果。</p>
<p>在观察性研究中，随机化是不可能的，因此研究者必须调整组间差异，以获得进行比较的治疗方法与感兴趣结局之间相关性的有效估计。多变量统计方法(Multivariable
statistical methods)通常用于评估这种关联，同时调整混淆。</p>
<p>倾向性评分的方法可减少评估治疗效果时的偏倚，并允许研究者在分析非随机的观察性数据时降低混淆的可能性。</p>
<h3 id="二倾向性评分的概念及其原理">（二）倾向性评分的概念及其原理</h3>
<ol type="1">
<li><p>倾向性评分是指在一定协变量条件下，一个观察对象接受某种暴露/处理因素（所研究的治疗方法）的可能性，它是一个从0到1的范围内连续分布的概率值。这种概率基于患者的特征，临床医生和临床环境。可以使用多变量统计方法（例如，logicistic回归）来估计这种概率。在这种情况下，所研究的治疗方法是因变量(dependent
variable)，而患者的特征，处方医生和临床环境则是预测因子(predictors)。</p></li>
<li><p>倾向性评分是指在给定一组协变量(<span
class="math inline">\(X_i\)</span>)的条件下，将任意一个研究对象<span
class="math inline">\(i(i=1，2，⋯，n)\)</span>分配到处理组<span
class="math inline">\((Z_i=1)\)</span>的条件概率。第<span
class="math inline">\(i\)</span>个研究对象被分配到处理组的条件概率可以表示为：<span
class="math display">\[e(X_i)=P(Z_i=1\mid{X_i})\]</span></p>
<p>其中<span
class="math inline">\(e(X_i)\)</span>被称为倾向性评分。倾向性评分相同的两个不同组别的研究对象，其拥有的多个协变量整体上分布是相同的。因此，组间协变量的不均衡性对处理效应估计的干扰被消除了。</p></li>
<li><p>倾向性评分的基本原理是用⼀个分值来替代多个协变量，均衡处理组和对照组间协变量的分布。对⾮随机化研究中的混杂因素进行类似随机化的均衡处理，减少选择偏倚。计算得出PS分值后，可采⽤匹配、回归调整、加权、分层的方法来均衡各组间协变量的差异，最终估计处理效应。</p></li>
<li><p>在生物医学研究中，倾向性评分通常用于比较治疗方法，但也可用于评估任何非随机因素（如接触毒素或病原体）与感兴趣结局之间的关系。</p></li>
</ol>
<h3 id="三倾向性评分的四种常规方法">（三）倾向性评分的四种常规方法</h3>
<h4 id="倾向性评分匹配">(1)倾向性评分匹配</h4>
<ol type="1">
<li>其通常包括2组研究对象，一组接受所研究的治疗而另一组则接受其他治疗，同时匹配具有相似或相同倾向性评分的个体。然后，直接比较接受所研究治疗的个体与接受其他治疗的个体之间的结果。</li>
<li>常用的匹配方法：
<ul>
<li>最邻近匹配(Nearest Neighbor Matching)
<ul>
<li>首先利用logistic模型计算倾向性评分值，根据分组变量将处理组与对照组区分开。</li>
<li>然后对处理组个体随机排序，从处理组中选出第一个个体，与对照组中全部个体的倾向性评分值进行比较，找出对照组中倾向性评分值相同或相近的个体进行配对，若对照组中有2个或2个以上与处理组个体倾向性评分值相同，则随机选取。</li>
<li>配对成功的个体从数据中剔除，对下一个体重复如上步骤，直到处理组个体全部完成匹配。</li>
</ul></li>
<li>卡钳匹配(caliper matching)
<ul>
<li>在最邻近匹配集的基础上根据倾向性评分值在最邻近匹配集中的分布设置不同的卡钳，删除两组倾向性评分值之差在卡钳值范围外的配对个体，得到不同精度的匹配集，然后计算协变量之间的均衡性及样本不平衡性，并将结果进行汇总。</li>
</ul></li>
<li>全局最优匹配</li>
</ul></li>
<li>使用倾向性评分匹配样本的分析结果可以接近随机对照试验的分析结果，因为考虑了数据的配对性质。</li>
</ol>
<h4 id="倾向性评分分层">(2)倾向性评分分层</h4>
<ol type="1">
<li><p>估计出每个研究对象的倾向性评分值后，根据倾向性评分值将研究对象分为若干层。</p></li>
<li><p>有文献指出，当估计线性处理效应的时候，将倾向性评分值分为五层可以消除组间近90%的混杂偏倚。经过分层后，每一层内处理组与对照组的协变量分布应该是均衡的。</p>
<blockquote>
<p>尽管增加层或组的数量可以减少偏倚的可能性，但通常使用五个层。</p>
</blockquote></li>
<li><p>分析过程中，先在每一层内估计处理效应，最后将每层的效应整合成总的处理效应。这种方法基于于这样一种观念，即每个组/层中的个体比个体更相似。因此，他们的结果可以直接比较。</p></li>
</ol>
<h4
id="使用倾向性评分进行协变量调整">(3)使用倾向性评分进行协变量调整</h4>
<p>在倾向性评分模型之后，构建单独的多变量模型，其中研究结果用作因变量(dependent
variable)，治疗组和倾向性评分用作预测变量(predictor
variables)。这允许研究者评估与所研究治疗相关的结果，同时调整接受治疗的概率，从而减少混淆。</p>
<h4
id="倾向性评分逆处理概率加权inverse-probability-of-treatment-weighting-using-the-propensity-score">(4)倾向性评分逆处理概率加权/inverse
probability of treatment weighting using the propensity score</h4>
<p>在这种情况下，倾向性评分用于计算每个个体的统计权重(statistical
weights)以创建样本，其中潜在的混杂因素的分布独立于暴露因素，允许对治疗和结果之间的关系进行无偏估计。</p>
<ol type="1">
<li><p>是边缘结构模型这类因果推断⽅法中的一种，其基本原理与传统的标准化法类似。</p></li>
<li><p>根据倾向性评分值赋予每个研究对象⼀个相应的权重，从⽽构建出⼀个虚拟的人群，在这个虚拟人群中，协变量的组间分布没有差异，因此消除了混杂因素的影响。</p></li>
<li><p>在逆处理概率加权的方法中，权重被定义为研究对象实际分组情况的概率的倒数，计算如下：
<span class="math display">\[w_i =
\cfrac{z_i}{e_i}+\cfrac{(1-z_i)}{(1-e_i)}\]</span></p>
<ul>
<li><p>若<span class="math inline">\(z_i=1\)</span>(处理组)，则<span
class="math inline">\(w_i = \cfrac{1}{e_i}\)</span></p></li>
<li><p>若<span class="math inline">\(z_i=0\)</span>(对照组)，则<span
class="math inline">\(w_i = \cfrac{1}{1-e_i}\)</span></p></li>
</ul></li>
<li><p>计算权重后，再应⽤用加权回归的⽅方法估计处理理效应。</p></li>
</ol>
<h3
id="四倾向性评分以外的替代策略以调整观察性研究中各组之间的基线差异">（四）倾向性评分以外的替代策略：以调整观察性研究中各组之间的基线差异</h3>
<ol type="1">
<li>匹配基线特征/matching on baseline characteristics</li>
<li>分层分析/stratified analyses</li>
<li>多变量统计方法/multivariable statistical methods</li>
</ol>
<p>倾向性评分方法通常比这些方法更实用或在统计上更有效，部分原因是倾向性评分方法可以限制最终分析中使用的预测变量的数量。倾向性评分方法通常允许将更多变量包括在倾向性评分模型(propensity
score
model)中，从而增加了这些方法有效调整混淆的能力，而不是直接纳入研究结果的多变量分析。</p>
<h2
id="三倾向性评分方法的局限性是什么">三、倾向性评分方法的局限性是什么？</h2>
<ol type="1">
<li>每个研究对象的倾向性评分基于能够测量的患者特征，如果无法测量的因素影响治疗选择，则可能仍存在未调整的混淆。因此，在倾向性评分模型中使用较少的变量降低了有效调整混淆的可能性。</li>
<li>虽然倾向性评分匹配可用于组合可比较的研究组，但匹配的质量取决于倾向性评分模型的质量，而倾向性评分模型的质量又取决于进行分析的数据的质量、大小以及模型的构建方式。</li>
<li>传统的建模方法（如，变量选择，交互的使用use of
interactions，回归诊断regression
diagnostics等）通常不推荐用于倾向性评分模型的构建。例如，倾向性评分模型可以纳入更多数量的预测变量。</li>
</ol>
<h2 id="四结果该如何解释">四、结果该如何解释？</h2>
<p>鉴于这些研究属于观察性研究，治疗组和未治疗组中的个体不同。为了能够准确估计治疗与结局之间的关联，研究者必须调整两组之间的差异。</p>
<p>使用倾向性评分方法时，无论是通过匹配还是分层，结果的估计偏差小于不使用此类方法的估计偏差。</p>
<p>尽管观察性数据不能像随机临床试验那样严格地建立因果关系或确定治疗效果，但如果倾向性评分方法得到适当使用且样本量足够大，这些方法可能提供治疗方法可能效果的可靠近似值。这种方法对于随机临床试验不可行或不可能进行的情况特别有价值。</p>
<h2
id="五在评估倾向性分析的结果时读者应该考虑哪些注意事项">五、在评估倾向性分析的结果时，读者应该考虑哪些注意事项？</h2>
<p>Rozé等人和Huybrechts等人的研究分别使用了倾向性评分匹配和倾向性评分分层。尽管这两种方法在平衡研究组方面比基于基线特征的简单匹配或分层更有效，但它们在最小化偏倚(minimize
bias)方面的能力各不相同。通常，倾向性评分匹配比倾向性评分分层更大程度地减少偏差。在使用倾向性评分方法后，评估各组之间的平衡对于让读者评估研究组的可比性非常重要。</p>
<p>尽管没有单一的标准方法来评估平衡，但是比较治疗组和未治疗组患者之间的特征通常始于比较汇总的统计数据（例如，平均值或比例）和观察到的特征的整体分布。</p>
<p>对于倾向性评分匹配的样本，经常使用标准化差异（standardized
differences，即差异differences/合并的标准偏差pooled standard
deviations）。尽管没有普遍接受的阈值，但小于0.1的标准化差异通常被认为是可忽略不计的。</p>
<p>评估平衡提供了一般意义，即匹配或分层的良好程度，以及结果可能有效的程度。</p>
<p>不幸的是，只能在研究中可以测量的患者特征中显示平衡。无法测量的差异仍可能存在于各组间，从而导致结果的偏倚。</p>
<h2 id="六参考文献">六、参考文献</h2>
<ol type="1">
<li>Rozé JC, Cambonie G, Marchand-Martin L, et al. Hemodynamic EPIPAGE 2
Study Group. Association between early screening for patent ductus
arteriosus and in-hospital mortality among extremely preterm infants.
JAMA. 2015; 313(24):2441–2448.</li>
<li>Huybrechts KF, Bateman BT, Palmsten K, et al. Antidepressant use
late in pregnancy and risk of persistent pulmonary hypertension of the
newborn. JAMA. 2015; 313(21):2142–2151.</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/12/evalwithScope/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/12/evalwithScope/" class="post-title-link" itemprop="url">欺骗词法作用域的两种方式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-12 19:21:15" itemprop="dateCreated datePublished" datetime="2018-07-12T19:21:15+08:00">2018-07-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-28 00:54:47" itemprop="dateModified" datetime="2019-02-28T00:54:47+08:00">2019-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">Web开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1.
部分参考作者姚屹晨在简书上的笔记https://www.jianshu.com/p/650e458bc9ce<br>
2.
部分参考作者m4jing在Github上的译文https://github.com/getify/You-Dont-Know-JS/blob/1ed-zh-CN/scope%20%26%20closures/ch2.md</p>
</blockquote>
<h2 id="一欺骗词法作用域">一、欺骗词法作用域</h2>
<h3 id="eval">eval</h3>
<ol type="1">
<li><p><code>eval</code>函数可以接收一个字符串作为参数，以动态形式插入程序的某个位置，并对其词法作用域的环境进行修改。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function foo(str,a)&#123;</span><br><span class="line">    eval(str);</span><br><span class="line">    console.log(a,b);</span><br><span class="line">&#125;</span><br><span class="line">var b = 2;</span><br><span class="line">foo(&#x27;var b = 5;&#x27;,1);</span><br><span class="line">&gt;&gt;&gt;1 5</span><br></pre></td></tr></table></figure></p></li>
<li><p>在严格模式下，<code>eval</code>函数在运行时拥有自己的词法作用域。这意味着其中的声明无法修改所在的作用域。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function foo(str,a)&#123;</span><br><span class="line">    &quot;use strict&quot;</span><br><span class="line">    eval(str);</span><br><span class="line">    console.log(a,b);</span><br><span class="line">&#125;</span><br><span class="line">var b = 2;</span><br><span class="line">foo(&#x27;var b = 5;&#x27;,1);</span><br><span class="line">&gt;&gt;&gt;1 2</span><br><span class="line"></span><br><span class="line">function foo(str,a)&#123;</span><br><span class="line">    &quot;use strict&quot;</span><br><span class="line">    eval(str);</span><br><span class="line">    console.log(a,b);</span><br><span class="line">&#125;</span><br><span class="line">foo(&#x27;var b = 5;&#x27;,1);</span><br><span class="line">&gt;&gt;&gt;Uncaught ReferenceError: b is not defined</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h3 id="with">with</h3>
<ol type="1">
<li><p><code>with</code>通常被当做重复引用同一个对象中的多个属性的快捷方式，可以不需要重复引用对象本身：</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var obj = &#123;</span><br><span class="line">    a: 1,</span><br><span class="line">    b: 2,</span><br><span class="line">    c: 3</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.a = 2;</span><br><span class="line">obj.b = 3;</span><br><span class="line">obj.c = 4;</span><br><span class="line"></span><br><span class="line">with(obj) &#123;</span><br><span class="line">    a = 3;</span><br><span class="line">    b = 4;</span><br><span class="line">    c = 5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p>实际上不仅仅是为了方便地访问对象属性：</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function foo(obj)&#123;</span><br><span class="line">    with(obj)&#123;</span><br><span class="line">        a = 2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var o1 = &#123;</span><br><span class="line">     a: 3</span><br><span class="line">&#125;;</span><br><span class="line">var o2 = &#123;</span><br><span class="line">     b: 3</span><br><span class="line">&#125;;</span><br><span class="line">foo(o1);</span><br><span class="line">o1.a;</span><br><span class="line">&gt;&gt;&gt;2</span><br><span class="line"></span><br><span class="line">foo(o2);</span><br><span class="line">o2.a;</span><br><span class="line">&gt;&gt;&gt;undefined</span><br><span class="line"></span><br><span class="line">a;</span><br><span class="line">&gt;&gt;&gt;2</span><br><span class="line">//a被泄露到全局作用域中。</span><br></pre></td></tr></table></figure>
因为，在非严格模式下，若a=2中的变量a未声明，也就是在任何作用域中都查找不到变量a，那么就会在全局作用域中创建一个变量a，并将2赋值于它。</p>
<figure>
<img src="http://qiniup.louyanspine.com/2018-07-12-foo-o1-.png"
alt="foo(o1)" />
<figcaption aria-hidden="true">foo(o1)</figcaption>
</figure>
<figure>
<img src="http://qiniup.louyanspine.com/2018-07-12-foo-o2-.png"
alt="foo(o2)" />
<figcaption aria-hidden="true">foo(o2)</figcaption>
</figure></li>
<li><p><code>with</code>语句接收一个对象，这个对象有0个或多个属性，并将这个对象视为好像它是一个完全隔离的词法作用域，因此这个对象的属性被视为在这个“作用域”中词法定义的标识符。如上图中的<code>o1 Scope</code>和<code>o2 Scope</code>。</p></li>
<li><p>尽管一个<code>with</code>块将一个对象视为一个词法作用域，但在<code>with</code>块内部的一个普通<code>var</code>声明将不会归于这个<code>with</code>块的作用域，而是归于包含它的函数作用域。</p></li>
<li><p>当我们传递对象<code>o1</code>给<code>with</code>时，<code>with</code>所声明的作用域是<code>o1</code>，而这个作用域中含有一个与<code>o1.a</code>属性同名的标识符。但当我们将<code>o2</code>对象作为作用域时，其中没有<code>a</code>标识符，因此进行了正常的<code>LHS (Left Hand Side)</code>查找，最后导致创建了一个全局变量a并赋值为2。</p></li>
</ol>
<h2 id="二性能">二、性能</h2>
<p>JavaScript引擎在编译阶段期进行许多性能优化工作。其中的一些优化原理都归结为实质上在进行词法分析时可以静态地分析代码，并提前决定所有的变量和函数声明都在什么位置，这样在执行期间就可以少花些力气来解析标识符。</p>
<p>但如果引擎在代码中找到一个<code>eval(..)</code>或<code>with</code>，它实质上就不得不假定自己知道的所有的标识符的位置可能是不合法的，因为它不可能在词法分析时就知道你将会向<code>eval(..)</code>传递什么样的代码来修改词法作用域，或者你可能会向<code>with</code>传递的对象有什么样的内容来创建一个新的将被查询的词法作用域。</p>
<p>换句话说，悲观地看，如果<code>eval(..)</code>或<code>with</code>出现，那么它将做的几乎所有的优化都会变得没有意义，所以它就会简单地根本不做任何优化。没有优化，代码就运行的更慢。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/12/ECMAScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/12/ECMAScript/" class="post-title-link" itemprop="url">JavaScript与ECMAScript的区别</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-12 14:26:01" itemprop="dateCreated datePublished" datetime="2018-07-12T14:26:01+08:00">2018-07-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-28 00:59:34" itemprop="dateModified" datetime="2019-02-28T00:59:34+08:00">2019-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">Web开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1. 参考整理自Michael Aranda的文章What’s the difference
between JavaScript and ECMAScript?</p>
</blockquote>
<h2 id="概念解释">概念解释</h2>
<h3
id="ecma-internationaleuropean-computer-manufacturers-association">Ecma
International(European Computer Manufacturers Association)</h3>
<ol type="1">
<li><p>一个为科学技术制定标准的组织。</p></li>
<li><p>为了要举一个“标准”的例子，可以用我们曾用过的键盘来说明。是不是大多数的字母以同样的顺序排列，有一个空格键、一个输入键、箭头键，并将数字显示在最上面的一行?这是由于大多数键盘制造商的键盘设计是基于<code>QWERTY</code>布局标准的。</p></li>
<li><p>ECMA-262：由Ecma
International发布的标准。它包含通用目的的脚本语言的规范。</p>
<figure>
<img src="http://qiniup.louyanspine.com/2018-07-12-ECMA-262.png"
alt="ECMA-262" />
<figcaption aria-hidden="true">ECMA-262</figcaption>
</figure>
<ul>
<li><p><code>ECMA-262</code>是一个类似<code>QWERTY</code>的标准，但不同于呈现一个键盘层的规范，它呈现了被称为<code>ECMAScript</code>的脚本语言规范。</p></li>
<li><p>可以把<code>ECMA-262</code>当做<code>ECMAScript</code>参考数字</p></li>
</ul>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-12-%E5%8F%AF%E4%BB%A5%E6%8A%8AECMA-262%20%E5%BD%93%E5%81%9AECMAScript%E7%9A%84%E5%8F%82%E8%80%83%E6%95%B0%E5%AD%97.png"
alt="可以把ECMA-262 当做ECMAScript的参考数字" />
<figcaption aria-hidden="true">可以把ECMA-262
当做ECMAScript的参考数字</figcaption>
</figure></li>
</ol>
<h3 id="脚本语言a-scripting-language">脚本语言(A scripting
language)</h3>
<p>A programming language designed specifically for acting on an
existing entity or system</p>
<p>什么样的编程语言是脚本语言？请思考下命令“walk”、“run” 和
“jump”。这些操作需要一些东西来执行，可能是一个人、一条狗或一个视频游戏角色。如果没有东西来执行这些命令，“walk”、“run”
和 “jump”
是没有意义的。这组操作类似于脚本语言，即专注于操纵外部实体。</p>
<h3
id="ecmascriptecmascript规范ecmascript-specification">ECMAScript/ECMAScript规范(ECMAScript
specification)</h3>
<p>ECMA-262中定义的标准，是用于创建通用目的脚本语言。ECMA-262是标准的名称，它代表了脚本语言规范ECMAScript。</p>
<p>ECMAScript提供脚本语言必须遵守的规则、细节和准则，这些才是其被视为兼容ECMAScript的判断标准。</p>
<h3 id="javascript">JavaScript</h3>
<p>一种通用目的的脚本语言，遵循<code>ECMAScript</code>规范。它是<code>ECMAScript</code>语言的一个分支版本。</p>
<p>通过阅读<code>ECMAScript</code>规范，你将学会如何创建脚本语言。通过阅读
JavaScript文档，你将学习如何使用脚本语言。</p>
<p>当人们把JavaScript称为“ECMAScript语言的方言”的时候，他们的意思就像谈论英语、法语或者中国方言时一样。一种方言从其母语中衍生出大部分的词汇和语法，但偏离得值得保留这些差异。</p>
<p>JavaScript实现了多数ECMA-262中描述的<code>ECMAScript</code>规范，但存在少数差异。
Mozilla在此概述了JavaScript的非ECMAScript语言功能：</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-12-JavaScript%E7%9A%84%E9%9D%9EECMAScript%E8%AF%AD%E8%A8%80%E5%8A%9F%E8%83%BD.png"
alt="JavaScript的非ECMAScript语言功能" />
<figcaption
aria-hidden="true">JavaScript的非ECMAScript语言功能</figcaption>
</figure>
<h3
id="javascript引擎a-javascript-enginejavascript-interpreter解释器javascript-implementation实现">JavaScript引擎(A
JavaScript engine)/JavaScript interpreter解释器/JavaScript
implementation实现</h3>
<p>能够理解和执行JavaScript代码的程序或解释器。</p>
<p>JavaScript引擎通常可以在Web浏览器中被发现，包括Chrome中的
<code>V8</code>，火狐中的<code>SpiderMonkey</code>，以及Edge中的<code>Chakra</code>。每款引擎就像是一个用于其应用程序的语言模块，可以让其支持某种JavaScript语言的分支。</p>
<p>JavaScript引擎对于浏览器来说就像是人类对语言的理解一样。如果我们重新拿我们日常行为中的“走”、“跑”、“跳”来举例的话，一个
JavaScript引擎是真正能够理解这些动作是何意义的根本机制。</p>
<h3 id="浏览器性能的差异">浏览器性能的差异</h3>
<p>两个人也许会识别“跳”的命令，但是一个人由于理解和对命令的处理比另一个人更快些，也许会比另一个人对命令的反应更快些。类似的是，两个浏览器都可以理解JavaScript代码，但是一个由于其JavaScript引擎实现起来效率更高而运行得更快。</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-12-%E6%B5%8F%E8%A7%88%E5%99%A8.png"
alt="浏览器" />
<figcaption aria-hidden="true">浏览器</figcaption>
</figure>
<h3 id="浏览器支持browser-support的差异">浏览器支持(browser
support)的差异</h3>
<p>再以即使说同样语言的人们之间也会有差异为例。即使许多人讲英语，但是一些人也许懂得他人不懂的某些词、表达式和与语法规则，反之亦然。浏览器也是同样的道理。尽管浏览器的
JavaScript 引擎都理解 JavaScript ，但是某些浏览器会比其他的浏览器对
JavaScript 理解得更好些。在浏览器对 JavaScript
的支持中就存在着这一的差别。</p>
<p>至于说到浏览器支持，人们通常会谈到 “ECMAScript 兼容性(compatibility)”
而非“ JavaScript 兼容性”，尽管 JavaScript 引擎解析和执行的是 JavaScript
。这个问题说起来有点绕，下面的表格可以对其作出解释。</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-12-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%94%AF%E6%8C%81%E7%9A%84%E5%B7%AE%E5%BC%82.png"
alt="浏览器支持(browser support)的差异" />
<figcaption aria-hidden="true">浏览器支持(browser
support)的差异</figcaption>
</figure>
<p>如果你还记得的话，ECMAScript
是一份规定了脚本语言可以看起来像什么的规范。发布一个新的 ECMAScript
版本并不意味着所有现存的 JavaScript
引擎突然就拥有了这些新功能。这取决于负责那款 JavaScript
引擎的团体或组织是否要更新到最新的 ECMAScript
规范并采用其所带来的变化。</p>
<p>因此，开发者倾向于问这样的问题，“这款浏览器支持哪个版本的 ECMAScript
?”或者“这款浏览器支持哪些 ECMAScript 功能?”他们想知道是否
Google、Mozilla 和微软已经开始更新他们浏览器的 JavaScript 引擎了，例如
V8、SpiderMonkey 和 Chakra 是否都已经具有最新的 ECMAScript
中的功能了。</p>
<p><a ref="http://kangax.github.io/compat-table/es6/">ECMASCript
兼容性列表</a>是回答这类问题的绝佳答案参考。</p>
<p>如果新版的 ECMAScript 发布了，JavaScript
引擎不会一下子整合所有的更新。他们会逐渐地加入 ECMAScript
功能，这一点从火狐的 JavaScript 变更记录中可见一斑：</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-12-Firefox%E2%80%99s%20JavaScript%20changelog.png"
alt="Firefox’s JavaScript changelog" />
<figcaption aria-hidden="true">Firefox’s JavaScript
changelog</figcaption>
</figure>
<h3
id="javascript运行时a-javascript-runtime宿主环境host-environment">JavaScript运行时(A
JavaScript runtime)/宿主环境(Host environment)</h3>
<p>The environment in which the JavaScript code runs and is interpreted
by a JavaScript engine.The runtime provides the host objects that
JavaScript can operate on and work with.</p>
<p>The JavaScript runtime is the “existing entity or system” mentioned
in the scripting language definition. Code passes through the JavaScript
engine, and once parsed and understood, an entity or system performs the
interpreted actions. A dog walks, a person runs, a video game character
jumps (or in the case of the above image, wrecks).</p>
<p>Applications make themselves available to JavaScript scripting by
providing “host objects” at runtime. For the client side, the JavaScript
runtime would be the web browser, where host objects like windows and
HTML documents are made available for manipulation. Have you ever worked
with the window or document host objects? The window and document
objects are not actually a part of the core JavaScript language. They
are Web APIs, objects provided by a browser acting as JavaScript’s host
environment. For the server side, the JavaScript runtime is Node.js.
Server-related host objects such as the file system, processes, and
requests are provided in Node.js.</p>
<p>n interesting point: different JavaScript runtimes can share the same
JavaScript engine. V8, for example, is the JavaScript engine used in
both Google Chrome and Node.js — two very different environments.</p>
<h3 id="ecmascript-6">ECMAScript 6</h3>
<ol type="1">
<li>它是 ECMA-262 标准的第六个版本，其特点是对 ECMAScript
规范有着显著的变化和改进。</li>
<li>同义词：ES6、ES2015 和 ECMAScript 2015</li>
<li>这一版的 ECMAScript 将其名字由 ES6 改为了 ES2015 ，这是由于 Ecma
国际决定每年都对 ECMAScript 发布一次。相应地，Ecma
国际也开始基于每年所发布的来命名新版本的 ECMAScript 规范。简而言之， ES6
和 ES2015 是对同一件事情的两个不同的名字。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/60/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/60/">60</a><span class="page-number current">61</span><a class="page-number" href="/page/62/">62</a><span class="space">&hellip;</span><a class="page-number" href="/page/64/">64</a><a class="extend next" rel="next" href="/page/62/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Louyan</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">638</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2766</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Louyan</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lysp2017.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="高山流水">
<meta property="og:url" content="http://lysp2017.github.io/page/60/index.html">
<meta property="og:site_name" content="高山流水">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Louyan">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://lysp2017.github.io/page/60/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>高山流水</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="/custom_css_source.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">高山流水</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">但问耕耘，莫问收获</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/18/IPTW/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/18/IPTW/" class="post-title-link" itemprop="url">逆概率加权处理（未完）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-18 21:39:21" itemprop="dateCreated datePublished" datetime="2018-07-18T21:39:21+08:00">2018-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-10-29 14:47:00" itemprop="dateModified" datetime="2018-10-29T14:47:00+08:00">2018-10-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%9F%E8%AE%A1%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">统计学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1. 部分参考O'Reilly Media出版的HTML and CSS和HTML with CSS
&amp; XHTML<br> 2.
部分参考作者兼续在简书上的笔记https://www.jianshu.com/p/727dbfcef685</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/18/Rtableone/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/18/Rtableone/" class="post-title-link" itemprop="url">利用tableone包绘制研究人群基线特征表</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-18 14:28:41" itemprop="dateCreated datePublished" datetime="2018-07-18T14:28:41+08:00">2018-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-10-29 14:47:00" itemprop="dateModified" datetime="2018-10-29T14:47:00+08:00">2018-10-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>在医学研究领域，通常用Table 1来描述所研究人群的特征情况。Table
1包含连续性变量的均值、分类变量所占百分比以及p值等信息。为了创建Table
1有时可能会非常耗时。想象一下：我们有3组数据，每组数据10个变量（如年龄，性别等），需对变量计算均值（标准差）、参与人数（百分比）。这样的话我们需要在表中填充60个数据。</p>
<p><code>tableone</code>包的作者是Kazuki Yoshida和Justin
Bohn，利用这个包可以很方便的在R中创建表格。</p>
<h2 id="一创建table-1">一、创建Table 1</h2>
<h3 id="一创建并导入数据">（一）创建并导入数据</h3>
<p>本文数据是由<code>rnorm()</code>和<code>sample()</code>函数模拟产生的，从<a target="_blank" rel="noopener" href="https://datascienceplus.com/wp-content/uploads/2016/02/dt_simulated.csv">这里</a>下载。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dt <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span>file.choose<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> header<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;,&quot;</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>dt<span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line">   Age Gender Cholesterol SystolicBP  BMI Smoking Education</span><br><span class="line"><span class="number">1</span> <span class="number">67.9</span> Female       <span class="number">236.4</span>      <span class="number">129.8</span> <span class="number">26.4</span>     Yes      High</span><br><span class="line"><span class="number">2</span> <span class="number">54.8</span> Female       <span class="number">256.3</span>      <span class="number">133.4</span> <span class="number">28.4</span>      No    Medium</span><br><span class="line"><span class="number">3</span> <span class="number">68.4</span>   Male       <span class="number">198.7</span>      <span class="number">158.5</span> <span class="number">24.1</span>     Yes      High</span><br><span class="line"><span class="number">4</span> <span class="number">67.9</span>   Male       <span class="number">205.0</span>      <span class="number">136.0</span> <span class="number">19.9</span>      No       Low</span><br><span class="line"><span class="number">5</span> <span class="number">60.9</span>   Male       <span class="number">207.7</span>      <span class="number">145.4</span> <span class="number">26.7</span>      No    Medium</span><br><span class="line"><span class="number">6</span> <span class="number">44.9</span> Female       <span class="number">222.5</span>      <span class="number">130.6</span> <span class="number">30.6</span>      No       Low</span><br></pre></td></tr></table></figure>
<h3 id="二设定变量并定义分类变量">（二）设定变量并定义分类变量</h3>
<p>现在，我们使用<code>tableone包</code>来创建Table 1。</p>
<ol type="1">
<li>首先加载<code>tableone包</code>，并创建我们想要放到Table
1中的变量列表。</li>
<li>定义分类变量。</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#加载tableone包</span></span><br><span class="line">library<span class="punctuation">(</span>tableone<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建变量列表</span></span><br><span class="line">listVars <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Age&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Gender&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Cholesterol&quot;</span><span class="punctuation">,</span> <span class="string">&quot;SystolicBP&quot;</span><span class="punctuation">,</span> <span class="string">&quot;BMI&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Smoking&quot;</span><span class="punctuation">,</span> </span><br><span class="line"><span class="string">&quot;Education&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义分类变量</span></span><br><span class="line">catVars <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Gender&quot;</span><span class="punctuation">,</span><span class="string">&quot;Smoking&quot;</span><span class="punctuation">,</span><span class="string">&quot;Education&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="三总体人群表格">（三）总体人群表格</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">table1 <span class="operator">&lt;-</span> CreateTableOne<span class="punctuation">(</span>vars <span class="operator">=</span> listVars<span class="punctuation">,</span> data <span class="operator">=</span> dt<span class="punctuation">,</span> factorVars <span class="operator">=</span> catVars<span class="punctuation">)</span></span><br><span class="line">  </span><br><span class="line">                              Overall       </span><br><span class="line">     n                          <span class="number">250</span>        </span><br><span class="line">  Age <span class="punctuation">(</span>mean <span class="punctuation">(</span>sd<span class="punctuation">)</span><span class="punctuation">)</span>          <span class="number">57.50</span> <span class="punctuation">(</span><span class="number">7.85</span><span class="punctuation">)</span> </span><br><span class="line">  Gender <span class="operator">=</span> Male <span class="punctuation">(</span><span class="operator">%)          107 (42.8) </span></span><br><span class="line"><span class="operator">  Cholesterol (mean (sd)) 224.12 (24.90)</span></span><br><span class="line"><span class="operator">  SystolicBP (mean (sd))  145.51 (10.08)</span></span><br><span class="line"><span class="operator">  BMI (mean (sd))          26.79 (4.37) </span></span><br><span class="line"><span class="operator">  Smoking = Yes (%</span><span class="punctuation">)</span>           <span class="number">72</span> <span class="punctuation">(</span><span class="number">28.8</span><span class="punctuation">)</span> </span><br><span class="line">  Education <span class="punctuation">(</span>%<span class="punctuation">)</span>                         </span><br><span class="line">     High                    <span class="number">108</span> <span class="punctuation">(</span><span class="number">43.2</span><span class="punctuation">)</span> </span><br><span class="line">     Low                      <span class="number">71</span> <span class="punctuation">(</span><span class="number">28.4</span><span class="punctuation">)</span> </span><br><span class="line">     Medium                   <span class="number">71</span> <span class="punctuation">(</span><span class="number">28.4</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="四特定人群分类表格">（四）特定人群（分类）表格</h3>
<p>我们更感兴趣的是分别为男性和女性创建Table
1，并比较他们的均值和百分比。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从变量列表中移除Gender</span></span><br><span class="line">listVar <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Age&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Cholesterol&quot;</span><span class="punctuation">,</span> <span class="string">&quot;SystolicBP&quot;</span><span class="punctuation">,</span> <span class="string">&quot;BMI&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Smoking&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Education&quot;</span><span class="punctuation">)</span></span><br><span class="line">table1 <span class="operator">&lt;-</span> CreateTableOne<span class="punctuation">(</span>listVars<span class="punctuation">,</span> dt<span class="punctuation">,</span> catVars<span class="punctuation">,</span> strata <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Gender&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">                         Stratified by Gender</span><br><span class="line">                            Female         Male           p test</span><br><span class="line">  n                          <span class="number">143</span>            <span class="number">107</span>                    </span><br><span class="line">  Age <span class="punctuation">(</span>mean <span class="punctuation">(</span>sd<span class="punctuation">)</span><span class="punctuation">)</span>          <span class="number">56.94</span> <span class="punctuation">(</span><span class="number">8.05</span><span class="punctuation">)</span>   <span class="number">58.25</span> <span class="punctuation">(</span><span class="number">7.55</span><span class="punctuation">)</span>   <span class="number">0.191</span>     </span><br><span class="line">  Cholesterol <span class="punctuation">(</span>mean <span class="punctuation">(</span>sd<span class="punctuation">)</span><span class="punctuation">)</span> <span class="number">224.80</span> <span class="punctuation">(</span><span class="number">25.06</span><span class="punctuation">)</span> <span class="number">223.21</span> <span class="punctuation">(</span><span class="number">24.78</span><span class="punctuation">)</span>  <span class="number">0.620</span>     </span><br><span class="line">  SystolicBP <span class="punctuation">(</span>mean <span class="punctuation">(</span>sd<span class="punctuation">)</span><span class="punctuation">)</span>  <span class="number">144.95</span> <span class="punctuation">(</span><span class="number">10.99</span><span class="punctuation">)</span> <span class="number">146.27</span> <span class="punctuation">(</span><span class="number">8.71</span><span class="punctuation">)</span>   <span class="number">0.305</span>     </span><br><span class="line">  BMI <span class="punctuation">(</span>mean <span class="punctuation">(</span>sd<span class="punctuation">)</span><span class="punctuation">)</span>          <span class="number">26.74</span> <span class="punctuation">(</span><span class="number">4.58</span><span class="punctuation">)</span>   <span class="number">26.84</span> <span class="punctuation">(</span><span class="number">4.09</span><span class="punctuation">)</span>   <span class="number">0.859</span>     </span><br><span class="line">  Smoking <span class="operator">=</span> Yes <span class="punctuation">(</span><span class="operator">%)           37 (25.9)      35 (32.7)   0.298     </span></span><br><span class="line"><span class="operator">  Education (%</span><span class="punctuation">)</span>                                          <span class="number">0.289</span>     </span><br><span class="line">     High                     <span class="number">56</span> <span class="punctuation">(</span><span class="number">39.2</span><span class="punctuation">)</span>      <span class="number">52</span> <span class="punctuation">(</span><span class="number">48.6</span><span class="punctuation">)</span>             </span><br><span class="line">     Low                      <span class="number">45</span> <span class="punctuation">(</span><span class="number">31.5</span><span class="punctuation">)</span>      <span class="number">26</span> <span class="punctuation">(</span><span class="number">24.3</span><span class="punctuation">)</span>             </span><br><span class="line">     Medium                   <span class="number">42</span> <span class="punctuation">(</span><span class="number">29.4</span><span class="punctuation">)</span>      <span class="number">29</span> <span class="punctuation">(</span><span class="number">27.1</span><span class="punctuation">)</span> </span><br></pre></td></tr></table></figure>
<p><code>tableone包</code>还可以做更多事情。例如：计算非正态分布变量的中位数和四分位数，对不同组之间作各种假设检验的对比。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/17/propensityscoreR-JCO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/17/propensityscoreR-JCO/" class="post-title-link" itemprop="url">倾向性评分在临床研究中的应用（未完）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-17 20:47:28" itemprop="dateCreated datePublished" datetime="2018-07-17T20:47:28+08:00">2018-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-28 00:44:21" itemprop="dateModified" datetime="2019-02-28T00:44:21+08:00">2019-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%9F%E8%AE%A1%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">统计学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1. 译自Rajyaguru DJ于2018年发表在JCO上的文章：Radiofrequency
Ablation Versus Stereotactic BodyRadiotherapy for Localized
Hepatocellular Carcinoma inNonsurgically Managed Patients: Analysis of
the National Cancer Database.</p>
</blockquote>
<h2
id="射频消融与立体定向放疗对非手术治疗的局限性肝癌患者的影响国家癌症数据库分析">射频消融与立体定向放疗对非手术治疗的局限性肝癌患者的影响：国家癌症数据库分析</h2>
<h3 id="摘要">摘要</h3>
<h4 id="研究目的">研究目的</h4>
<p>对于局部肝细胞癌（HCC）的管理，目前尚缺乏指导（医生）如何选择最佳局部消融治疗的数据。由于这些治疗方式的前瞻性、可比较数据有限，因此我们的目的是通过使用国家癌症数据库比较射频消融（radiofrequency
ablation,RFA）与立体定向放射治疗（stereotactic body
radiotherapy,SBRT）的有效性(effectiveness)。</p>
<h4 id="方法">方法</h4>
<ol type="1">
<li>我们进行了一项观察性研究，以比较RFA与SBRT在非手术治疗肝癌患者(stage
I or II)中的有效性。</li>
<li>通过使用基于患者(patient-)，医疗设施(facility-)和肿瘤水平(tumor-level)特征的倾向性评分加权和倾向性评分匹配分析来比较总体生存率。</li>
<li>进行敏感性分析(A sensitivity
analysis)以评估严重的肝纤维化/肝硬化程度。</li>
<li>此外，我们进行了探索性分析(exploratory
analyses)，以确定RFA和SBRT在临床相关患者子集中的有效性。</li>
</ol>
<h4 id="结果">结果</h4>
<ol type="1">
<li>3,684例（92.6％）和296例（7.4％）非手术治疗的I期或II期HCC患者分别接受RFA或SBRT治疗。</li>
<li>在倾向性评分匹配后，RFA组的5年总体生存率为29.8％（95％CI，24.5％-35.3％），而SBRT组则为19.3％（95％CI，13.5％-25.9％），两者差异显著(P=0.001)。</li>
<li>逆概率加权分析(Inverse probability–weighted
analysis)也获得类似的结果。</li>
<li>RFA的获益在所有亚组中都是一致的，并且对严重肝纤维化/肝硬化的效果是稳健的。</li>
</ol>
<h4 id="结论">结论</h4>
<ol type="1">
<li>我们的研究表明，对于I或II期HCC的非手术治疗患者，与SBRT相比，RFA治疗可获得更高的存活率。</li>
<li>尽管我们的结果受限于回顾性研究设计相关的偏倚。但我们认为，在没有随机临床试验的情况下，在推荐局部无法切除的HCC患者进行局部消融治疗时应考虑我们的研究结果。</li>
</ol>
<h3 id="前言">前言</h3>
<ol type="1">
<li>对于局限性肝细胞癌，可以通过手术切除或肝移植实现治愈。然而，大多数患者不适合手术，而是采用局部消融治疗(local
ablative therapies)，包括射频消融（radiofrequency
ablation,RFA），微波消融(microwave
ablation)，冷冻消融(cryoablation)和立体定向放射治疗（stereotactic body
radiation therapy,SBRT）。</li>
<li>RFA广泛应用于体积较小（&lt;
3cm）的不可切除肝癌，可实现70％到90％的优良局部控制率，并且在某些情况下被认为是治愈性治疗。</li>
<li>其他介入技术，例如微波消融或联合热-经动脉化学栓塞已被用于改善局部控制率，特别是对于在3cm和5cm之间的HCC肿瘤。</li>
<li>SBRT是RFA的新兴替代方法，似乎为较小的HCC提供了类似的局部控制率。</li>
<li>尽管对SBRT的研究正在逐渐增加，但大多数SBRT的数据来自单中心，易于受到选择偏倚的影响。
此外，许多单中心的样本量相对较少，缺乏长期生存数据。</li>
<li>前瞻性随机试验对于比较RFA与SBRT治疗局部不可切除HCC的有效性是必要的。然而，目前尚无前瞻性随机试验，且进行此类试验面临许多挑战，耗时且花费较高。</li>
</ol>
<h3 id="研究方法">研究方法</h3>
<h4 id="数据来源">数据来源</h4>
<ol type="1">
<li>我们使用NCDB进行了回顾性分析，属于不受机构审查委员会监督的去标志数据(de-identified
data)。</li>
<li>NCDB是美国外科医师学会(American College of
Surgeons)癌症委员会（Commission on Cancer,CoC）和美国癌症协会(the
American Cancer Society)的联合项目。</li>
<li>NCDB包含来自美国1500多家拥有CoC认证项目的医院的数据，其中包括约70％全美所有新诊断的癌症病例，即超过2900万个独特的癌症病例。</li>
<li>根据与每个认证机构签订的协议，删除来自美国退伍军人事务部、国防部，波多黎各的设施和其他某些计划的数据。</li>
<li>我们从NCDB参与者用户文件（Participant User Files,PUF）获得数据。The
data elements are collected prospectively from cancer registries of
CoC-accredited programs by using nationally standardized data item and
coding definitions as specified in the CoC’s facility oncology registry
data standards and nationally standardized data transmission format
specifications coordinated by the North American Association of Central
Cancer Registries.</li>
<li>数据元素包括患者特征、癌症分期、肿瘤的组织学特征、首次治疗的类型和时间以及结果。</li>
<li>对于所有在5年内诊断出的符合条件的患者，合格评定(accreditation)要求每年有90％的随访率。</li>
</ol>
<h4 id="研究人群">研究人群</h4>
<ol type="1">
<li><p>从2004年至2013年间诊断为原发性HCC的119,933名男性和女性人群中共识别了47,634例临床I期（T1N0M0）或II期（T2N0M0）患者</p>
<blockquote>
<p>International Classification of Disease-Oncology-3rd Edition code
C22.0, histology codes 8170-8175</p>
</blockquote></li>
<li><p>排除接受过肺叶切除术，扩大肺叶切除术，肝切除术或肝移植的患者。</p></li>
<li><p>以RFA或SBRT作为主要治疗方式，排除接受其他形式的局部消融治疗的患者。</p></li>
<li><p>排除接受任何形式的化疗（辅助或新辅助）或化疗信息未知的患者。</p></li>
<li><p>本研究最终纳入3,980名患者。</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-17-CONSORT%20diagram.jpg"
alt="CONSORT diagram" />
<figcaption aria-hidden="true">CONSORT diagram</figcaption>
</figure></li>
</ol>
<h4 id="covariates协变量">Covariates/协变量</h4>
<blockquote>
<p>可以在NCDB PUF数据dictionary中找到所有变量的完整详细描述。</p>
</blockquote>
<ol type="1">
<li>Patient-level variables
<ul>
<li>诊断时的年龄</li>
<li>性别</li>
<li>种族</li>
<li>保险状况</li>
<li>根据患者邮政编码的家庭收入中位数</li>
<li>患者人口普查区内低于高中教育的人口百分比</li>
<li>Charlson-Deyo合并症评分(被NCDB分为0,1,≥2的得分类别)</li>
</ul></li>
<li>Facility-level variables
<ul>
<li>从患者居住区到治疗设施的距离</li>
<li>case volume in quartiles</li>
<li>地理区域</li>
<li>type of treatment facilities(由CoC accreditation
category指定，基于case volume和available services)
<ul>
<li>社区</li>
<li>综合性社区</li>
<li>学术</li>
<li>integrated network cancer program</li>
</ul></li>
</ul></li>
<li>Tumor-level variables
<ul>
<li>TNM分期</li>
<li>肿瘤大小</li>
<li>诊断年份（2004-2008 v 2009-2013）</li>
<li>甲胎蛋白</li>
<li>肿瘤分级和Ishak纤维化评分可用于接受活检以评估肿瘤的患者</li>
</ul></li>
</ol>
<h4 id="目标">目标</h4>
<ol type="1">
<li><p>本研究的主要目的是比较非手术治疗的I期或II期HCC患者的总体生存期（overall
survival,OS），同时比较接受RFA治疗的患者与接受SBRT治疗的患者的OS。 &gt;
OS的定义：从诊断日期到死亡(任何原因所导致)日期。</p></li>
<li><p>次要目标是确定RFA和SBRT在临床相关患者子集中的有效性。</p></li>
</ol>
<h4 id="统计分析">统计分析</h4>
<ol type="1">
<li>评估治疗方式与患者的特点，临床特点及和医疗设施特征之间的相关性
<ul>
<li>分类数据：Pearson卡方,Fisher’s exact test</li>
<li>计量数据：Wilcoxon rank sum test</li>
</ul></li>
<li>对于主要结果，构建了两种OS与治疗方式之间相关性的模型
<ul>
<li>a propensity score-and time-to-treatment-matched univariable Cox
proportional hazards model
/倾向性评分和治疗时间匹配的单因素Cox比例风险模型</li>
<li>an unmatched univariable analysis based on the Kaplan-Meier
estimator of inverse probability of treatment weight
(IPTW)/基于IPTW的Kaplan-Meier估计量的未匹配的单因素分析</li>
</ul></li>
<li>构建以接受SBRT为目标事件构建模型的倾向性评分模型。
<ul>
<li>通过逐步多因素logistic回归模型。</li>
<li>变量选择：先进行单因素分析，纳入所有与治疗方法显著相关的变量(a
threshold of P &lt;0.20 required for initial inclusion and P &lt;0.10
required to remain in the model)。</li>
</ul></li>
<li>在倾向性评分的基础上，计算稳定的IPTW。IPTWs were truncated at
第5和第95百分位</li>
<li>构建倾向性评分和治疗时间匹配的OS模型
<ul>
<li>通过使用a greedy, nearest neighbor matching
algorithm，接受SBRT治疗的患者与接受RFA治疗的患者，在倾向性评分和诊断到治疗的时间上，匹配为1：2。倾向性评分的最大允许差异为±2％，诊断到治疗的时间的最大允许差异为±14天。</li>
<li>计算每组的Kaplan-Meier估计量，并使用对数秩检验(log-rank
test)进行比较。</li>
</ul></li>
<li>对于OS的最终模型，计算所有患者的IPTW
Kaplan-Meier估计量，并通过对数秩检验在各组之间进行比较。</li>
<li>所有计算均使用SAS软件9.4版进行。</li>
<li>在匹配的患者组中，我们通过交互作用(interaction)和亚组分析(subgroup
analyses)评估了治疗效果的异质性(heterogeneity of treatment
effects)，探讨了年龄，性别，临床T分期，肿瘤大小，肿瘤分级，Charlson-Deyo合并症评分和设施类型的影响。</li>
<li>由于在NCDB中纤维化/肝硬化例数较少，以及纤维化/肝硬化与OS减少之间的已知关联。我们在匹配的患者组中进行了敏感性分析，以研究这种未测量的混杂因素对我们的结果的潜在影响。</li>
<li>敏感性分析的目标是探索假设的结果情景，并在其中调整观察到的治疗效果以解释潜在的未测量的混杂因素。</li>
<li>除了观察到的治疗效果外，敏感性分析还纳入了关于生存效应和未测量混杂因子的不同暴露的假设信息，以计算如果去除未测量的混杂因素将会观察到的真实治疗效果。</li>
</ol>
<h3 id="结果-1">结果</h3>
<h4 id="factors-associated-with-use-of-sbrt">Factors Associated With Use
of SBRT</h4>
<ol type="1">
<li>开始SBRT和RFA治疗的中位时间分别为72天和48天。</li>
<li>患者基线特征列于表1中。 <img
src="http://qiniup.louyanspine.com/2018-07-17-Table%201.jpg"
alt="Table 1" /> <img
src="http://qiniup.louyanspine.com/2018-07-17-Table%201c.jpg"
alt="Table 1_c" /></li>
<li>通过倾向性评分和time to
treatment进行匹配，两组患者所有的协变量均取得了足够的组间平衡（见表A1）。
<img src="http://qiniup.louyanspine.com/2018-07-17-Table%20A1.jpg"
alt="表A1" /> <img
src="http://qiniup.louyanspine.com/2018-07-17-Table%20A1c.jpg"
alt="表A1_c" /></li>
<li>接受SBRT的患者比例随时间逐渐增加，年增长率为12％（P&lt;0.001;图2），大多数患者（79.7％）接受三至五次治疗。</li>
</ol>
<h4 id="生存分析">生存分析</h4>
<h4 id="严重纤维化肝硬化的影响">严重纤维化/肝硬化的影响</h4>
<h3 id="讨论">讨论</h3>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/17/propensityscoreR/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/17/propensityscoreR/" class="post-title-link" itemprop="url">倾向性评分匹配的R语言实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-17 18:13:44" itemprop="dateCreated datePublished" datetime="2018-07-17T18:13:44+08:00">2018-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-27 23:44:15" itemprop="dateModified" datetime="2019-02-27T23:44:15+08:00">2019-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%9F%E8%AE%A1%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">统计学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1. 译自Norbert Köhler的文章How to use R for matching samples
(propensity score)</p>
</blockquote>
<p>根据维基百科，倾向性评分匹配（propensity score
matching,PSM）是一种用来评估处置效应的统计方法。</p>
<blockquote>
<p><strong>Propensity score matching (PSM)</strong> is a statistical
matching technique that attempts to estimate the effect of a treatment,
policy, or other intervention by accounting for the covariates that
predict receiving the treatment</p>
</blockquote>
<p>广义说来，倾向性评分分析假设只有当两组样本的研究对象具有相似特征时才能进行两组样本之间的无偏比较(unbiased
comparison)。因此，PSM不仅仅是随机试验的一种替代方法，它也是流行病研究中进行样本比较的重要方法之一。让我们举个例子：</p>
<blockquote>
<p>与健康相关的生活质量（Health-related quality of
life,HRQOL）被认为是癌症治疗的重要结果之一。对癌症患者而言，最常用的HRQOL测度是通过欧洲癌症研究与治疗中心(European
Organisation for Research and Treatment of
Cancer,EORTC)的调查问卷计算得出的。</p>
<p>EORTC
QLD-C30是一个由30个项目组成，包括5个功能量表，9个症状量表和一个整体生活质量量表的的问卷。所有量表都会给出一个0-100之间的得分。症状量表得分越高代表被调查人症状越重，其余两个量表得分越高代表生活质量越高。</p>
</blockquote>
<p>然而，如果没有任何参照，直接对数据进行解释是很困难的。幸运的是，<a target="_blank" rel="noopener" href="http://groups.eortc.be/qol/sites/default/files/img/slider/specimen_qlq-c30_english.pdf">EORTC
QLQ-C30问卷</a>也在一些正常人群调查中使用，我们可以对比患者的得分和正常人群的得分差异，从而判断患者的一些症状和功能障碍是否能归因于癌症（或治疗）。PSM可以通过相似年龄和相同性别等特征，将患者和一般人群进行匹配。</p>
<h3 id="生成两个随机数据框">生成两个随机数据框</h3>
<blockquote>
<p>本文用到的所有包可通过如下代码加载：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman::p_load(knitr, wakefield, MatchIt, tableone, captioner)</span><br></pre></td></tr></table></figure>
<p>由于我们不希望在博客文章中使用真实数据，因此需要生成一些模拟数据。使用<code>wakefield</code>包可以很容易地实现这个功能。</p>
<ol type="1">
<li><p>创建一个名为<code>df.patients</code>的数据框，包含250个病人的年龄和性别数据，所有病人的年龄都要在30-78岁之间，并且70%的病人被设定为男性。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">set.seed(180717)</span><br><span class="line">library(wakefield)</span><br><span class="line">df.patients &lt;- r_data_frame(n = 250, </span><br><span class="line">			age(x = 30:78, name = &#x27;Age&#x27;), </span><br><span class="line">			sex(x = c(&quot;Male&quot;, &quot;Female&quot;), </span><br><span class="line">			prob = c(0.70, 0.30), name = &quot;Sex&quot;))</span><br><span class="line">df.patients$Sample &lt;- as.factor(&#x27;Patients&#x27;)</span><br></pre></td></tr></table></figure></p></li>
<li><p><code>summary函数</code>会返回创建的数据框的基本信息。患者平均年龄为53.7岁，并且大约70%为男性(66.8%)。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">summary(df.patients)</span><br><span class="line">     </span><br><span class="line">      Age            Sex           Sample   </span><br><span class="line">Min.   :30.00   Male  :167   Patients:250  </span><br><span class="line">1st Qu.:44.00   Female: 83                 </span><br><span class="line">Median :57.00                              </span><br><span class="line">Mean   :55.24                              </span><br><span class="line">3rd Qu.:67.00                              </span><br><span class="line">Max.   :78.00 </span><br></pre></td></tr></table></figure></p></li>
<li><p>接下来，需要创建另一个名为<code>df.population</code>的数据框。我们希望这个数据集的数据和患者<code>df.patients</code>有些不同，因此正常人群的年龄区间被设定为18-80岁，并且男女各占一半。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">set.seed(180717)</span><br><span class="line"></span><br><span class="line">df.population &lt;- r_data_frame(n = 1000, age(x = 18:80, name = &#x27;Age&#x27;), </span><br><span class="line">sex(x = c(&quot;Male&quot;, &quot;Female&quot;),</span><br><span class="line">prob = c(0.50, 0.50), </span><br><span class="line">name = &quot;Sex&quot;))</span><br><span class="line"></span><br><span class="line">df.population$Sample &lt;- as.factor(&#x27;Population&#x27;)</span><br><span class="line"> </span><br><span class="line">#下方表格显示样本平均年龄为50.1岁，男女比例也大致相等。</span><br><span class="line"></span><br><span class="line">summary(df.population)</span><br><span class="line">     </span><br><span class="line">	Age           Sex             Sample    </span><br><span class="line">Min.   :18.0   Male  :489   Population:1000  </span><br><span class="line">1st Qu.:34.0   Female:511                    </span><br><span class="line">Median :51.0                                 </span><br><span class="line">Mean   :50.1                                 </span><br><span class="line">3rd Qu.:66.0                                 </span><br><span class="line">Max.   :80.0  </span><br></pre></td></tr></table></figure></p></li>
</ol>
<h3 id="合并数据框">合并数据框</h3>
<p>在匹配样本之前，我们需要把两个数据框合并。首先，生成一个新变量<code>Group</code>来代表研究对象来自哪个全体（逻辑型变量），再添加另一个变量<code>Distress</code>来表示个体的痛苦程度。<code>Distress</code>变量是利用<code>wakefield包</code>中的<code>age函数</code>创建的，可以发现，女性承受的痛苦级别更高。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mydata &lt;- rbind(df.patients, df.population)</span><br><span class="line">mydata$Group &lt;- as.logical(mydata$Sample == &#x27;Patients&#x27;)</span><br><span class="line">mydata$Distress &lt;- ifelse(mydata$Sex == &#x27;Male&#x27;, </span><br><span class="line">                age(nrow(mydata), x = 0:42, name = &#x27;Distress&#x27;),</span><br><span class="line">                age(nrow(mydata), x = 15:42, name = &#x27;Distress&#x27;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; mydata</span><br><span class="line"># A tibble: 1,250 x 5</span><br><span class="line">     Age Sex    Sample   Group Distress</span><br><span class="line">   &lt;int&gt; &lt;fct&gt;  &lt;fct&gt;    &lt;lgl&gt;    &lt;int&gt;</span><br><span class="line"> 1    76 Female Patients TRUE        39</span><br><span class="line"> 2    49 Female Patients TRUE        25</span><br><span class="line"> 3    57 Male   Patients TRUE        39</span><br><span class="line"> 4    62 Male   Patients TRUE        32</span><br><span class="line"> 5    61 Male   Patients TRUE        21</span><br><span class="line"> 6    44 Male   Patients TRUE        27</span><br><span class="line"> 7    56 Female Patients TRUE        21</span><br><span class="line"> 8    54 Female Patients TRUE        28</span><br><span class="line"> 9    49 Male   Patients TRUE        17</span><br><span class="line">10    64 Male   Patients TRUE        28</span><br><span class="line"># ... with 1,240 more rows</span><br></pre></td></tr></table></figure>
<blockquote>
<p>if..else语句的基本语法是</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(boolean_expression) &#123;</span><br><span class="line">   // statement(s) will execute if the boolean expression is true.</span><br><span class="line">&#125; else &#123;</span><br><span class="line">   // statement(s) will execute if the boolean expression is false.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们比较两组样本的年龄和性别分布时，我们可以发现明显的区别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">library(pacman)</span><br><span class="line">pacman::p_load(tableone)</span><br><span class="line">table1 &lt;- CreateTableOne(vars = c(&#x27;Age&#x27;, &#x27;Sex&#x27;, &#x27;Distress&#x27;), </span><br><span class="line">                         data = mydata, </span><br><span class="line">                         factorVars = &#x27;Sex&#x27;, </span><br><span class="line">                         strata = &#x27;Sample&#x27;)</span><br><span class="line">table1 &lt;- print(table1, </span><br><span class="line">                printToggle = FALSE, </span><br><span class="line">                noSpaces = TRUE)</span><br><span class="line"></span><br><span class="line">library(knitr)</span><br><span class="line">kable(table1[,1:3],  </span><br><span class="line">      align = &#x27;c&#x27;, </span><br><span class="line">      caption = &#x27;Table 1: Comparison of unmatched samples&#x27;)</span><br></pre></td></tr></table></figure>
<p><strong>Table 1: Comparison of unmatched samples</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Patients</th>
<th style="text-align: center;">Population</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">n</td>
<td style="text-align: center;">250</td>
<td style="text-align: center;">1000</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">Age (mean (sd))</td>
<td style="text-align: center;">55.24 (14.24)</td>
<td style="text-align: center;">50.10 (18.37)</td>
<td style="text-align: center;">&lt;0.001</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Sex = Female (%)</td>
<td style="text-align: center;">83 (33.2)</td>
<td style="text-align: center;">511 (51.1)</td>
<td style="text-align: center;">&lt;0.001</td>
</tr>
<tr class="even">
<td style="text-align: center;">Distress (mean (sd))</td>
<td style="text-align: center;">25.12 (11.58)</td>
<td style="text-align: center;">24.35 (11.34)</td>
<td style="text-align: center;">0.344</td>
</tr>
</tbody>
</table>
<h3 id="样本匹配">样本匹配</h3>
<p>现在，我们已经完成了全部的准备工作，可以开始使用<code>MatchIT包</code>中的<code>matchit函数</code>来匹配两组样本了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">library(MatchIt)</span><br><span class="line">set.seed(180717)</span><br><span class="line"></span><br><span class="line">match.it &lt;- matchit(Group ~ Age + Sex, </span><br><span class="line">data = mydata, </span><br><span class="line">method=&quot;nearest&quot;, </span><br><span class="line">ratio=1)</span><br><span class="line"></span><br><span class="line">a &lt;- summary(match.it)</span><br></pre></td></tr></table></figure>
<ol type="1">
<li>函数中<code>method=‘nearest’</code>的设定指明了使用近邻法(the
nearest neighbors method)进行匹配。</li>
<li>其他方法包括exact matching,subclassification,optimal
matching,genetic matching,ull
matching等（<code>method = c("exact", "subclass", "optimal", ""genetic", "full")</code>）。</li>
<li><code>ratio=1</code>意味着这是一一配对。在我们的例子里，对于患者组中的每一个病例，将恰好匹配正常人群样本中的一个人。</li>
<li>同时也请注意<code>Group变量</code>需要是逻辑型变量（TRUE与FALSE）。</li>
</ol>
<p>为了后续工作的便利，我们将<code>summary函数</code>的输出赋值给名为<code>a</code>的变量。在匹配完样本后，正常人群样本量减少到了和患者样本一致（n=250，详见Table
2）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kable(a$nn, digits = 2, align = &#x27;c&#x27;, caption = &#x27;Table 2: Sample sizes&#x27;)</span><br></pre></td></tr></table></figure>
<p><strong>Table 2: Sample sizes</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Control</th>
<th style="text-align: center;">Treated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">All</td>
<td style="text-align: center;">1000</td>
<td style="text-align: center;">250</td>
</tr>
<tr class="even">
<td style="text-align: center;">Matched</td>
<td style="text-align: center;">250</td>
<td style="text-align: center;">250</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Unmatched</td>
<td style="text-align: center;">750</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Discarded</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p>根据输出结果，匹配后的年龄和性别分布基本一致了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kable(a$sum.matched[c(1,2,4)], digits = 2, align = &#x27;c&#x27;, caption = &#x27;Table 3: Summary of balance for matched data&#x27;)</span><br></pre></td></tr></table></figure>
<p><strong>Table 3: Summary of balance for matched data</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Means Treated</th>
<th style="text-align: center;">Means Control</th>
<th style="text-align: center;">Mean Diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">distance</td>
<td style="text-align: center;">0.23</td>
<td style="text-align: center;">0.23</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: center;">Age</td>
<td style="text-align: center;">55.24</td>
<td style="text-align: center;">55.22</td>
<td style="text-align: center;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: center;">SexMale</td>
<td style="text-align: center;">0.67</td>
<td style="text-align: center;">0.67</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: center;">SexFemale</td>
<td style="text-align: center;">0.33</td>
<td style="text-align: center;">0.33</td>
<td style="text-align: center;">0.00</td>
</tr>
</tbody>
</table>
<p>倾向性评分的分布可以使用<code>MatchIt包</code>中的<code>plot函数</code>进行绘制。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot(match.it, type = &#x27;jitter&#x27;, interactive = FALSE)</span><br></pre></td></tr></table></figure>
<p><img
src="http://qiniup.louyanspine.com/2018-07-17-%E5%80%BE%E5%90%91%E6%80%A7%E8%AF%84%E5%88%86%E7%9A%84%E5%88%86%E5%B8%83.jpg" /></p>
<h3 id="保存匹配样本">保存匹配样本</h3>
<p>最后，匹配的样本将保存到名为<code>df.match</code>的新数据框中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 获得匹配数据集(含distance和weights列)的第1~ncol(mydata)列</span><br><span class="line"></span><br><span class="line">df.match &lt;- match.data(match.it)[1:ncol(mydata)]</span><br><span class="line"></span><br><span class="line"># rm()函数：删除变量函数</span><br><span class="line">rm(df.patients, df.population)</span><br><span class="line"></span><br><span class="line"># 我们可以对比两类人群间痛苦程度的差异是否依旧显著</span><br><span class="line">pacman::p_load(tableone)</span><br><span class="line">table4 &lt;- CreateTableOne(vars = c(&#x27;Age&#x27;, &#x27;Sex&#x27;, &#x27;Distress&#x27;), </span><br><span class="line">                         data = df.match, </span><br><span class="line">                         factorVars = &#x27;Sex&#x27;, </span><br><span class="line">                         strata = &#x27;Sample&#x27;)</span><br><span class="line"></span><br><span class="line"># printToggle：是否打印输出。如果为FALSE，则不创建输出，并返回一个矩阵。</span><br><span class="line"># noSpaces：是否删除为对齐添加的空格。如果您希望自己在其他软件中对齐数字，请使用此选项。</span><br><span class="line"></span><br><span class="line">table4 &lt;- print(table4, </span><br><span class="line">                printToggle = FALSE, </span><br><span class="line">                noSpaces = TRUE)</span><br><span class="line"></span><br><span class="line"># align/列对齐: &#x27;l&#x27; (left), &#x27;c&#x27; (center) and/or &#x27;r&#x27; (right). 默认则align = NULL, 数值列右对齐, 其他列左对齐.</span><br><span class="line"># kable函数：Create Tables In LaTeX, HTML, Markdown And ReStructuredText</span><br><span class="line"></span><br><span class="line">kable(table4[,1:3],  </span><br><span class="line">      align = &#x27;c&#x27;, </span><br><span class="line">      caption = &#x27;Table 4: Comparison of matched samples&#x27;)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Patients</th>
<th style="text-align: center;">Population</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">n</td>
<td style="text-align: center;">250</td>
<td style="text-align: center;">250</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">Age (mean (sd))</td>
<td style="text-align: center;">55.24 (14.24)</td>
<td style="text-align: center;">55.22 (14.21)</td>
<td style="text-align: center;">0.987</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Sex = Female (%)</td>
<td style="text-align: center;">83 (33.2)</td>
<td style="text-align: center;">83 (33.2)</td>
<td style="text-align: center;">1.000</td>
</tr>
<tr class="even">
<td style="text-align: center;">Distress (mean (sd))</td>
<td style="text-align: center;">25.12 (11.58)</td>
<td style="text-align: center;">22.87 (11.72)</td>
<td style="text-align: center;">0.032</td>
</tr>
</tbody>
</table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/16/PropensityScore/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/16/PropensityScore/" class="post-title-link" itemprop="url">倾向性评分（The Propensity Score）总述</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-16 20:26:22" itemprop="dateCreated datePublished" datetime="2018-07-16T20:26:22+08:00">2018-07-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-10-29 14:47:00" itemprop="dateModified" datetime="2018-10-29T14:47:00+08:00">2018-10-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%9F%E8%AE%A1%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">统计学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明：<br> 1. 部分参考自Jason S. Haukoos, MD, MSc的文章The Propensity
Score<br> 2.
部分参考孙婷，秦国友等的文章自不同混杂结构条件下各倾向性评分方法的模拟比较研究</p>
</blockquote>
<h2 id="一前言">一、前言</h2>
<p>2015年有2项发表在JAMA上的研究涉及对观察性数据(observational
data)的分析，以评估治疗对患者预后的影响。</p>
<ol type="1">
<li><p>在Rozé等人的研究中<sup>[1]</sup>，分析了一个大型观察性数据集，以评估早期超声心动图(early
echocardiography screening)筛查动脉导管未闭(patent ductus
arteriosus)与早产儿死亡率之间的关系。作者比较了847名接受了筛查的婴儿和666名未接受筛查的婴儿的死亡率。</p>
<p>两个婴儿组不太相同：筛查组的婴儿年龄更小，女婴较多，并且很少接受过皮质类固醇激素的治疗。作者使用倾向性评分匹配(propensity
score
matching)创建了来自原始队列的605个匹配的婴儿对以调整这些差异因素。</p></li>
<li><p>另一项在Huybrechts等人的研究中<sup>[2]</sup>，分析了Medicaid
Analytic
eXtract数据集，以评估妊娠期使用抗抑郁药与新生儿持续性肺动脉高压之间的关系。</p>
<p>作者纳入了3 789 330名妇女，其中128
950名在妊娠期使用过抗抑郁药。使用抗抑郁药的妇女与没有使用抗抑郁药的妇女在年龄、种族/民族、慢性病、肥胖、吸烟和health
care use方面存在差异。作者使用倾向性评分分层(propensity score
stratification)方法部分地调整了这些差异。</p></li>
</ol>
<h2 id="二使用方法">二、使用方法</h2>
<h3 id="一为什么使用倾向性方法">（一）为什么使用倾向性方法？</h3>
<p>许多因素会影响治疗方法的选择。在许多情况下，患者会接受多种治疗方法。此外，接受不同治疗方法的患者显然不能混为一谈。这通常会导致患者影响结果的特征与治疗方法之间存在相关性(correlation)或混淆(confounding)。（通常称为“confounding
by indication”）。</p>
<p>如果从常规的临床实践中获得观察性数据以比较使用不同治疗方法的患者的结局/预后，观察到的差异将是不同的患者特征和不同治疗方法的共同作用结果，难以描绘某一种治疗与另一种治疗的真实效果。</p>
<p>在观察性研究中，随机化是不可能的，因此研究者必须调整组间差异，以获得进行比较的治疗方法与感兴趣结局之间相关性的有效估计。多变量统计方法(Multivariable
statistical methods)通常用于评估这种关联，同时调整混淆。</p>
<p>倾向性评分的方法可减少评估治疗效果时的偏倚，并允许研究者在分析非随机的观察性数据时降低混淆的可能性。</p>
<h3 id="二倾向性评分的概念及其原理">（二）倾向性评分的概念及其原理</h3>
<ol type="1">
<li><p>倾向性评分是指在一定协变量条件下，一个观察对象接受某种暴露/处理因素（所研究的治疗方法）的可能性，它是一个从0到1的范围内连续分布的概率值。这种概率基于患者的特征，临床医生和临床环境。可以使用多变量统计方法（例如，logicistic回归）来估计这种概率。在这种情况下，所研究的治疗方法是因变量(dependent
variable)，而患者的特征，处方医生和临床环境则是预测因子(predictors)。</p></li>
<li><p>倾向性评分是指在给定一组协变量(<span
class="math inline">\(X_i\)</span>)的条件下，将任意一个研究对象<span
class="math inline">\(i(i=1，2，⋯，n)\)</span>分配到处理组<span
class="math inline">\((Z_i=1)\)</span>的条件概率。第<span
class="math inline">\(i\)</span>个研究对象被分配到处理组的条件概率可以表示为：<span
class="math display">\[e(X_i)=P(Z_i=1\mid{X_i})\]</span></p>
<p>其中<span
class="math inline">\(e(X_i)\)</span>被称为倾向性评分。倾向性评分相同的两个不同组别的研究对象，其拥有的多个协变量整体上分布是相同的。因此，组间协变量的不均衡性对处理效应估计的干扰被消除了。</p></li>
<li><p>倾向性评分的基本原理是用⼀个分值来替代多个协变量，均衡处理组和对照组间协变量的分布。对⾮随机化研究中的混杂因素进行类似随机化的均衡处理，减少选择偏倚。计算得出PS分值后，可采⽤匹配、回归调整、加权、分层的方法来均衡各组间协变量的差异，最终估计处理效应。</p></li>
<li><p>在生物医学研究中，倾向性评分通常用于比较治疗方法，但也可用于评估任何非随机因素（如接触毒素或病原体）与感兴趣结局之间的关系。</p></li>
</ol>
<h3 id="三倾向性评分的四种常规方法">（三）倾向性评分的四种常规方法</h3>
<h4 id="倾向性评分匹配">(1)倾向性评分匹配</h4>
<ol type="1">
<li>其通常包括2组研究对象，一组接受所研究的治疗而另一组则接受其他治疗，同时匹配具有相似或相同倾向性评分的个体。然后，直接比较接受所研究治疗的个体与接受其他治疗的个体之间的结果。</li>
<li>常用的匹配方法：
<ul>
<li>最邻近匹配(Nearest Neighbor Matching)
<ul>
<li>首先利用logistic模型计算倾向性评分值，根据分组变量将处理组与对照组区分开。</li>
<li>然后对处理组个体随机排序，从处理组中选出第一个个体，与对照组中全部个体的倾向性评分值进行比较，找出对照组中倾向性评分值相同或相近的个体进行配对，若对照组中有2个或2个以上与处理组个体倾向性评分值相同，则随机选取。</li>
<li>配对成功的个体从数据中剔除，对下一个体重复如上步骤，直到处理组个体全部完成匹配。</li>
</ul></li>
<li>卡钳匹配(caliper matching)
<ul>
<li>在最邻近匹配集的基础上根据倾向性评分值在最邻近匹配集中的分布设置不同的卡钳，删除两组倾向性评分值之差在卡钳值范围外的配对个体，得到不同精度的匹配集，然后计算协变量之间的均衡性及样本不平衡性，并将结果进行汇总。</li>
</ul></li>
<li>全局最优匹配</li>
</ul></li>
<li>使用倾向性评分匹配样本的分析结果可以接近随机对照试验的分析结果，因为考虑了数据的配对性质。</li>
</ol>
<h4 id="倾向性评分分层">(2)倾向性评分分层</h4>
<ol type="1">
<li><p>估计出每个研究对象的倾向性评分值后，根据倾向性评分值将研究对象分为若干层。</p></li>
<li><p>有文献指出，当估计线性处理效应的时候，将倾向性评分值分为五层可以消除组间近90%的混杂偏倚。经过分层后，每一层内处理组与对照组的协变量分布应该是均衡的。</p>
<blockquote>
<p>尽管增加层或组的数量可以减少偏倚的可能性，但通常使用五个层。</p>
</blockquote></li>
<li><p>分析过程中，先在每一层内估计处理效应，最后将每层的效应整合成总的处理效应。这种方法基于于这样一种观念，即每个组/层中的个体比个体更相似。因此，他们的结果可以直接比较。</p></li>
</ol>
<h4
id="使用倾向性评分进行协变量调整">(3)使用倾向性评分进行协变量调整</h4>
<p>在倾向性评分模型之后，构建单独的多变量模型，其中研究结果用作因变量(dependent
variable)，治疗组和倾向性评分用作预测变量(predictor
variables)。这允许研究者评估与所研究治疗相关的结果，同时调整接受治疗的概率，从而减少混淆。</p>
<h4
id="倾向性评分逆处理概率加权inverse-probability-of-treatment-weighting-using-the-propensity-score">(4)倾向性评分逆处理概率加权/inverse
probability of treatment weighting using the propensity score</h4>
<p>在这种情况下，倾向性评分用于计算每个个体的统计权重(statistical
weights)以创建样本，其中潜在的混杂因素的分布独立于暴露因素，允许对治疗和结果之间的关系进行无偏估计。</p>
<ol type="1">
<li><p>是边缘结构模型这类因果推断⽅法中的一种，其基本原理与传统的标准化法类似。</p></li>
<li><p>根据倾向性评分值赋予每个研究对象⼀个相应的权重，从⽽构建出⼀个虚拟的人群，在这个虚拟人群中，协变量的组间分布没有差异，因此消除了混杂因素的影响。</p></li>
<li><p>在逆处理概率加权的方法中，权重被定义为研究对象实际分组情况的概率的倒数，计算如下：
<span class="math display">\[w_i =
\cfrac{z_i}{e_i}+\cfrac{(1-z_i)}{(1-e_i)}\]</span></p>
<ul>
<li><p>若<span class="math inline">\(z_i=1\)</span>(处理组)，则<span
class="math inline">\(w_i = \cfrac{1}{e_i}\)</span></p></li>
<li><p>若<span class="math inline">\(z_i=0\)</span>(对照组)，则<span
class="math inline">\(w_i = \cfrac{1}{1-e_i}\)</span></p></li>
</ul></li>
<li><p>计算权重后，再应⽤用加权回归的⽅方法估计处理理效应。</p></li>
</ol>
<h3
id="四倾向性评分以外的替代策略以调整观察性研究中各组之间的基线差异">（四）倾向性评分以外的替代策略：以调整观察性研究中各组之间的基线差异</h3>
<ol type="1">
<li>匹配基线特征/matching on baseline characteristics</li>
<li>分层分析/stratified analyses</li>
<li>多变量统计方法/multivariable statistical methods</li>
</ol>
<p>倾向性评分方法通常比这些方法更实用或在统计上更有效，部分原因是倾向性评分方法可以限制最终分析中使用的预测变量的数量。倾向性评分方法通常允许将更多变量包括在倾向性评分模型(propensity
score
model)中，从而增加了这些方法有效调整混淆的能力，而不是直接纳入研究结果的多变量分析。</p>
<h2
id="三倾向性评分方法的局限性是什么">三、倾向性评分方法的局限性是什么？</h2>
<ol type="1">
<li>每个研究对象的倾向性评分基于能够测量的患者特征，如果无法测量的因素影响治疗选择，则可能仍存在未调整的混淆。因此，在倾向性评分模型中使用较少的变量降低了有效调整混淆的可能性。</li>
<li>虽然倾向性评分匹配可用于组合可比较的研究组，但匹配的质量取决于倾向性评分模型的质量，而倾向性评分模型的质量又取决于进行分析的数据的质量、大小以及模型的构建方式。</li>
<li>传统的建模方法（如，变量选择，交互的使用use of
interactions，回归诊断regression
diagnostics等）通常不推荐用于倾向性评分模型的构建。例如，倾向性评分模型可以纳入更多数量的预测变量。</li>
</ol>
<h2 id="四结果该如何解释">四、结果该如何解释？</h2>
<p>鉴于这些研究属于观察性研究，治疗组和未治疗组中的个体不同。为了能够准确估计治疗与结局之间的关联，研究者必须调整两组之间的差异。</p>
<p>使用倾向性评分方法时，无论是通过匹配还是分层，结果的估计偏差小于不使用此类方法的估计偏差。</p>
<p>尽管观察性数据不能像随机临床试验那样严格地建立因果关系或确定治疗效果，但如果倾向性评分方法得到适当使用且样本量足够大，这些方法可能提供治疗方法可能效果的可靠近似值。这种方法对于随机临床试验不可行或不可能进行的情况特别有价值。</p>
<h2
id="五在评估倾向性分析的结果时读者应该考虑哪些注意事项">五、在评估倾向性分析的结果时，读者应该考虑哪些注意事项？</h2>
<p>Rozé等人和Huybrechts等人的研究分别使用了倾向性评分匹配和倾向性评分分层。尽管这两种方法在平衡研究组方面比基于基线特征的简单匹配或分层更有效，但它们在最小化偏倚(minimize
bias)方面的能力各不相同。通常，倾向性评分匹配比倾向性评分分层更大程度地减少偏差。在使用倾向性评分方法后，评估各组之间的平衡对于让读者评估研究组的可比性非常重要。</p>
<p>尽管没有单一的标准方法来评估平衡，但是比较治疗组和未治疗组患者之间的特征通常始于比较汇总的统计数据（例如，平均值或比例）和观察到的特征的整体分布。</p>
<p>对于倾向性评分匹配的样本，经常使用标准化差异（standardized
differences，即差异differences/合并的标准偏差pooled standard
deviations）。尽管没有普遍接受的阈值，但小于0.1的标准化差异通常被认为是可忽略不计的。</p>
<p>评估平衡提供了一般意义，即匹配或分层的良好程度，以及结果可能有效的程度。</p>
<p>不幸的是，只能在研究中可以测量的患者特征中显示平衡。无法测量的差异仍可能存在于各组间，从而导致结果的偏倚。</p>
<h2 id="六参考文献">六、参考文献</h2>
<ol type="1">
<li>Rozé JC, Cambonie G, Marchand-Martin L, et al. Hemodynamic EPIPAGE 2
Study Group. Association between early screening for patent ductus
arteriosus and in-hospital mortality among extremely preterm infants.
JAMA. 2015; 313(24):2441–2448.</li>
<li>Huybrechts KF, Bateman BT, Palmsten K, et al. Antidepressant use
late in pregnancy and risk of persistent pulmonary hypertension of the
newborn. JAMA. 2015; 313(21):2142–2151.</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/12/evalwithScope/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/12/evalwithScope/" class="post-title-link" itemprop="url">欺骗词法作用域的两种方式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-12 19:21:15" itemprop="dateCreated datePublished" datetime="2018-07-12T19:21:15+08:00">2018-07-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-28 00:54:47" itemprop="dateModified" datetime="2019-02-28T00:54:47+08:00">2019-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">Web开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1.
部分参考作者姚屹晨在简书上的笔记https://www.jianshu.com/p/650e458bc9ce<br>
2.
部分参考作者m4jing在Github上的译文https://github.com/getify/You-Dont-Know-JS/blob/1ed-zh-CN/scope%20%26%20closures/ch2.md</p>
</blockquote>
<h2 id="一欺骗词法作用域">一、欺骗词法作用域</h2>
<h3 id="eval">eval</h3>
<ol type="1">
<li><p><code>eval</code>函数可以接收一个字符串作为参数，以动态形式插入程序的某个位置，并对其词法作用域的环境进行修改。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function foo(str,a)&#123;</span><br><span class="line">    eval(str);</span><br><span class="line">    console.log(a,b);</span><br><span class="line">&#125;</span><br><span class="line">var b = 2;</span><br><span class="line">foo(&#x27;var b = 5;&#x27;,1);</span><br><span class="line">&gt;&gt;&gt;1 5</span><br></pre></td></tr></table></figure></p></li>
<li><p>在严格模式下，<code>eval</code>函数在运行时拥有自己的词法作用域。这意味着其中的声明无法修改所在的作用域。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function foo(str,a)&#123;</span><br><span class="line">    &quot;use strict&quot;</span><br><span class="line">    eval(str);</span><br><span class="line">    console.log(a,b);</span><br><span class="line">&#125;</span><br><span class="line">var b = 2;</span><br><span class="line">foo(&#x27;var b = 5;&#x27;,1);</span><br><span class="line">&gt;&gt;&gt;1 2</span><br><span class="line"></span><br><span class="line">function foo(str,a)&#123;</span><br><span class="line">    &quot;use strict&quot;</span><br><span class="line">    eval(str);</span><br><span class="line">    console.log(a,b);</span><br><span class="line">&#125;</span><br><span class="line">foo(&#x27;var b = 5;&#x27;,1);</span><br><span class="line">&gt;&gt;&gt;Uncaught ReferenceError: b is not defined</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h3 id="with">with</h3>
<ol type="1">
<li><p><code>with</code>通常被当做重复引用同一个对象中的多个属性的快捷方式，可以不需要重复引用对象本身：</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var obj = &#123;</span><br><span class="line">    a: 1,</span><br><span class="line">    b: 2,</span><br><span class="line">    c: 3</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.a = 2;</span><br><span class="line">obj.b = 3;</span><br><span class="line">obj.c = 4;</span><br><span class="line"></span><br><span class="line">with(obj) &#123;</span><br><span class="line">    a = 3;</span><br><span class="line">    b = 4;</span><br><span class="line">    c = 5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p>实际上不仅仅是为了方便地访问对象属性：</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function foo(obj)&#123;</span><br><span class="line">    with(obj)&#123;</span><br><span class="line">        a = 2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var o1 = &#123;</span><br><span class="line">     a: 3</span><br><span class="line">&#125;;</span><br><span class="line">var o2 = &#123;</span><br><span class="line">     b: 3</span><br><span class="line">&#125;;</span><br><span class="line">foo(o1);</span><br><span class="line">o1.a;</span><br><span class="line">&gt;&gt;&gt;2</span><br><span class="line"></span><br><span class="line">foo(o2);</span><br><span class="line">o2.a;</span><br><span class="line">&gt;&gt;&gt;undefined</span><br><span class="line"></span><br><span class="line">a;</span><br><span class="line">&gt;&gt;&gt;2</span><br><span class="line">//a被泄露到全局作用域中。</span><br></pre></td></tr></table></figure>
因为，在非严格模式下，若a=2中的变量a未声明，也就是在任何作用域中都查找不到变量a，那么就会在全局作用域中创建一个变量a，并将2赋值于它。</p>
<figure>
<img src="http://qiniup.louyanspine.com/2018-07-12-foo-o1-.png"
alt="foo(o1)" />
<figcaption aria-hidden="true">foo(o1)</figcaption>
</figure>
<figure>
<img src="http://qiniup.louyanspine.com/2018-07-12-foo-o2-.png"
alt="foo(o2)" />
<figcaption aria-hidden="true">foo(o2)</figcaption>
</figure></li>
<li><p><code>with</code>语句接收一个对象，这个对象有0个或多个属性，并将这个对象视为好像它是一个完全隔离的词法作用域，因此这个对象的属性被视为在这个“作用域”中词法定义的标识符。如上图中的<code>o1 Scope</code>和<code>o2 Scope</code>。</p></li>
<li><p>尽管一个<code>with</code>块将一个对象视为一个词法作用域，但在<code>with</code>块内部的一个普通<code>var</code>声明将不会归于这个<code>with</code>块的作用域，而是归于包含它的函数作用域。</p></li>
<li><p>当我们传递对象<code>o1</code>给<code>with</code>时，<code>with</code>所声明的作用域是<code>o1</code>，而这个作用域中含有一个与<code>o1.a</code>属性同名的标识符。但当我们将<code>o2</code>对象作为作用域时，其中没有<code>a</code>标识符，因此进行了正常的<code>LHS (Left Hand Side)</code>查找，最后导致创建了一个全局变量a并赋值为2。</p></li>
</ol>
<h2 id="二性能">二、性能</h2>
<p>JavaScript引擎在编译阶段期进行许多性能优化工作。其中的一些优化原理都归结为实质上在进行词法分析时可以静态地分析代码，并提前决定所有的变量和函数声明都在什么位置，这样在执行期间就可以少花些力气来解析标识符。</p>
<p>但如果引擎在代码中找到一个<code>eval(..)</code>或<code>with</code>，它实质上就不得不假定自己知道的所有的标识符的位置可能是不合法的，因为它不可能在词法分析时就知道你将会向<code>eval(..)</code>传递什么样的代码来修改词法作用域，或者你可能会向<code>with</code>传递的对象有什么样的内容来创建一个新的将被查询的词法作用域。</p>
<p>换句话说，悲观地看，如果<code>eval(..)</code>或<code>with</code>出现，那么它将做的几乎所有的优化都会变得没有意义，所以它就会简单地根本不做任何优化。没有优化，代码就运行的更慢。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/07/12/ECMAScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/12/ECMAScript/" class="post-title-link" itemprop="url">JavaScript与ECMAScript的区别</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-12 14:26:01" itemprop="dateCreated datePublished" datetime="2018-07-12T14:26:01+08:00">2018-07-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-28 00:59:34" itemprop="dateModified" datetime="2019-02-28T00:59:34+08:00">2019-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">Web开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1. 参考整理自Michael Aranda的文章What’s the difference
between JavaScript and ECMAScript?</p>
</blockquote>
<h2 id="概念解释">概念解释</h2>
<h3
id="ecma-internationaleuropean-computer-manufacturers-association">Ecma
International(European Computer Manufacturers Association)</h3>
<ol type="1">
<li><p>一个为科学技术制定标准的组织。</p></li>
<li><p>为了要举一个“标准”的例子，可以用我们曾用过的键盘来说明。是不是大多数的字母以同样的顺序排列，有一个空格键、一个输入键、箭头键，并将数字显示在最上面的一行?这是由于大多数键盘制造商的键盘设计是基于<code>QWERTY</code>布局标准的。</p></li>
<li><p>ECMA-262：由Ecma
International发布的标准。它包含通用目的的脚本语言的规范。</p>
<figure>
<img src="http://qiniup.louyanspine.com/2018-07-12-ECMA-262.png"
alt="ECMA-262" />
<figcaption aria-hidden="true">ECMA-262</figcaption>
</figure>
<ul>
<li><p><code>ECMA-262</code>是一个类似<code>QWERTY</code>的标准，但不同于呈现一个键盘层的规范，它呈现了被称为<code>ECMAScript</code>的脚本语言规范。</p></li>
<li><p>可以把<code>ECMA-262</code>当做<code>ECMAScript</code>参考数字</p></li>
</ul>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-12-%E5%8F%AF%E4%BB%A5%E6%8A%8AECMA-262%20%E5%BD%93%E5%81%9AECMAScript%E7%9A%84%E5%8F%82%E8%80%83%E6%95%B0%E5%AD%97.png"
alt="可以把ECMA-262 当做ECMAScript的参考数字" />
<figcaption aria-hidden="true">可以把ECMA-262
当做ECMAScript的参考数字</figcaption>
</figure></li>
</ol>
<h3 id="脚本语言a-scripting-language">脚本语言(A scripting
language)</h3>
<p>A programming language designed specifically for acting on an
existing entity or system</p>
<p>什么样的编程语言是脚本语言？请思考下命令“walk”、“run” 和
“jump”。这些操作需要一些东西来执行，可能是一个人、一条狗或一个视频游戏角色。如果没有东西来执行这些命令，“walk”、“run”
和 “jump”
是没有意义的。这组操作类似于脚本语言，即专注于操纵外部实体。</p>
<h3
id="ecmascriptecmascript规范ecmascript-specification">ECMAScript/ECMAScript规范(ECMAScript
specification)</h3>
<p>ECMA-262中定义的标准，是用于创建通用目的脚本语言。ECMA-262是标准的名称，它代表了脚本语言规范ECMAScript。</p>
<p>ECMAScript提供脚本语言必须遵守的规则、细节和准则，这些才是其被视为兼容ECMAScript的判断标准。</p>
<h3 id="javascript">JavaScript</h3>
<p>一种通用目的的脚本语言，遵循<code>ECMAScript</code>规范。它是<code>ECMAScript</code>语言的一个分支版本。</p>
<p>通过阅读<code>ECMAScript</code>规范，你将学会如何创建脚本语言。通过阅读
JavaScript文档，你将学习如何使用脚本语言。</p>
<p>当人们把JavaScript称为“ECMAScript语言的方言”的时候，他们的意思就像谈论英语、法语或者中国方言时一样。一种方言从其母语中衍生出大部分的词汇和语法，但偏离得值得保留这些差异。</p>
<p>JavaScript实现了多数ECMA-262中描述的<code>ECMAScript</code>规范，但存在少数差异。
Mozilla在此概述了JavaScript的非ECMAScript语言功能：</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-12-JavaScript%E7%9A%84%E9%9D%9EECMAScript%E8%AF%AD%E8%A8%80%E5%8A%9F%E8%83%BD.png"
alt="JavaScript的非ECMAScript语言功能" />
<figcaption
aria-hidden="true">JavaScript的非ECMAScript语言功能</figcaption>
</figure>
<h3
id="javascript引擎a-javascript-enginejavascript-interpreter解释器javascript-implementation实现">JavaScript引擎(A
JavaScript engine)/JavaScript interpreter解释器/JavaScript
implementation实现</h3>
<p>能够理解和执行JavaScript代码的程序或解释器。</p>
<p>JavaScript引擎通常可以在Web浏览器中被发现，包括Chrome中的
<code>V8</code>，火狐中的<code>SpiderMonkey</code>，以及Edge中的<code>Chakra</code>。每款引擎就像是一个用于其应用程序的语言模块，可以让其支持某种JavaScript语言的分支。</p>
<p>JavaScript引擎对于浏览器来说就像是人类对语言的理解一样。如果我们重新拿我们日常行为中的“走”、“跑”、“跳”来举例的话，一个
JavaScript引擎是真正能够理解这些动作是何意义的根本机制。</p>
<h3 id="浏览器性能的差异">浏览器性能的差异</h3>
<p>两个人也许会识别“跳”的命令，但是一个人由于理解和对命令的处理比另一个人更快些，也许会比另一个人对命令的反应更快些。类似的是，两个浏览器都可以理解JavaScript代码，但是一个由于其JavaScript引擎实现起来效率更高而运行得更快。</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-12-%E6%B5%8F%E8%A7%88%E5%99%A8.png"
alt="浏览器" />
<figcaption aria-hidden="true">浏览器</figcaption>
</figure>
<h3 id="浏览器支持browser-support的差异">浏览器支持(browser
support)的差异</h3>
<p>再以即使说同样语言的人们之间也会有差异为例。即使许多人讲英语，但是一些人也许懂得他人不懂的某些词、表达式和与语法规则，反之亦然。浏览器也是同样的道理。尽管浏览器的
JavaScript 引擎都理解 JavaScript ，但是某些浏览器会比其他的浏览器对
JavaScript 理解得更好些。在浏览器对 JavaScript
的支持中就存在着这一的差别。</p>
<p>至于说到浏览器支持，人们通常会谈到 “ECMAScript 兼容性(compatibility)”
而非“ JavaScript 兼容性”，尽管 JavaScript 引擎解析和执行的是 JavaScript
。这个问题说起来有点绕，下面的表格可以对其作出解释。</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-12-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%94%AF%E6%8C%81%E7%9A%84%E5%B7%AE%E5%BC%82.png"
alt="浏览器支持(browser support)的差异" />
<figcaption aria-hidden="true">浏览器支持(browser
support)的差异</figcaption>
</figure>
<p>如果你还记得的话，ECMAScript
是一份规定了脚本语言可以看起来像什么的规范。发布一个新的 ECMAScript
版本并不意味着所有现存的 JavaScript
引擎突然就拥有了这些新功能。这取决于负责那款 JavaScript
引擎的团体或组织是否要更新到最新的 ECMAScript
规范并采用其所带来的变化。</p>
<p>因此，开发者倾向于问这样的问题，“这款浏览器支持哪个版本的 ECMAScript
?”或者“这款浏览器支持哪些 ECMAScript 功能?”他们想知道是否
Google、Mozilla 和微软已经开始更新他们浏览器的 JavaScript 引擎了，例如
V8、SpiderMonkey 和 Chakra 是否都已经具有最新的 ECMAScript
中的功能了。</p>
<p><a ref="http://kangax.github.io/compat-table/es6/">ECMASCript
兼容性列表</a>是回答这类问题的绝佳答案参考。</p>
<p>如果新版的 ECMAScript 发布了，JavaScript
引擎不会一下子整合所有的更新。他们会逐渐地加入 ECMAScript
功能，这一点从火狐的 JavaScript 变更记录中可见一斑：</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-12-Firefox%E2%80%99s%20JavaScript%20changelog.png"
alt="Firefox’s JavaScript changelog" />
<figcaption aria-hidden="true">Firefox’s JavaScript
changelog</figcaption>
</figure>
<h3
id="javascript运行时a-javascript-runtime宿主环境host-environment">JavaScript运行时(A
JavaScript runtime)/宿主环境(Host environment)</h3>
<p>The environment in which the JavaScript code runs and is interpreted
by a JavaScript engine.The runtime provides the host objects that
JavaScript can operate on and work with.</p>
<p>The JavaScript runtime is the “existing entity or system” mentioned
in the scripting language definition. Code passes through the JavaScript
engine, and once parsed and understood, an entity or system performs the
interpreted actions. A dog walks, a person runs, a video game character
jumps (or in the case of the above image, wrecks).</p>
<p>Applications make themselves available to JavaScript scripting by
providing “host objects” at runtime. For the client side, the JavaScript
runtime would be the web browser, where host objects like windows and
HTML documents are made available for manipulation. Have you ever worked
with the window or document host objects? The window and document
objects are not actually a part of the core JavaScript language. They
are Web APIs, objects provided by a browser acting as JavaScript’s host
environment. For the server side, the JavaScript runtime is Node.js.
Server-related host objects such as the file system, processes, and
requests are provided in Node.js.</p>
<p>n interesting point: different JavaScript runtimes can share the same
JavaScript engine. V8, for example, is the JavaScript engine used in
both Google Chrome and Node.js — two very different environments.</p>
<h3 id="ecmascript-6">ECMAScript 6</h3>
<ol type="1">
<li>它是 ECMA-262 标准的第六个版本，其特点是对 ECMAScript
规范有着显著的变化和改进。</li>
<li>同义词：ES6、ES2015 和 ECMAScript 2015</li>
<li>这一版的 ECMAScript 将其名字由 ES6 改为了 ES2015 ，这是由于 Ecma
国际决定每年都对 ECMAScript 发布一次。相应地，Ecma
国际也开始基于每年所发布的来命名新版本的 ECMAScript 规范。简而言之， ES6
和 ES2015 是对同一件事情的两个不同的名字。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/06/27/JavaScriptbasic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/27/JavaScriptbasic/" class="post-title-link" itemprop="url">JavaScript笔记（未完）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-27 10:20:48" itemprop="dateCreated datePublished" datetime="2018-06-27T10:20:48+08:00">2018-06-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-28 00:51:58" itemprop="dateModified" datetime="2019-02-28T00:51:58+08:00">2019-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">Web开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>说明<br> 1. 部分参考O'Reilly Media出版的JavaScript Programming_A
Brain-Friendly Guide<br></p>
</blockquote>
<h2 id="一基本概念与简介">一、基本概念与简介</h2>
<h3 id="javascript工作原理">JavaScript工作原理</h3>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-27-JavaScript%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.jpg"
alt="JavaScript工作原理" />
<figcaption aria-hidden="true">JavaScript工作原理</figcaption>
</figure>
<ol type="1">
<li><p>JavaScript最初是解释型的，这意味着浏览器执行(execute)它遇到的每行JavaScript代码。浏览器厂商对现代JavaScript采取即时编译的做法，使其既可获得脚本语言的便利性，又可享受编译型语言的性能。</p>
<blockquote>
<p>编译型语言如C、C++和Java在执行代码前必须进行编译(compile)，编译是将代码转换为适合计算机的表达方式，通常可改善运行阶段的性能。</p>
</blockquote></li>
<li><p>JavaScript的使用范围不仅仅在网页上，还用在各种应用程序（如Photoshop）以及服务器端编程中。<br />
</p></li>
<li><p>使用HTMl和CSS时，两者主要都是声明型的(declarative)，JavaScript负责计算，利用它能在网页中添加行为。</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">语言</th>
<th style="text-align: center;">内容</th>
<th style="text-align: center;">作用</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">HTMl</td>
<td style="text-align: center;">markup标记</td>
<td style="text-align: center;">statements结构</td>
</tr>
<tr class="even">
<td style="text-align: center;">CSS</td>
<td style="text-align: center;">rules规则</td>
<td style="text-align: center;">styles样式</td>
</tr>
<tr class="odd">
<td style="text-align: center;">JavaScript</td>
<td style="text-align: center;">statements语句</td>
<td style="text-align: center;">computation/behavior计算和行为</td>
</tr>
</tbody>
</table></li>
</ol>
<h3 id="如何将javascript代码加入网页">如何将JavaScript代码加入网页</h3>
<p>可在HTML文档中的任何地方使用<code>&lt;script&gt;</code>标签添加JavaScript代码</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-27-%E4%BB%A3%E7%A0%81%E4%BD%8D%E7%BD%AE.jpg"
alt="代码位置" />
<figcaption aria-hidden="true">代码位置</figcaption>
</figure>
<ol type="1">
<li><p>嵌入在<code>&lt;head&gt;</code>里</p></li>
<li><p>嵌入在<code>&lt;body&gt;</code>里</p>
<ul>
<li>浏览器加载网页时，先加载<code>&lt;head&gt;</code>元素内的所有内容，再加载<code>&lt;body&gt;</code>元素。如果将代码放在<code>&lt;head&gt;</code>元素中，用户可能需要等一会儿才能看到网页，而放在<code>&lt;body&gt;</code>元素中，则用户在等待这些代码加载时，就能看到网页的内容。</li>
</ul></li>
<li><p>代码放在独立的文件中，并在<code>&lt;head&gt;</code>元素中链接该文件</p>
<ul>
<li>用<code>&lt;script&gt;</code>标签的src属性来指定JavaScript文件的URL</li>
</ul></li>
<li><p>代码放在独立的文件中，并在<code>&lt;body&gt;</code>元素中链接该文件</p></li>
<li><p><code>&lt;script&gt;</code>元素</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;<span class="title function_">alert</span>(<span class="string">&quot;Hello world!&quot;</span>); </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>type可以省略</li>
</ul>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;myJavaScript.js&quot;&gt;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>引用独立的JavaScript文件时，<code>&lt;script&gt;</code>元素不能包含任何JavaScript代码</li>
</ul></li>
</ol>
<h3 id="section"></h3>
<h2 id="二语法">二、语法</h2>
<h3 id="语法基础">语法基础</h3>
<ol type="1">
<li>每条语句以<code>;</code>结尾</li>
<li>单行注释用<code>//</code>两个斜杠打头</li>
<li>空格不重要</li>
<li>字符串必须使用单引号或者双引号括起，而布尔值<code>true</code>和<code>false</code>则不能</li>
<li>JavaScript区分大小写，故变量名、关键字和函数名等几乎所有一切的大小写都很重要。</li>
</ol>
<h3 id="变量variables和值values">变量Variables和值values</h3>
<ol type="1">
<li><p>JavaScript语句通常包含变量，变量用来存储值（如数字、字符串和布尔值等）</p>
<blockquote>
<p>布尔值无需用引号括起</p>
</blockquote></li>
<li><p>var关键字用来声明变量，声明变量时可以给它赋值，也可以不指定初始值。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var winners = 2;</span><br><span class="line">var losers;</span><br></pre></td></tr></table></figure></p></li>
<li><p>变量名的命名规则和建议</p>
<ul>
<li><p>以字母、下划线或美元符号<code>$</code>开头，后接任意数量的字母，数字，下划线或美元符号<code>$</code>。</p></li>
<li><p>不能使用任何内置的关键字作为变量名。</p></li>
<li><p>不能包含空格和引号。</p></li>
<li><p>推荐使用有意义的变量名，如currentPressure和passedExam</p></li>
<li><p>用多个单词做变量名时通常采用骆驼式拼写法(camel
case)，即将每个单词的首字母大写（第一个单词除外），如：twoHeadedDragonWithFire。</p></li>
<li><p>通常不要用<code>_</code>和<code>$</code>开头的变量名</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-27-%E5%85%B3%E9%94%AE%E5%AD%97.jpg"
alt="关键字" />
<figcaption aria-hidden="true">关键字</figcaption>
</figure>
<blockquote>
<p>关键字keyword：是JavaScript的保留字reserved
word，JavaScript将其用于特殊目的。</p>
</blockquote></li>
</ul></li>
</ol>
<h3 id="表达式expressions">表达式expressions</h3>
<ol type="1">
<li><p>表达式用来计算结果，根据结果的值的不同可以分为数值表达式，字符串表达式，布尔表达式、数组表达式、对象表达式和函数表达式。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">数值表达式 var total = price - (price * (discount / 100));</span><br><span class="line"></span><br><span class="line">字符串表达式 &quot;Dear &quot; + &quot;Reader&quot; + &quot;,&quot;</span><br><span class="line"></span><br><span class="line">布尔表达式 cost &gt;= 3.99</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h3 id="循环">循环</h3>
<ol type="1">
<li><p>while循环</p>
<ul>
<li><p>(scoops &gt;
0)称为条件测试（简称为条件），包含一个布尔表达式</p></li>
<li><p>如果条件测试为true，就执行代码块中所有的代码。如果条件测试为false，就结束循环。</p></li>
<li><p>有些代码的条件是一个变量，其值为字符串而不是布尔值。任何包含非空字符串的变量都被视为<code>true</code>而没有设置值的变量都被视为<code>false</code></p></li>
<li><p>仅使用布尔变量本身时，只要该变量为true，条件测试就为true，进而执行相应的代码块。</p>
<ul>
<li><code>if (inStock)&#123;...&#125;</code>如果inStock为false，条件测试将失败</li>
</ul></li>
<li><p>代码块即用花括号<code>&#123;&#125;</code>括起来的一组语句，代码块中的所有语句被视为一个整体，要么都执行，要么都不执行。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while(scoops &gt; 0)&#123;</span><br><span class="line">	document.write(&quot;Another scoop!&quot;);</span><br><span class="line">	scoops = scoops - 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
<li><p>for循环</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-27-for%E5%BE%AA%E7%8E%AF.jpg"
alt="for循环" />
<figcaption aria-hidden="true">for循环</figcaption>
</figure>
<ul>
<li>for循环以关键字for打头</li>
<li>圆括号中有三部分
<ul>
<li>第一部分是初始化循环变量，初始化只在循环开始前执行一次</li>
<li>第二部分是条件测试，每次循环时都将执行该测试，如果为false就结束循环</li>
<li>第三部分将计数器加1。每次循环都这么做，这是在执行完循环体的所有语句后进行的。</li>
</ul></li>
</ul></li>
<li><p>for in循环</p></li>
<li><p>forEach循环</p></li>
<li><p>do while循环</p>
<ul>
<li>工作原理与while几乎相同，只是先执行循环体中的语句，再检查循环条件。</li>
</ul></li>
<li><p>if语句进行决策</p>
<ul>
<li><p>在if语句中还可以添加一个或多个else
if语句，以执行多重检查。</p></li>
<li><p>还可在最后添加一条else语句，以处理所有条件都不满足的情形。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">	if (scoops &gt;= 5) &#123;	alert(&quot;Eat faster, the ice cream is going to melt!&quot;);&#125; </span><br><span class="line">	</span><br><span class="line">	else if (scoops &lt; 3) &#123;	alert(&quot;Ice cream is running low!&quot;);&#125;</span><br><span class="line">	</span><br><span class="line">	else &#123;</span><br><span class="line">		alert(&quot;Still lots of ice cream left, come and get it.&quot;); </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
</ol>
<h3 id="与用户交互的常见方式">与用户交互的常见方式</h3>
<ol type="1">
<li><p>创建提醒框</p>
<ul>
<li>调用函数alert()创建包含消息的提醒框</li>
<li>仅当你要停止一切并提醒用户时，才应使用它</li>
</ul></li>
<li><p>直接写入文档</p>
<ul>
<li>调用函数document.write()将任何HTML和内容写入网页</li>
</ul></li>
<li><p>使用控制台console</p>
<ul>
<li>调用函数console.log()，并传入要写入的字符串</li>
<li>可将console.log()视为杰出的故障排除工具</li>
<li>console实际是一个对象，而log则是console的一个方法</li>
<li>仅用于在开发网页期间调试代码troubleshoot，用户可能根本看不到控制台</li>
<li>可将控制台视为具有特定功能的对象，其功能之一是写入日志，其语法为console.log，并将用圆括号括起的输出传递给它。</li>
<li>如何打开控制台？</li>
</ul>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-27-%E5%A6%82%E4%BD%95%E6%89%93%E5%BC%80%E6%8E%A7%E5%88%B6%E5%8F%B0.jpg"
alt="如何打开控制台" />
<figcaption aria-hidden="true">如何打开控制台</figcaption>
</figure></li>
<li><p>直接操作文档</p>
<ul>
<li>利用文档对象模型（document object model,DOM）操作文档</li>
</ul></li>
<li><p>获取用户输入</p>
<ul>
<li>函数prompt()用于获取用户输入，它会弹出一个简单的对话框，包含传入该函数的字符串参数并且返回用户输入的字符串值。如果用户取消了对话框或没有输入任何响应，返回的将是null（表示没有值）。</li>
</ul></li>
<li><p>显示输出</p>
<ul>
<li>函数alert()</li>
</ul></li>
</ol>
<h3 id="section-1"></h3>
<h2 id="三函数">三、函数</h2>
<h3 id="常用函数">常用函数</h3>
<ol type="1">
<li><p>Math.random()用来生成[0, 1)的随机数</p>
<blockquote>
<p>只要调用函数，都需要使用括号()</p>
</blockquote></li>
<li><p>Math.floor()用来对一个小数取整（直接舍弃小数位），即向下化整</p></li>
</ol>
<h3 id="函数语法">函数语法</h3>
<ol type="1">
<li><p>定义函数/声明函数</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function functionname(parameter1,parameter2) &#123;</span><br><span class="line">	这里是要执行的代码</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure> <img
src="http://qiniup.louyanspine.com/2018-06-27-%E5%87%BD%E6%95%B0%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86.jpg"
alt="函数组成部分" /></p>
<ul>
<li>以关键词function打头，接下来指定函数名。函数名的命名规则与变量命名规则一样。</li>
<li>parameters为函数的形参，将其放在函数名后面的括号内，将在调用函数时，给形参赋值</li>
<li><code>&#123;&#125;</code>之间的内容被称为函数体(the body of the function)</li>
</ul></li>
<li><p>调用带参数的函数</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myFunction(argument1,argument2)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>argument为实参，调用函数时，传给函数的实参的值被赋给相应的形参</li>
<li>可以通过实参传递任何JavaScript值，如字符串、布尔值、数字、变量甚至表达式（对于表达式，先计算它的值，再将值传递给函数）。</li>
</ul></li>
<li><p>函数表达式(statement)</p>
<ul>
<li><p>没有函数名称，且位于一条赋值语句的右边，被赋给一个变量，是一个指向函数的引用。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var fly = function(num) &#123;</span><br><span class="line">	for (var i = 0; i &lt; num; i++) &#123;</span><br><span class="line">		console.log(&quot;Flying!&quot;); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">fly(3);</span><br><span class="line"># 通过变量fly来调用函数</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
<li><p>函数声明和函数表达式之间的区别</p>
<ul>
<li>在分析(parses)
网页期间（执行任何代码之前），浏览器查找函数声明，找到函数声明时，浏览器创建相应的函数，并将得到的函数引用赋给与函数同名的变量。在处理完所有的函数声明后，浏览器回到代码开头，开始按从头到尾的顺序执行代码。换言之，使用函数声明时，函数将在执行代码前创建，而使用函数表达式时，函数将在运行阶段执行代码时创建。</li>
<li>函数声明是完整的语句，而函数表达式只是语句的一部分。可以认为函数声明包含一条隐藏的赋值语句，这条语句将函数引用赋给一个变量。</li>
<li>函数表达式返回一个引用，该引用指向函数表达式创建的函数。</li>
</ul></li>
</ol>
<h3 id="按值传递实参pass-by-value">按值传递实参(pass-by-value)</h3>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-27-%E6%8C%89%E5%80%BC%E4%BC%A0%E9%80%92%E5%AE%9E%E5%8F%82-pass-by-value-.jpg"
alt="按值传递实参" />
<figcaption aria-hidden="true">按值传递实参</figcaption>
</figure>
<ol type="1">
<li>即把每个实参的值复制给形参，其意义在于，在函数中修改形参的值时，只会影响形参，而不会影响传递给函数的变量。</li>
<li>在函数中处理形参时，其影响范围将限制在函数中。</li>
</ol>
<h3 id="错误地调用函数">错误地调用函数</h3>
<ol type="1">
<li>传入的实参不够：将没有相应实参的形参设置为未定义undefined</li>
<li>传入的实参太多：将忽略多余的实参</li>
</ol>
<h3 id="函数可返回值return">函数可返回值return</h3>
<ol type="1">
<li>函数体中遇到return语句，函数会直接返回return语句中的值，并停止函数运行，哪怕return语句之后还有语句。</li>
<li>如果return语句没有指定值（空的），则返回undefined。</li>
<li>如果一个函数没有return语句，则它的返回值是undefined。</li>
</ol>
<h3 id="作用域scope">作用域(scope)</h3>
<ol type="1">
<li>全局变量
<ul>
<li>在函数外使用关键字var声明。</li>
<li>只有一个全局作用域，也就是说不同的JavaScript脚本共享同一个全局作用域。如果在网页链接到了其他的脚本，这些脚本也能够看到这些全局变量，而你也可以看到它们的全局变量。</li>
<li>全局变量的寿命和网页一样长。重新加载网页时，将销毁并重新创建所有的全局变量。</li>
<li>使用没有关键字var声明的变量，会被自动视为全局变量，即使在函数中首次使用它，亦如此。</li>
</ul></li>
<li>局部变量
<ul>
<li>在函数中声明的变量叫局部变量，这样的变量只在函数中可见，也只能用在函数中</li>
<li>局部变量是在函数被调用后创建的，并一直活到函数返回（无论函数是否返回值）</li>
<li>如果局部变量使用了与全局变量相同的变量名，那么在这个局部作用域中，全局变量是不可见的。即同名局部变量遮住(shadow)了全局变量</li>
<li>将函数作为实参传递给另一个函数时，传入的函数引用将被复制到所调用函数的一个形参变量中，与其他形参一样，存储函数引用的形参也是局部变量。</li>
</ul></li>
<li>变量提升
<ul>
<li><p>JavaScript引擎会在正式执行之前先进行一次预编译，在这个过程中，首先将变量声明提升至当前作用域的顶端，然后进行接下来的处理。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var foo = 3;</span><br><span class="line"></span><br><span class="line">function hoistVariable() &#123;</span><br><span class="line"></span><br><span class="line">    var foo = foo || 5;</span><br><span class="line"></span><br><span class="line">    console.log(foo); // 5</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hoistVariable();</span><br></pre></td></tr></table></figure> 预编译之后的代码逻辑是这样的：</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var foo = 3;</span><br><span class="line"></span><br><span class="line">//预编译之后</span><br><span class="line"></span><br><span class="line">function hoistVariable() &#123;</span><br><span class="line">  		var foo;</span><br><span class="line"></span><br><span class="line">  		foo = foo || 5;</span><br><span class="line"></span><br><span class="line">  		console.log(foo); // 5</span><br><span class="line">  	&#125;</span><br><span class="line">  	</span><br><span class="line">  	hoistVariable();</span><br><span class="line">  	</span><br><span class="line">  	#只要“||”前面为true,不管“||”后面是true还是false，都返回“||”前面的值。</span><br><span class="line">  	#只要“||”前面为false,不管“||”后面是true还是false，都返回“||”后面的值。</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
<li>全局函数
<ul>
<li>在代码顶层定义的函数</li>
</ul></li>
<li>局部函数
<ul>
<li>在函数中定义的函数(nested，嵌套)</li>
<li>在函数内部，如果你使用函数声明创建了一个嵌套函数，那么在这个函数的函数体的任何地方，嵌套函数都是已定义的；</li>
<li>如果使用函数表达式创建了一个嵌套函数，则在这个函数的函数体内，仅当函数表达式执行后，嵌套函数才是已定义的。</li>
</ul></li>
<li>词法作用域(lexical scope)的工作原理
<ul>
<li><p>词法(lexical)意味着只需查看代码的结构就可确定变量的作用域，而不是等到代码执行时才明白。换而言之，即JavaScript的作用域规则完全基于代码的结构，而不是一些动态的运行阶段属性。</p></li>
<li><p>因此，对于在函数中引用的变量，要确定它是在哪里定义的，可从最里面（当前函数）开始依次向最外面进行查找，直到找到它为止。</p></li>
<li><p>实例</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#实例1 </span><br><span class="line"></span><br><span class="line">var justAVar = &quot;Oh, don&#x27;t you worry about it, I&#x27;m GLOBAL&quot;;</span><br><span class="line">	</span><br><span class="line">function whereAreYou() &#123;</span><br><span class="line">	var justAVar = &quot;Just an every day LOCAL&quot;;</span><br><span class="line">	return justAVar;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var result = whereAreYou(); </span><br><span class="line">console.log(result);</span><br><span class="line"></span><br><span class="line">#显示Just an every day LOCAL</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#实例2</span><br><span class="line"></span><br><span class="line">var justAVar = &quot;Oh, don&#x27;t you worry about it, I&#x27;m GLOBAL&quot;;</span><br><span class="line">	</span><br><span class="line">function whereAreYou() &#123;</span><br><span class="line">	var justAVar = &quot;Just an every day LOCAL&quot;;</span><br><span class="line">		</span><br><span class="line">function inner() &#123;</span><br><span class="line">	return justAVar;</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">		 return inner();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		var result = whereAreYou(); </span><br><span class="line">		console.log(result);</span><br><span class="line">		</span><br><span class="line">		#显示Just an every day LOCAL</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#实例3</span><br><span class="line"></span><br><span class="line">var justAVar = &quot;Oh, don&#x27;t you worry about it, I&#x27;m GLOBAL&quot;;</span><br><span class="line"></span><br><span class="line">function whereAreYou() &#123;</span><br><span class="line">		var justAVar = &quot;Just an every day LOCAL&quot;;</span><br><span class="line">		</span><br><span class="line">		function inner() &#123; </span><br><span class="line">				return justAVar;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		return inner;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">var innerFunction = whereAreYou(); </span><br><span class="line">var result = innerFunction();</span><br><span class="line">	</span><br><span class="line">console.log(result);</span><br><span class="line">	</span><br><span class="line">#显示Just an every day LOCAL</span><br></pre></td></tr></table></figure></p></li>
<li><p>环境(environment)存储了局部作用域内定义的所有变量。每个函数都有与之相关联的环境，其中包含它所处作用域内的局部变量。当返回这个函数时，返回的不仅仅是函数，还有与之相关联的环境。</p>
<ul>
<li>每个嵌套函数都有自己的小环境，其中包含它自己的变量，这将形成一个环境链，从内到外依次为各个嵌套函数的环境。在环境中查找变量时，也需要从最近的环境着手，沿环境链不断往下查找，直到找到变量为止。如果环境链中没有找到，再在全局环境中查找。</li>
<li>可将形参视为函数的局部变量，因此形参也包含在环境(environment)中。</li>
<li>JavaScript函数都是在定义它的环境中执行的。</li>
</ul>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-06-%E7%8E%AF%E5%A2%83.jpg"
alt="环境" />
<figcaption aria-hidden="true">环境</figcaption>
</figure></li>
</ul></li>
</ol>
<h3 id="闭包closure">闭包(closure)</h3>
<ol type="1">
<li><p>闭包(closure) 的定义：闭包指的是函数和引用环境。</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-06-%E9%97%AD%E5%8C%85.jpg"
alt="闭包" />
<figcaption aria-hidden="true">闭包</figcaption>
</figure></li>
<li><p>自由变量(free
variables)的定义：不在本地作用域内定义的变量。</p></li>
<li><p>可敲定函数(closes the
function)的定义：给所有自由变量都提供了值的环境。</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-06-%E6%95%B2%E5%AE%9A%E5%87%BD%E6%95%B0.jpg"
alt="敲定函数" />
<figcaption aria-hidden="true">敲定函数</figcaption>
</figure></li>
<li><p>从函数返回函数来创建闭包：计数器实例</p>
<ul>
<li><p>在全局作用域中，根本看不到变量count，但每次调用doCount时，都可以使用变量count。</p></li>
<li><p>除了调用doCount外，没有其他任何办法能够获取变量count。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function makeCounter() &#123;</span><br><span class="line">	 var count = 0;</span><br><span class="line">	</span><br><span class="line">	function counter() &#123; </span><br><span class="line">		count = count + 1; </span><br><span class="line">		return count;	&#125;</span><br><span class="line"></span><br><span class="line">	return counter; </span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line">var doCount = makeCounter(); </span><br><span class="line">console.log(doCount());  #显示1</span><br><span class="line">console.log(doCount());  #显示2</span><br><span class="line">console.log(doCount());  #显示3</span><br></pre></td></tr></table></figure></p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-06-%E9%97%AD%E5%8C%85-%E8%AE%A1%E6%95%B0%E5%99%A8.jpg"
alt="闭包-计数器" />
<figcaption aria-hidden="true">闭包-计数器</figcaption>
</figure></li>
</ul></li>
<li><p>将函数表达式用作实参来创建闭包</p>
<ul>
<li><p>我们传递给makeTimer的函数是一个闭包，带有将自由变量<code>doneMessage</code>绑定到字符串"Cookies
are done!"的环境。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function makeTimer(doneMessage, n) &#123;</span><br><span class="line">	</span><br><span class="line">	setTimeout(function() &#123; </span><br><span class="line">		alert(doneMessage);</span><br><span class="line">	&#125;, n); </span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line">makeTimer(&quot;Cookies are done!&quot;, 1000);</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
<li><p>闭包包含的是实际环境，而非环境的副本</p>
<ul>
<li>环境引用的是实时变量，如果闭包函数外面的代码修改了变量，闭包函数执行时看到的将是变量的新值</li>
</ul></li>
</ol>
<h3 id="函数提升">函数提升</h3>
<ol type="1">
<li><p>浏览器分两遍读取网页：</p>
<ul>
<li>第一遍读取所有的函数定义（由函数声明创建的函数）</li>
<li>第二遍开始执行代码</li>
</ul></li>
<li><p>可将函数放在JavaScript脚本的任何地方。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var radius = 5;</span><br><span class="line">var area = circleArea(radius); </span><br><span class="line">alert(area);</span><br><span class="line"></span><br><span class="line">function circleArea(r) &#123; </span><br><span class="line">	var a = Math.PI * r * r; </span><br><span class="line">	return a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h3 id="函数是一等值first-class-values">函数是一等值(first class
values)</h3>
<ol type="1">
<li><p>一等值(first class
values)的特点（数值、字符串、布尔值、函数和对象都是一等值）</p>
<ul>
<li>将其赋给变量或存储在数组和对象等数据结构中</li>
<li>将其传递给函数</li>
<li>从函数中返回它们</li>
</ul></li>
<li><p>一等值的定义：在编程语言中，可像对待其他任何值一样对待的值，包括赋给变量、作为实参传递给函数以及从函数中返回。</p></li>
<li><p>向函数传递函数</p>
<ul>
<li><p>只需将函数名用作实参即可</p></li>
<li><p>传递的是指向函数的引用，可将这种引用视为指针(pointer)，它指向函数本身的内部表示。引用本身可存储在变量中，可赋给变量，还可作为实参传递给函数。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var allCanFly = processPassengers(passengers, checkNoFlyList); </span><br><span class="line">if (!allCanFly) &#123;console.log(&quot;The plane can&#x27;t take off: we have a passenger on the no-fly-list.&quot;); </span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line">#checkNoFlyList即传入的函数</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
<li><p>从函数返回函数</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function createDrinkOrder(passenger) &#123;</span><br><span class="line">	var orderFunction;</span><br><span class="line"></span><br><span class="line">	if (passenger.ticket === &quot;firstclass&quot;) &#123;</span><br><span class="line">		orderFunction = function() &#123;</span><br><span class="line">			alert(&quot;Would you like a cocktail or wine?&quot;);</span><br><span class="line">		&#125;;</span><br><span class="line">	</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		orderFunction = function() &#123;</span><br><span class="line">			alert(&quot;Your choice is cola or water.&quot;);</span><br><span class="line">			&#125;;		&#125;	return orderFunction;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h3 id="匿名函数anonymous-functions">匿名函数(anonymous functions)</h3>
<ol type="1">
<li><p>匿名函数是没有名称的函数表达式，用于通常需要函数引用的地方。</p>
<p><code>window.onload = function() &#123; alert("Yeah, that page loaded!"); &#125;;</code></p>
<ul>
<li>如果需要将一个函数作为实参，可将实参指定为函数表达式
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(function() &#123;</span><br><span class="line">	alert(&quot;Time to take the cookies out of the oven&quot;);</span><br><span class="line">	&#125;, 600000);</span><br></pre></td></tr></table></figure></li>
<li>如果需要从函数返回一个函数，也可返回一个函数表达式</li>
</ul></li>
</ol>
<h2 id="四数据结构">四、数据结构</h2>
<h3 id="数组arrays">数组(Arrays)</h3>
<ol type="1">
<li><p>创建数组</p>
<ul>
<li><p>用数组的字面量(array
literal)创建数组（即详细地指定了该数组包含的元素）</p>
<p><code>var flavors = ["vanilla", "butterscotch", "lavender", "chocolate", "cookie dough"];</code></p>
<ul>
<li>在<code>[]</code>中依次输入每个数据，用<code>,</code>隔开即可。</li>
<li>数组中每一项的数据类型可以是任意的，字符串，布尔值，数值，甚至数组，函数和对象都可以。</li>
<li>数据的个数也没有限制，但受制于计算机内存。</li>
<li>不要求一个数组中所有值的类型都相同。</li>
</ul></li>
</ul></li>
<li><p>访问数组元素</p>
<p><code>var flavorOfTheDay = flavors[2];</code></p>
<ul>
<li><code>[]</code>中的数字表示数组的索引位置，数组的索引从0开始</li>
</ul></li>
<li><p>修改数组元素</p>
<p><code>flavors[3] = "vanilla chocolate chip";</code></p></li>
<li><p>确定数组的长度</p>
<p><code>var numFlavors = flavors.length;</code></p>
<ul>
<li>每个数组都有一个length属性，它的值也就是数组的长度，等于数组的最大索引值+1</li>
</ul></li>
<li><p>给数组添加新元素</p>
<ul>
<li><p>只需给指定索引处的元素赋值即可，但必须小心地指定索引，否则数组将是稀疏的(sparse)</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var genres = []; </span><br><span class="line">genres[0] = &quot;Rockabilly&quot;; </span><br><span class="line">genres[1] = &quot;Ambient&quot;; </span><br><span class="line">var size = genres.length;</span><br></pre></td></tr></table></figure></p></li>
<li><p>稀疏数组是指有些索引处有值，而其他索引处没有值的数组。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var sparseArray = [ ]; </span><br><span class="line">sparseArray[0] = true; </span><br><span class="line">spraseArray[100] = true;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>犹如创建了99个变量，但没有对其初始化。这些变量虽然没有值，但是仍占用计算机的内存空间。</p></li>
<li><p>检查元素的值是否是undefined，可编写如下代码：</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (myarray[i] == undefined) &#123;</span><br><span class="line">	...</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p>undefined是一个值，而不是字符串，因此不能在前后加上引号。</p></li>
</ul></li>
<li><p>push方法</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var genres = []; </span><br><span class="line">genres.push(&quot;Rockabilly&quot;); </span><br><span class="line">genres.push(&quot;Ambient&quot;);</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
<li><p>平行数组(parallel arrays)</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-27-%E5%B9%B3%E8%A1%8C%E6%95%B0%E7%BB%84.jpg"
alt="平行数组" />
<figcaption aria-hidden="true">平行数组</figcaption>
</figure></li>
<li><p>数组方法<code>sort</code>的工作原理</p>
<ul>
<li><p>根据一个知道如何对两个数组元素进行比较的函数对数组进行排序。</p>
<ul>
<li>对于数字，使用<code>&lt;</code>、<code>&gt;</code>、和<code>==</code>进行比较；</li>
<li>对于字符串，按字母顺序进行比较</li>
<li>对于对象，采用自定义的方式根据对象的属性进行比较</li>
</ul></li>
<li><p><code>sort</code>方法要求我们的函数在第一个数字大于第二个数字时返回一个大于0的值，在它们相等时返回0，并在第一个数字小于第二个数字时返回一个小于0的值。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function compareNumbers(num1, num2) &#123; </span><br><span class="line">	if (num1 &gt; num2) &#123;</span><br><span class="line">		return 1;</span><br><span class="line">&#125; else if (num1 === num2) &#123;</span><br><span class="line">	return 0;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">	return -1; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">numbersArray.sort(compareNumbers);</span><br></pre></td></tr></table></figure></p></li>
<li><p><code>sort</code>方法是破坏性的，将就地修改数组，而不是返回一个排序后的新数组。</p></li>
</ul></li>
</ol>
<h3 id="section-2"></h3>
<h3 id="section-3"></h3>
<h3 id="section-4"></h3>
<h2 id="五对象objects">五、对象(Objects)</h2>
<h3 id="创建对象">创建对象</h3>
<ol type="1">
<li>定义并创建对象的实例
<ul>
<li><p>添加对象变量声明</p></li>
<li><p>花括号<code>&#123;&#125;</code>内定义对象的所有属性(properties)</p></li>
<li><p>每个属性的定义都包含名称、冒号和值，用逗号分隔属性名和属性值对，冒号分隔属性名和属性值。</p></li>
<li><p>包含空格的字符串用作属性名时，必须用括号将其括起</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var widget = &#123; </span><br><span class="line">	cost$: 3.14,</span><br><span class="line">	&quot;on sale&quot;: true</span><br><span class="line">	&#125;;</span><br></pre></td></tr></table></figure></p></li>
<li><p>属性名可以是任何字符，但通常遵循变量命名规则</p></li>
<li><p>对象变量声明也以分号结束</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">		var chevy = &#123;</span><br><span class="line">			make: &quot;Chevy&quot;,</span><br><span class="line">			model: &quot;Bel Air&quot;, </span><br><span class="line">			year: 1957,</span><br><span class="line">			color: &quot;red&quot;, </span><br><span class="line">			passengers: 2, </span><br><span class="line">			convertible: false, </span><br><span class="line">			mileage: 1021&#125;;</span><br></pre></td></tr></table></figure></p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-27-%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1.png"
alt="创建对象" />
<figcaption aria-hidden="true">创建对象</figcaption>
</figure></li>
</ul></li>
</ol>
<h3 id="属性的工作原理">属性的工作原理</h3>
<ol type="1">
<li><p>访问属性(access a property)</p>
<ul>
<li><p>句点表示法(dot notation)</p>
<p><code>fiat.mileage</code></p></li>
<li><p>串接(chaining)</p>
<p><code>var index = ship.locations.indexOf(guess);</code></p></li>
<li><p>方括号表示法(bracket notation)</p>
<ul>
<li><code>chevy["color"]</code></li>
<li><code>chevy["co" + "lor"]</code>
<ul>
<li>可将任何表达式放在方括号内，只要其结果为表示属性名的字符串即可</li>
</ul></li>
</ul></li>
<li><p>访问不存在的属性</p>
<p><code>if (fiat.make) &#123; ... &#125;</code></p>
<p><code>fiat.make</code>的结果将为<code>undefined</code></p></li>
</ul></li>
<li><p>修改属性</p>
<p><code>fiat.mileage = 10000;</code></p></li>
<li><p>添加新属性</p>
<p><code>fiat.needsWashing = true;</code></p></li>
<li><p>将属性用于计算</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (fiat.year &lt; 1965) &#123; </span><br><span class="line">	classic = true;</span><br><span class="line">	&#125;for (var i = 0; i &lt; fiat.passengers; i++) &#123;</span><br><span class="line">	addPersonToCar(); </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p>增删属性</p>
<ul>
<li>增加属性，只指定一个新属性并给它赋值</li>
<li>删除属性，可使用关键词delete：<code>delete fido.dogYears;</code>
<ul>
<li>删除属性时，同时删除属性值和属性本身</li>
<li>成功删除属性，delete表达式返回true</li>
<li>当属性无法删除时，delete表达式返回false</li>
<li>如某个对象属于浏览器而受到保护</li>
<li>即便你要删除的属性在对象中不存在，delete表达式仍返回true</li>
</ul></li>
</ul></li>
</ol>
<h3 id="变量存储对象的原理">变量存储对象的原理</h3>
<ol type="1">
<li><p>变量并不实际存储对象</p></li>
<li><p>变量存储指向对象的引用(reference)，故此对象变量也被称为引用变量(reference
variables)</p></li>
<li><p>引用就像指针(pointer)，是对象的存储地址</p></li>
<li><p>当我们使用句点表示法时，JavaScript解释器将负责根据引用获取对象并访问其属性</p></li>
<li><p>基本类型变量(primitive variable)表示的是实际值，而对象变量(object
variable)表示一种获取对象的途径</p></li>
<li><p>当使用句点表示法用于引用变量时，相当于使用句点前的引用来获取相应的对象，再访问句点后指定的属性。</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-27-%E5%8F%98%E9%87%8F%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%BC%95%E7%94%A8.jpg"
alt="变量存储对象的引用" />
<figcaption aria-hidden="true">变量存储对象的引用</figcaption>
</figure></li>
</ol>
<h3 id="向函数传递对象">向函数传递对象</h3>
<ol type="1">
<li><p>调用函数并向它传递一个对象时，传递的是对象引用，而不是对象本身。根据按值传递的语义，传递给形参的是改引用的副本，而原来的引用依然是指向原始对象的指针。</p></li>
<li><p>如果在函数中修改对象属性，修改的将是原始对象的属性。因此，函数结束时，在函数中对对象所做的修改都依然有效。</p>
<p><img
src="http://qiniup.louyanspine.com/2018-06-27-%E5%90%91%E5%87%BD%E6%95%B0%E4%BC%A0%E9%80%92%E5%AF%B9%E8%B1%A1.jpg" />
<img
src="http://qiniup.louyanspine.com/2018-06-27-%E5%90%91%E5%87%BD%E6%95%B0%E4%BC%A0%E9%80%92%E5%AF%B9%E8%B1%A12.jpg" /></p></li>
</ol>
<h3 id="给对象添加行为">给对象添加行为</h3>
<ol type="1">
<li><p>给对象添加行为,就是将函数定义赋给属性。在函数定义中没有指定函数名，而只是在关键词后面提供了函数体，属性名就是函数名。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var fiat = &#123; </span><br><span class="line">	make: &quot;Fiat&quot;,</span><br><span class="line">	model: &quot;500&quot;,</span><br><span class="line">	year: 1957,</span><br><span class="line">	color: &quot;Medium Blue&quot;, </span><br><span class="line">	passengers: 2, </span><br><span class="line">	convertible: false, </span><br><span class="line">	mileage: 88000,</span><br><span class="line">	drive: function() &#123;</span><br><span class="line">		alert.log(&quot;Zoom zoom!&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p></li>
<li><p>对象内的函数，通常被称为方法(method)。</p></li>
<li><p>用句点法（串联，chaining）调用对象内的方法。</p>
<ul>
<li><code>fiat.drive();</code></li>
<li><code>var index = ship.locations.indexOf(guess);</code></li>
</ul></li>
</ol>
<h3 id="关键词this的工作原理">关键词<code>this</code>的工作原理</h3>
<ol type="1">
<li>可将<code>this</code>视为一个变量，指向其方法被调用的对象。 <img
src="http://qiniup.louyanspine.com/2018-06-28-this%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.jpg" />
<img
src="http://qiniup.louyanspine.com/2018-06-28-this%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%862.jpg" /></li>
</ol>
<h3 id="如何知道对象包含哪些属性">如何知道对象包含哪些属性</h3>
<ol type="1">
<li>用<code>for in</code>迭代对象的属性
<ul>
<li><code>for in</code>以每次一个的方式遍历对象的属性，并依次将每个属性赋给变量prop</li>
<li>用方括号表示法通过prop来访问当前属性</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (var prop in chevy) &#123;</span><br><span class="line">	console.log(prop + &quot;: &quot; + chevy[prop]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="javascript提供的内置对象">JavaScript提供的内置对象</h3>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-28-JavaScript%E6%8F%90%E4%BE%9B%E7%9A%84%E5%AF%B9%E8%B1%A1.jpg"
alt="JavaScript提供的对象" />
<figcaption aria-hidden="true">JavaScript提供的对象</figcaption>
</figure>
<h3 id="字符串对象">字符串对象</h3>
<ol type="1">
<li>属性<code>length</code>：指出字符串包含多少个字符</li>
<li>方法<code>charAt</code>：获取字符串中指定索引处的字符。
<ul>
<li>JavaScript没有字符类型(character
type)，通过返回一个字符串来返回字符，其中只包含特点的字符</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var input = &quot;jenny@wickedlysmart.com&quot;; </span><br><span class="line">for(var i = 0; i &lt; input.length; i++) &#123;</span><br><span class="line">	if (input.charAt(i) === &quot;@&quot;) &#123;</span><br><span class="line">		console.log(&quot;There&#x27;s an @ sign at index &quot; + i);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>方法<code>indexOf</code>
<ul>
<li><p>将一个字符串作为第一个参数，并在字符串中该参数首次出现的位置返回该参数中第一个字符的索引</p></li>
<li><p>第二个参数是一个索引，指定从什么位置开始查找</p></li>
<li><p>如果没有找到指定的字符串，将返回索引-1</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index = phrase.indexOf(&quot;the&quot;, 5);</span><br><span class="line">console.log(&quot;there&#x27;s a the sitting at index &quot; + index);</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
<li>方法<code>substring</code>
<ul>
<li><p>将两个索引作为参数，提取并返回这两个索引之间的子串</p>
<p><code>var val = data.substring(5, 10);</code></p>
<blockquote>
<p>返回从索引5到索引10（不包括）的子串</p>
</blockquote></li>
<li><p>可以省略第二个参数，在这种情况下，<code>substring</code>将提取从指定索引到字符串末尾的子串。</p></li>
</ul></li>
<li>方法<code>split</code>
<ul>
<li><p>将一个用作分隔符(delimiter)的字符作为参数，并根据这个分隔符将字符串分成多个部分。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var data = &quot;name|phone|address&quot;;</span><br><span class="line">var vals = data.split(&quot;|&quot;); </span><br><span class="line">console.log(&quot;Split array is &quot;, vals);</span><br><span class="line">	</span><br><span class="line">//Split array is [&quot;name&quot;, &quot;phone&quot;, &quot;address&quot;]</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
<li>方法<code>toLowerCase</code>
<ul>
<li>将字符串中的所有大写字符都转换为小写，并返回结果。</li>
</ul></li>
<li>方法<code>slice</code>
<ul>
<li>删除字符串的一部分，并返回结果。</li>
</ul></li>
<li>方法<code>lastIndexOf</code>
<ul>
<li>查找最后一个子串</li>
</ul></li>
<li>方法<code>match</code>
<ul>
<li>查找与正则表达式匹配的子串</li>
</ul></li>
<li>方法<code>trim</code>
<ul>
<li>删除字符串开头和末尾的空白字符</li>
</ul></li>
<li>方法<code>replace</code>
<ul>
<li>查找子串并将其替换为另一个字符串</li>
</ul></li>
<li>方法<code>concat</code>
<ul>
<li>将字符串拼接起来</li>
</ul></li>
<li>方法<code>toUpperCase</code>
<ul>
<li>将字符串中的所有小写字符都转换为大写，并返回结果。</li>
</ul></li>
</ol>
<h2
id="六浏览器与文档对象模型document-object-modeldom">六、浏览器与文档对象模型(document
object model,DOM)</h2>
<h3
id="网页与javascript通过文档对象模型dom交互">网页与JavaScript通过文档对象模型（DOM）交互</h3>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-28-DOM%E6%A8%A1%E5%9E%8B.jpg"
alt="DOM模型" />
<figcaption aria-hidden="true">DOM模型</figcaption>
</figure>
<ol type="1">
<li><code>document</code>是一个全局对象，表示浏览器显示的整个网页，包含完整的DOM。</li>
<li><code>getElementById</code>是<code>document</code>的一个方法，查找id为指定值的元素对象。
<ul>
<li>若根据id从DOM获取元素时，如果指定的id不存在，getElementById将返回null。</li>
</ul></li>
<li><code>getElementsByClassName</code>是<code>document</code>的一个方法，查找类名为指定值的元素对象集合。</li>
<li><code>getElementsByTagName</code>
是<code>document</code>的一个方法，查找与指定标签名匹配的元素对象集合。</li>
</ol>
<ul>
<li>返回的是一个NodeList对象。但可以像处理数组一样处理它（length属性、索引访问）。NodeList是一个Node集合，而Node指的其实就是DOM树中的element对象。</li>
</ul>
<ol start="5" type="1">
<li><p><code>innerHTML</code>是元素对象的一个属性，表示包含在元素中的内容（除了元素的HTML标签外）。</p>
<ul>
<li>可以通过<code>innerHTML</code>来读取或替代元素的内容</li>
<li><code>innerHTML</code>表示元素对象包含的所有内容，包括嵌套的元素/从对象的起始位置到终止位置的全部内容,不包括HTML标签。
<ul>
<li>例如，段落元素除文本外，还可能包含<code>&lt;em&gt;</code>和<code>&lt;img&gt;</code>元素</li>
</ul></li>
</ul></li>
<li><p><code>outerHTML</code>是元素对象的一个属性，表示包含在元素对象中的全部内容</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;test&quot;&gt; </span><br><span class="line">  &lt;span style=&quot;color:red&quot;&gt;test1&lt;/span&gt; test2 </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>innerHTML</code>的值是<code>&lt;span style="color:red"&gt;test1&lt;/span&gt;test2</code></li>
<li><code>outerHTML</code>的值是<code>&lt;div id="test"&gt;&lt;span style="color:red"&gt;test1&lt;/span&gt;test2&lt;/div&gt;</code></li>
</ul></li>
<li><p>处理DOM时，要确保代码在网页完全加载后，再执行，否则代码执行时，DOM很可能尚未创建。</p></li>
</ol>
<h3 id="网页加载完毕后执行代码的方法">网页加载完毕后执行代码的方法</h3>
<ol type="1">
<li>将代码放置于<code>&lt;body&gt;</code>元素末尾</li>
<li>将函数赋给对象window的属性onload
<ul>
<li><p>window是一个JavaScript内置对象，表示浏览器窗口</p></li>
<li><p>网页加载事件的触发时间点是：浏览器加载完网页，显示网页的所有内容并生成表示网页的DOM</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;function init() &#123;</span><br><span class="line">	var planet = document.getElementById(&quot;greenplanet&quot;);</span><br><span class="line">	planet.innerHTML = &quot;Red Alert: hit by phaser fire!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">window.onload = init; #千万不要在函数名init后面添加括号，这里不是调用函数，而是将函数作为一个值赋给属性window.onload&lt;/script&gt;</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
</ol>
<h3 id="section-5"></h3>
<h3 id="设置dom中元素对象的特性">设置DOM中元素对象的特性</h3>
<ol type="1">
<li><p><code>setAttribute</code>方法添加新特性或修改既有特性</p>
<p><code>planet.setAttribute("class", "redtext");</code></p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-28-setAttribute%E6%96%B9%E6%B3%95%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%89%B9%E6%80%A7%E6%88%96%E4%BF%AE%E6%94%B9%E6%97%A2%E6%9C%89%E7%89%B9%E6%80%A7.jpg"
alt="setAttribute方法添加新特性或修改既有特性" />
<figcaption
aria-hidden="true">setAttribute方法添加新特性或修改既有特性</figcaption>
</figure></li>
<li><p><code>getAttribute</code>方法获取HTML元素的特性的值</p>
<ul>
<li><p>如果指定的特性不存在，将返回null。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var scoop = document.getElementById(&quot;raspberry&quot;); </span><br><span class="line">var altText = scoop.getAttribute(&quot;alt&quot;);</span><br><span class="line">if (altText == null) &#123;</span><br><span class="line">	console.log(&quot;Oh, I guess there isn&#x27;t an alt attribute.&quot;); </span><br><span class="line">&#125; else &#123;</span><br><span class="line">console.log(&quot;I can&#x27;t see the image in the console,&quot;);</span><br><span class="line">console.log(&quot; but I&#x27;m told it looks like &quot; + altText); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p>设置图像的属性(property)<code>src</code>与使用<code>getAttribute</code>和<code>setAttribute</code>设置特性(attribute)<code>src</code>相同么？</p>
<ul>
<li>对于<code>&lt;img&gt;</code>元素而言，效果是一样的。但是并非所有的HTML特性(attributes)都有对应的对象属性(object
properties)，因此对于这些特性，必须使用<code>getAttribute</code>和<code>setAttribute</code>来设置和获取。</li>
</ul></li>
</ul></li>
</ol>
<h2 id="七类型types">七、类型(types)</h2>
<h3 id="类型的种类">类型的种类</h3>
<ol type="1">
<li>基本类型(primitives)
<ul>
<li>数值（作为基本类型）</li>
<li>布尔值（作为基本类型）</li>
<li>字符串（作为基本类型）</li>
<li><code>null</code></li>
<li><code>undefined</code></li>
</ul></li>
<li>对象（objects对象有属性和方法）
<ul>
<li>字符串（作为对象/JavaScript解释器会在需要时替你创建字符串对象，无需显式地这么做）</li>
<li><ul>
<li>数值（作为对象）</li>
</ul></li>
<li><ul>
<li>布尔值（作为对象）</li>
</ul></li>
</ul></li>
</ol>
<h3 id="undefined值"><code>undefined</code>值</h3>
<ol type="1">
<li><p>对于任何还没有值（即还未初始化）的东西，都将被赋予值<code>undefined</code>，<code>undefined</code>的类型是<code>undefined</code>。</p>
<ul>
<li>没有return语句的函数返回的值</li>
<li>未赋值的变量的值</li>
<li>稀疏数组中不存在的数组元素的值</li>
<li>不存在的属性的值</li>
<li>已删除的属性的值</li>
</ul></li>
<li><p>可以通过<code>undefined</code>来判断是否给变量（属性或数组元素）赋值了。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var x;</span><br><span class="line"></span><br><span class="line">if (x == undefined) &#123;</span><br><span class="line">// x isn’t defined! just deal with it!</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var customer = &#123; </span><br><span class="line">		name: &quot;Jenny&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">if (customer.phoneNumber == undefined) &#123;</span><br><span class="line"></span><br><span class="line">	// get the customer&#x27;s phone number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#注意不要将值undefined与字符串&quot;undefined&quot;混淆</span><br></pre></td></tr></table></figure> ### <code>null</code>值</p></li>
<li><p>表示”无对象/对象不存在“，在应该提供一个对象，但无法创建或找到时，将提供null，在变量未初始化，对象没有指定属性或数组没有指定元素时，将返回undefined。</p></li>
<li><p><code>null</code>以前的类型是<code>object</code>，不过在最新的规范中<code>null</code>的类型是<code>null</code>。</p></li>
</ol>
<h3 id="nan值"><code>NaN</code>值</h3>
<ol type="1">
<li><p>表示JavaScript无法表示的数值结果，即(Not a Number)</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = 0/0;</span><br><span class="line">var b = &quot;food&quot; * 1000;</span><br><span class="line">var c = Math.sqrt(-9);</span><br></pre></td></tr></table></figure></p></li>
<li><p>JavaScript中唯一一个与自己不相等的值：<code>NaN != NaN</code> *
因为NaN与任何东西都不相等，因此不能以任何方式检查变量与NaN是否相等。需要使用特殊函数isNaN。
* NaN指的是无法表示的数字，但并非所有无法表示的数字都相等。 *
如果变量存储的是NaN或其他任何不是数字的值，将其传递给isNaN时，都将返回<code>true</code>，否则将返回<code>false</code>。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (isNaN(myNum)) &#123; </span><br><span class="line">	myNum = 0;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p><code>NaN</code>值的类型是"number"</p>
<ul>
<li><code>NaN</code>值可以认为是一个数字，只是无法表示（至少对计算机来说如此而已）</li>
</ul></li>
</ol>
<h3 id="infinity值"><code>Infinity</code>值</h3>
<ol type="1">
<li>任何超过浮点数上限(1.7976931348623157E+10308)或下限(-1.7976931348623157E+10308,-Infinity)的值。</li>
<li><code>Infinity</code>值的类型是"number"</li>
<li><code>Infinity</code>与它自己相减时，结果为<code>NaN</code></li>
</ol>
<h3 id="检测类型">检测类型</h3>
<ol type="1">
<li><p><code>typeof</code>是一个内置的JavaScript运算符(operator)，可用于探测其操作数(operand)的类型</p>
<blockquote>
<p>操作数：要对其进行操作的东西</p>
</blockquote>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var subject = &quot;Just a string&quot;;</span><br><span class="line">var probe = typeof subject; </span><br><span class="line">console.log(probe);</span><br></pre></td></tr></table></figure></p></li>
<li><p><code>typeof</code>使用字符串来表示类型</p>
<ul>
<li>"string"</li>
<li>"boolean"</li>
<li>"number"</li>
<li>"object"</li>
<li>"undefined"</li>
<li>"function"</li>
</ul></li>
</ol>
<h3 id="类型转换">类型转换</h3>
<ol type="1">
<li>拼接和加法运算符<code>+</code>
<ul>
<li><p>用于数字时，运算符<code>+</code>表示加法运算，用于字符串时，运算符<code>+</code>表示拼接(concatenation)</p></li>
<li><p>将数字和字符串相加时，数字转换为字符串，再进行拼接，顺序为从左至右</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var order = 1 + 2 + &quot; pizzas&quot;;</span><br><span class="line">3 pizza</span><br></pre></td></tr></table></figure></p></li>
<li><p>布尔值与字符串相加时，结果为字符串。
<code>true + “ love”</code>为<code>“true love”</code></p></li>
</ul></li>
<li>其他算数运算符
<ul>
<li>如乘法、除法和减法运算，JavaScript将认为你要执行的是算术运算，而不是字符串运算。</li>
<li>运算符<code>-</code>对数字取负，将其用于<code>true</code>，结果将为-1</li>
</ul></li>
<li>将字符串转换为数字的函数<code>Number</code>
<ul>
<li>如果指定的实参无法转换为数字，Number将返回NaN。</li>
</ul></li>
</ol>
<h2 id="八运算符">八、运算符</h2>
<h3 id="算术运算符">算术运算符</h3>
<ol type="1">
<li>后递增运算符(post-increment operator)：<code>++</code>
<ul>
<li><code>myImportantCounter++;</code>这条语句执行完以后，myImportantCounter的值比原来大1。</li>
</ul></li>
<li>后递减运算符(post-decrement operator)：<code>--</code> ###<br />
###<br />
###<br />
###</li>
</ol>
<h2 id="九比较">九、比较</h2>
<h3 id="比较运算符">比较运算符</h3>
<ol type="1">
<li><code>&lt;</code>
<ul>
<li>可以比较布尔值、字符串和数字，<code>true</code>转换为1</li>
<li>字符串比较规则
<ul>
<li>取决于计算机中用于表示各个字符的Unicode值的排列顺序</li>
</ul></li>
</ul></li>
<li><code>&gt;</code>
<ul>
<li>可以比较布尔值、字符串和数字，<code>true</code>转换为1</li>
</ul></li>
<li><code>==</code>表示等于</li>
</ol>
<ul>
<li>如果两个值的类型相等，就直接进行比较</li>
<li>如果两个值的类型不同，则尝试将它们转换为相同的类型，再进行比较
<ul>
<li><p>比较数字和字符串</p>
<ul>
<li><p>把字符串转换为数字，再对两个数字进行比较</p></li>
<li><p>字符串不能转换为数字时，结果为<code>NaN</code>，和数字的比较结果为<code>false</code></p>
<p><code>99 == "vanilla"</code>→<code>99 == NaN</code>→<code>false</code></p></li>
</ul></li>
<li><p>比较布尔值和其他类型</p>
<ul>
<li><p>把布尔值转换为数字，再对两个数字进行比较</p></li>
<li><p><code>true</code>将被转换为1，而<code>false</code>将被转换为0</p>
<p><code>1 == true</code>→<code>1 == 1</code>→<code>true</code></p></li>
</ul></li>
<li><p>比较<code>null</code>和<code>undefined</code></p>
<p><code>undefined == null</code>→<code>true</code></p></li>
<li><p>其他情况</p>
<ul>
<li><p>空字符串转换为数字的结果是0</p>
<p><code>1 == ""</code>→<code>1 == 0</code>→<code>false</code></p></li>
</ul></li>
<li><p>判断两个对象是否相等</p>
<ul>
<li><p>如果两个操作数都是对象，<code>==</code>和<code>===</code>都可以使用，工作原理完全相同</p></li>
<li><p>检查两个对象变量是否相等时，比较的是指向对象的引用</p>
<ul>
<li>这些对象包含什么不重要，只要两个引用指向的对象不同，他们就不同</li>
</ul></li>
<li><p>当且仅当两个引用指向的是同一个对象时，它们才相等</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-28-%E5%88%A4%E6%96%AD%E4%B8%A4%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E7%9B%B8%E7%AD%89.jpg"
alt="判断两个对象是否相等" />
<figcaption aria-hidden="true">判断两个对象是否相等</figcaption>
</figure></li>
</ul></li>
</ul></li>
</ul>
<ol start="4" type="1">
<li><p><code>===</code>表示正好等于/严格相等</p>
<ul>
<li>当且仅当两个值的类型和值都相等时，它们才是严格相等。</li>
<li>有些开发人员称其为等同运算符<code>“identity” operator</code></li>
</ul></li>
<li><p><code>&lt;=</code></p>
<ul>
<li>只能比较字符串和数字</li>
</ul></li>
<li><p><code>&gt;=</code></p>
<ul>
<li>只能比较字符串和数字</li>
</ul></li>
<li><p><code>!=</code>表示不等于</p></li>
<li><p><code>!==</code>表示严格不等于</p></li>
</ol>
<h3 id="逻辑运算符">逻辑运算符</h3>
<ol type="1">
<li><code>||</code>表示OR（或）</li>
<li><code>&amp;&amp;</code>表示AND（与）</li>
<li><code>!</code>表示NOT（非），仅当表达式为false时，结果才为true</li>
</ol>
<h3
id="真值truthy和假值falseyfalsy">真值(truthy)和假值(falsey/falsy)</h3>
<ol type="1">
<li><p>定义：有些值并非<code>true</code>或<code>false</code>，但用于条件表达式中时，被视为<code>true</code>或<code>false</code>。这些值被称为真值(truthy)和假值(falsey/falsy)。因为严格地说它们并非<code>true</code>或<code>false</code>，但用于条件表达式时，它们的行为像<code>true</code>或<code>false</code>。</p></li>
<li><p>假值(falsey/falsy)</p>
<ul>
<li><code>undefined</code></li>
<li><code>null</code></li>
<li><code>0</code></li>
<li>空字符串</li>
<li><code>NaN</code></li>
</ul></li>
<li><p>真值(truthy)</p>
<p>除了5个假值以外，其他都是真值</p></li>
</ol>
<h2
id="十事件处理程序event-handler回调函数callback及异步编码asynchronous-coding">十、事件处理程序(event
handler)/回调函数(callback)及异步编码(asynchronous coding)</h2>
<h3 id="基本概念">基本概念</h3>
<ol type="1">
<li>有些事件(events)是浏览器生成的，如加载。有些事件是用户与网页交互时生成的。有些事件是JavaScript代码生成的。还有定时器事件。</li>
<li>事件处理程序(event
handler)/回调函数(callback)/监听器(listener)。从代码的角度说，就是一个函数。</li>
<li>异步编码(asynchronous
coding)，是一种以响应事件的方式组织代码的代码编写方式。 &gt;
相对应的线性编码，就是从上到下的顺序逐步编写代码。</li>
</ol>
<h3 id="事件对象event-object的工作原理">事件对象(event
object)的工作原理</h3>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-01-%E4%BA%8B%E4%BB%B6%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.jpg"
alt="事件对象(event object)的工作原理" />
<figcaption aria-hidden="true">事件对象(event
object)的工作原理</figcaption>
</figure>
<ol type="1">
<li><p>每次调用单击事件处理程序时，都将向它传递一个事件对象(event
object)，更准确地说是触发事件的元素，这被称为目标(target)。例如，当用户单击特定的图像时，目标就是这幅图像的元素对象。加载事件处理程序传递的一个事件对象的<code>target</code>是<code>window</code>对象。</p>
<ul>
<li><code>target</code>就是事件对象的一个属性(property)</li>
</ul></li>
<li><p>在事件处理程序中，你可以使用这个事件对象来获取有关事件的信息</p>
<ul>
<li>常规信息
<ul>
<li><p>属性<code>target</code>，它储存了一个引用，指向触发事件的元素对象（可以是各种不同的对象，但通常是元素对象）</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function showAnswer(eventObj) &#123;</span><br><span class="line">	var image = eventObj.target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p>属性<code>type</code>，是一个字符串，如<code>click</code>或<code>load</code>，指出了发生的是哪种事件</p></li>
<li><p>属性<code>timeStamp</code>，事件是何时发生的</p></li>
</ul></li>
<li>具体信息（取决于事件的类型）
<ul>
<li>用户单击鼠标时，获得单击位置的坐标</li>
<li>属性<code>keyCode</code>，用户刚按下了哪个键</li>
<li>属性<code>clientX</code>和<code>clientY</code>，确定用户点击的位置离浏览器窗口的左边缘和上边缘的距离</li>
<li>属性<code>touches</code>，在触摸设备上，确定用户使用了多少根手指来触摸屏幕</li>
</ul></li>
</ul></li>
<li><p>浏览器把事件都放入队列，再遍历这个队列(queue)，并在必要时调用相应的处理程序。浏览器只有一个队列和一个控制线程(thread
of control)，只能去逐个处理事件。</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-07-01-%E4%BA%8B%E4%BB%B6%E5%92%8C%E9%98%9F%E5%88%97.jpg"
alt="事件和队列" />
<figcaption aria-hidden="true">事件和队列</figcaption>
</figure></li>
</ol>
<h3 id="具体示例">具体示例</h3>
<ol type="1">
<li><p>将按钮（类型为button）的属性onclick设置为一个事件处理程序</p>
<ul>
<li><p>可以给网页中任何元素的onclick属性设置为一个函数。</p></li>
<li><p>不会在网页中显示出来的元素（如<code>&lt;script&gt;</code>和<code>&lt;head&gt;</code>）不支持单击等事件</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function init() &#123;</span><br><span class="line">	var fireButton = document.getElementById(&quot;fireButton&quot;);</span><br><span class="line">	fireButton.onclick = handleFireButton;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleFireButton() &#123;</span><br><span class="line">	// 从表单中获取值的代码</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line">window.onload = init;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>通过迭代批量增加单击事件处理程序</li>
</ul>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function init() &#123;</span><br><span class="line">	var images = document.getElementsByTagName(&quot;img&quot;); </span><br><span class="line">	for (var i = 0; i &lt; images.length; i++) &#123;</span><br><span class="line">	images[i].onclick = showAnswer; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;;		</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
<li><p>处理回车键事件</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function init() &#123;</span><br><span class="line">	var fireButton = document.getElementById(&quot;fireButton&quot;);</span><br><span class="line">	fireButton.onclick = handleFireButton;</span><br><span class="line">	var guessInput = document.getElementById(&quot;guessInput&quot;);</span><br><span class="line">	guessInput.onkeypress = handleKeyPress;</span><br><span class="line">	# 按键</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleKeyPress(e) &#123;</span><br><span class="line">	var fireButton = document.getElementById(&quot;fireButton&quot;); </span><br><span class="line">	if (e.keyCode === 13) &#123;</span><br><span class="line">		fireButton.click();</span><br><span class="line">		return false; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"># 如果用户按下的是回车键，事件对象的属性keyCode将为13</span><br></pre></td></tr></table></figure></p></li>
<li><p>mousemove事件</p>
<ul>
<li>当鼠标在特定元素上移动时，
mousemove事件通知相应的处理程序。要指定处理程序，可使用元素的属性<code>onmousemove</code>。这样会给这种事件处理程序传递一个<code>event</code>对象。</li>
<li><code>clientX, clientY</code>：鼠标相对于浏览器窗口左边缘和上边缘的距离，单位为像素</li>
<li><code>screenX, screenY</code>：鼠标相对于设备屏幕左边缘和上边缘的距离，单位为像素</li>
<li><code>pageX, pageY</code>:
鼠标相对于网页左边缘和上边缘的距离，单位为像素</li>
</ul></li>
<li><p>鼠标移动事件</p>
<ul>
<li>属性<code>onmouseover</code>：鼠标移入元素</li>
<li>属性<code>onmouseout</code>：鼠标移出元素</li>
</ul></li>
<li><p>其他</p>
<ul>
<li><code>resize</code>：每当用户调整浏览器窗口大小时，都将触发这个事件<br />
</li>
<li><code>play</code>：单击网页中<code>&lt;video&gt;</code>元素的播放按钮时，将触发这个事件<br />
</li>
<li><code>pause</code>：单击网页中<code>&lt;video&gt;</code>元素的暂停按钮时，将触发这个事件</li>
<li><code>unload</code>：用户关闭浏览器窗口或切换到其他网页时，将触发这个事件<br />
</li>
<li><code>dragstart</code> ：用户拖曳网页中的元素时，将触发这个事件</li>
<li><code>drop</code> ：用户放下拖曳的元素时，将触发这个事件</li>
<li><code>touchstart</code>：在触摸设备上，用户触摸并按住元素时，将触发这个事件</li>
<li><code>touchend</code> ：用户停止触摸时，将触发这个事件</li>
</ul></li>
<li><p>基于时间的事件</p>
<ul>
<li>调用函数<code>setTimeout</code>并向它传递处理程序，它接受两个参数，事件处理程序和时间间隔（单位为毫秒）。
<ul>
<li><p>向函数<code>setTimeout</code>传递一个指向处理程序函数的引用。函数<code>setTimeout</code>将这个引用存储起来，供定时器到期后使用。</p></li>
<li><p>严格地说，应该写作<code>window.setTimeout</code>，<code>window</code>是全局对象，可省略对象名。</p>
<p><code>setTimeout(timerHandler, 5000);</code></p></li>
<li><p>还可以传入第三个参数：触发时间事件时，这个参数将被传递给处理程序（可向处理程序传递任意数量的参数）。</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(reblur, 2000, image);</span><br><span class="line">	</span><br><span class="line">function reblur(image) &#123;</span><br><span class="line">	var name = image.id; </span><br><span class="line">	name = name + &quot;blur.jpg&quot;; </span><br><span class="line">	image.src = name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>将处理程序指定为reblur，将时间间隔设置为2秒，并将第三个参数指定为要重新变模糊的图像</p>
</blockquote></li>
</ul></li>
<li>调用函数<code>setInterval</code>
<ul>
<li><p>在定时器到期时触发事件，并重启定时器</p></li>
<li><p>若要停止函数<code>setInterval</code>，可将其传递给另一个函数clearInterval</p>
<p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var t = setInterval(ticker, 1000);</span><br><span class="line">clearInterval(t);</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
</ul></li>
</ol>
<h3 id="section-6"></h3>
<h3 id="section-7"></h3>
<h3 id="section-8"></h3>
<h2 id="十一">十一、</h2>
<h3 id="section-9"></h3>
<h3 id="section-10"></h3>
<h3 id="section-11"></h3>
<h3 id="section-12"></h3>
<h2 id="十二">十二、</h2>
<h3 id="section-13"></h3>
<h3 id="section-14"></h3>
<h3 id="section-15"></h3>
<h3 id="section-16"></h3>
<h2 id="十三">十三、</h2>
<h3 id="section-17"></h3>
<h3 id="section-18"></h3>
<h3 id="section-19"></h3>
<h3 id="section-20"></h3>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/06/26/1zhianshu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/26/1zhianshu/" class="post-title-link" itemprop="url">治安疏</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-26 19:03:00" itemprop="dateCreated datePublished" datetime="2018-06-26T19:03:00+08:00">2018-06-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-14 15:30:30" itemprop="dateModified" datetime="2019-11-14T15:30:30+08:00">2019-11-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%BA%E7%89%A9%E4%B8%8E%E5%8E%86%E5%8F%B2/" itemprop="url" rel="index"><span itemprop="name">人物与历史</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          欢迎访问我的博客，考虑到版权问题，本文不公开
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/06/26/1zhianshu/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lysp2017.github.io/2018/06/19/mingqingyanshang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louyan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高山流水">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/19/mingqingyanshang/" class="post-title-link" itemprop="url">明清盐政（未完）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-19 09:23:27" itemprop="dateCreated datePublished" datetime="2018-06-19T09:23:27+08:00">2018-06-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-28 00:49:57" itemprop="dateModified" datetime="2019-02-28T00:49:57+08:00">2019-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%BA%E7%89%A9%E4%B8%8E%E5%8E%86%E5%8F%B2/" itemprop="url" rel="index"><span itemprop="name">人物与历史</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>盐在中国历史上本来就是一个长期被垄断经营的对象，汉代与唐代都曾把垄断盐利作为增加财政收入的重要手段。但是，授予盐商绝对的垄断经营权，这是明清时期才有的事。</p>
<h2 id="一明代">一、明代</h2>
<p>###（一）开中法 #### 有明盐法，莫善于开中
明政府为解决“九边”80多万驻军的粮饷供给，实施了军屯、民运粮、开中法三套制度。亦即军士屯种自给，百姓向边镇输纳，商人纳粮中盐办法，习惯上称为屯粮、民粮、盐粮。然而，北部长城一线地处高寒，屯田产量有限。因此，政府每年征调北直隶、晋、陕、豫、鲁数省农民将交纳后的粮食运送到指定边镇。但在交通不便，车拉驴驮的时代，要把数十万石粮食转运到边塞绝非易事，既妨碍农作，又成本很高。</p>
<blockquote>
<p>九边：又称九镇，是中国明朝弘治年间在北部边境沿长城防线陆续设立的九个军事重镇，分别是辽东镇、蓟州镇、宣府镇、大同镇、太原镇（也称山西镇或三关镇）、延绥镇（也称榆林镇）、宁夏镇、固原镇（也称陕西镇）、甘肃镇。</p>
</blockquote>
<figure>
<img src="http://qiniup.louyanspine.com/2018-06-19-013708.jpg"
alt="九边九镇" />
<figcaption aria-hidden="true">九边九镇</figcaption>
</figure>
<p>洪武三年（1370）六月，山西行省将此普遍性问题奏报明廷，建议政府通过国家所控制的食盐专卖权，让商人到大同仓交米1石，太原仓交米1石3斗，给淮盐一小引（200斤），然后凭盐引换盐运销获利，销售食盐完毕，仍须将盐引交回政府。这样既省运费，又能使边储充足。朱元璋觉得此法利国、便民、惠商，下令全国推行。
&gt;
《明太祖实录》卷53，洪武三年六月辛巳：转输之费省而军储之用充……令商人于大同仓入米一石、太原仓入米一石三斗者，给淮盐一引，引二百斤。商人鬻毕即以原给引目赴所在官司缴之</p>
<p>洪武四年（1371）制定“中盐例”，开中法大致分为报中﹑守支﹑市易三步：</p>
<ol type="1">
<li>报中是盐商按政府的招商榜文要求，把粮食运到指定的边地粮仓，向政府换取盐引﹔</li>
<li>守支是盐商换取盐引后，凭盐引到指定的盐场守候支盐﹔</li>
<li>市易是盐商把得到的盐运到指定的地区销售。</li>
</ol>
<p>商人纳米中盐的条例由户部出榜，依军情、粮价、路途、利润酌定。于是各边镇多召商中盐，盐的运销与军需供给有机结合。商人为节省成本，干脆雇农民在边地垦种，就近给军卫仓纳粮，史称<strong>商屯</strong>。</p>
<p>通俗说，就是：政府根据边镇需要军粮数目在民间招标，中标的商人往边境军镇运粮，粮食运到以后政府给商人颁发盐引，然后商人凭盐引领取食盐，再到指定地区贩卖以获利。</p>
<p>开中法的实质是国退民进，放权让利。明政府突破汉武帝以来盐铁垄断，将官营的盐业专卖权转让给普通商人，用来解决庞大军需供给。永乐以后，开中的方式随着社会经济发展由纳米中盐、纳钞中盐发展为纳银、纳铁、纳麦豆、纳茶马、纳丝绢、纳棉布中盐等12种，从而使盐在产品交换中充当重要媒介。开中法不仅使晋商迅速崛起，而且带动了明中后期黄河流域、长江三角洲、珠江三角洲工商业的发展。开中制的优点在于调动了百姓运送军粮的积极性，不足之处就是让利给盐商，减少了政府的收入，但是在明初，总体来说还是利远大于弊。故《明史·食货志》曰：“有明盐法，莫善于开中。”</p>
<p>边商报中的意义，在于取得食盐的销售特许权。而边商的利益，实际上
并不在于食盐的销售，而主要在于盐引的买卖。边商引价是明初国家与民间商人所确定的盐粮交换的比价，这直接影响开中商人的利益。</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-19-%E6%B4%AA%E6%AD%A6%E5%9B%9B%E5%B9%B4%E7%9A%84%E5%BC%80%E4%B8%AD%E6%B3%95%E7%9B%90%E7%B1%B3%E5%85%91%E6%8D%A2%E4%BB%B7.png"
alt="洪武四年的开中法盐米兑换价" />
<figcaption aria-hidden="true">洪武四年的开中法盐米兑换价</figcaption>
</figure>
<p>开中法除有解决军需功能外，也是明政府与商人合作兴办公共事业，解决饥荒、漕运、灾民等社会问题的有效方式。永乐年间，为迁都和营建北京，朱棣两次诏令各地暂停开中，集中纳粮运京，以使北平粮储足够数十万工匠人等数年食用。成化五年（1469）春，荆、襄、南阳数地遭灾，户部招商开中淮浙等盐18万引安置流民。同年十月，又开中两淮、两浙、河东盐80万引于陕西赈济灾民。时隔五年，为补充国库粮储，再定开中接济漕运仓储的办法，开中两淮、两浙、长芦、山东盐100万引，纳粮82.6万石。</p>
<p>显然，开中商人从提供军需物资到获得食盐，要经历很长的时间，经营周期漫长，在这期间商人作为授信者，向政府提供了商业信用，商人因此承担了由交易过程漫长而产生的市场风险，而风险的大小则主要取决于政府的守信程度，风险回报是获得食盐销售权利及售盐后的利润。
&gt; 授信就是给予目标客户额度，如信用卡额度。 &gt; &gt;
商业信用：企业在正常的经营活动和商品交易中由于延期付款或预收帐款所形成的企业常见的信贷关系。</p>
<h4 id="开中法特点">开中法特点</h4>
<p>开中法值得注意之处有三。</p>
<ol type="1">
<li><p>第一，开中法作为财政制度，在原则上并不强制，而以自愿的交易来得到收入。</p>
<p>政府要确保有人参加开中，在制定开中法盐米兑换价时，必须把参加者的所有成本计算在内，包括粮食的生产、收购、运输费用，往返粮仓、运司的旅费，等等，还必须确保参加开中者有利可图，否则难以达到“转输之费省而军之用充”的目的。</p></li>
<li><p>第二，开中法下的盐粮交易，不是即时的交易，而是商人为政府运粮在前，政府以食盐支付商人在后。</p>
<p>明代中国版图虽不如清朝之大，但商人运送粮食多在北方，而支取食盐多在东部沿海，在前工业革命的技术条件下，运粮与支盐的间隔必然相当长，可以说，开中法的盐粮交易，是政府的借贷行为，政府借取粮食在前，而以食盐偿还在后。</p></li>
<li><p>第三，开中法原本的设计，没有货币成分，但也不是以物易物，而是凭一纸盐引完成交易。</p>
<p>每一纸盐引代表200斤盐的价值，是政府欠债的凭据，商人凭此盐引，能够支取食盐，作为为政府运送粮食的报酬。基于这三个原因，可以把开中法理解为公债制度，把盐引理解为公债券。明初，战乱甫定，元末纸钞恶性通货膨胀的阴影未消，而大明宝钞的纸币制度又非常失败。但明朝政府却能在食盐的运输方面推出开中法这样一个承认利润原则、依靠市场力量的公债制度，相当值得关注。
　 #### 守支问題的出现</p></li>
</ol>
<p>明代统治者为了眼前利益，超额发放盐引，从而产生了始终困扰开中法
顺利实施的“守支”问题。所谓守支问题，就是盐商在边镇交纳粮草取得
盐引后，并不能马上支取到食盐，被迫困守盐场，等候支盐。守支问题的产生在于官商交易方式的改变，在于明政府行为方式的改变。明代开中法与以往历代王朝的盐政并无大的不同，盐的生产仍然由灶户专门从事，再由政府垄断征收，最后被盐商报中支取，转运各地销售。不同点在于，在以往盐制下，盐商直接向征收盐课的盐政机构购买官盐然后转运贩卖而获利，而在开中法下，盐商不再向盐政机构直接购盐，而是先赴边镇纳粮，再回盐政机构支盐转贩。这样，其经营环节便由二增加为三，即一是赴边纳粮，二是返回盐政机构支盐，三是载盐转贩。这一改变使盐商纳粮与支盐两个经营环节间出现了一段间断期。在这段间断期，明廷只需出具一纸纳粮收据，便提前占用了盐商的资金。这样一来，就会出现这样一种可能：当边镇军需紧张时，可以有意延长这段间断期，将尚未产出的官盐预先开中，仅凭一纸收据提前收取盐商投资。这就为守支问题的产生提供了可能。</p>
<p>开中法实施后，开中盐粮遂成为明代盐政的一个重要部分，而盐政在明
代与边备关系密切，所得款项主要用于边防武备开支，这样，盐政实际就成为明廷满足边镇军需的一种手段。盐政与边政相比，边政直接关系国家安危，自然被置于更高地位。开中盐粮的多少是一个变量，主要受边饷需求的制约，而边饷需求又要视边情缓急而定。边情紧急，边饷需求则剧增，开中盐粮也就作为应急措施被频繁使用。反之，开中盐粮则无必要，或所需甚少。因此，开中盐粮实际将盐政与边政直接连在了一起。由于明廷拥有一条延绵万里的西北防御线，边饷需求巨大，开中量往往超出官盐的供应量，使盐商纳粮而无现盐可支，盐商无法及时获得官盐，被迫守支。</p>
<p>开中法得以实施的前提条件就是统治者必须抑制自己的“掠夺之手”，严格遵守承诺，发给商人的盐引总数必须与盐场当年的产量总额相符，不能超发、滥发，以便保障商人在交纳粮草后会得到食盐，“不拘资次，盐引遇到即支”。可是，统治者往往根据边镇局势变化的需要来决定发行的盐引数量，使得发行的盐引远远超过盐场的支付能力，从而造成“守支”问题。</p>
<p>特别是明代中后期，随着开中法的普及，开中内容随着明代社
会经济的发展和边储的需要逐渐由纳米中盐繁衍为纳铁中盐、纳茶中盐、纳绢中盐等多种方式，食盐几乎充当了一般等价物的角色。统治者发现，通过发行盐引并延期支盐，无需付出什么成本就可以将大量的民间资本征集起来供其使用，这对于统治者来说是一种极具诱惑的、有利可图的选择。</p>
<h4 id="权力寻租导致守支问题恶化">权力寻租导致守支问题恶化</h4>
<p>开中法实施之初，明太祖于洪武二十七年（1394年）下令： &gt;
“公、侯、伯及文武四品以上官，不得令家人、奴仆行商中盐，侵夺民利。</p>
<p>明初的统治者明令禁止朝廷官员参与开中，以免产生官商勾结、侵夺民利等弊端。永乐年间，明成祖为筹集更多的资金以满足边防需要，改变了明太祖的禁令，开始批准了一些权贵关于参与开中的请求。随着开中内容的增加和开中地理范围的扩展，各级官员皆被允许参与开中。随着越来越多的官员参与开中，逐步出现排挤商人、垄断市场的行为。成化年间，权贵们可以通过皇帝敕许而获得纳粮中盐的权利，实际输纳粮草就不再是获得中盐权利的必要条件，于是纳粮中盐权利就与实际的输纳粮草相分离，成为一种可以买卖交易的权利。在当时的历史文献中，这种权利就被称为“窝”，其买卖交易就被称为“买窝卖窝”。准许官员参与开中的先例一开，使得那些拥有特权的官僚得以利用权势垄断食盐贸易，利用特权霸占盐引，这种现象史称“占窝”。</p>
<p>权贵利用特权通过种种手段占据大量盐引。他们派家人前往开中，以至于参与开中的都是权贵及其关系人。权贵们一方面让亲属假扮军人或百姓出面承纳马草开中盐粮，另一方面还经常向皇帝奏讨盐引，每次少则千引，多则数万引。成化以后，“宗藩、贵戚之求土田夺盐利者，亦数千万计”。成化十五年(1479年)，宪帝赐给万贵妃的兄弟万通准盐五千引;十六年，赐给淳皇后母段氏两淮官盐二万引，成化十九年（1483年〉，宦官梁芳“侵盗库金以数十万计，不足则给以盐……前后请两淮存积余盐不下数十万引”，致使“商引壅不行，边储日匮”。</p>
<p>明代政府对权贵们开中食盐网开一面，而对商人中盐则有诸多限制。比如商人中盐数额“不许过三千引”，而对权贵，“或五万、十万，至二十万引”并无限制，于是，开中盐引大多被朝中权贵所把持。权贵们以便宜的价格得到盐引，然后再以较髙的价格出售从而赚取巨额利润。</p>
<p>即使在支盐环节上权贵们也享受着一般商人无法获得的特权。普通商人
无论是交纳粮草还是下场支盐，都必须在官府指定的地点进行。一般商人只能选择参与还是不参与，而权贵则可以通过特权取得盐引，然后去最好的盐场支取食盐，而且在盐产量有限的情况下，权贵们总也能够找到办法抢先支到盐。在“朝廷令人易纳马草开中盐粮”之时，“各场纳草之人，多系官豪势要，及该管内外官”。</p>
<p>明中后期，普通中小商人祖孙三代空持引票支不到盐卖，而靠贿赂权势的不法奸商却能纳粮掺假，甚至虚出“通关”。按明制，商人纳米到边镇，由仓官验收，在法票上注明纳粮品种、数量及应支盐引，并加盖骑缝印章，称作“通关”。但到正统时，奸商通过贿赂管仓官吏，不纳米却能盖印支盐获利。这使仓库未收到粮，盐场却支付了盐，政府蒙受双倍的损失。</p>
<p>由于《大明律》规定，四品以上官员不得允许其家人和亲属参与中盐和与民争利，于是这些权贵们就设法绕开法律规定，“令子侄家人伴当假托军民出名承纳”。待到支盐之时，“嘱管盐官搀越关支”，“不拘年次，本场无盐，辄易他所，三倍加支”权贵们利用权势抢先支盐。权贵们有钱有势，盐政官员对他们逢迎巴结或姑息迁就，往往将灶户所生产的课盐“潜卖与人，或答应势要"，从而造成“官盐不足，私盐盛行”的局面。</p>
<p>更为常见的是，权贵们并不直接纳粮边地，而是将中盐资格转卖他人。这种资格被称为“窝”。势豪通过种种手段，“包占”或控制了这种“窝”，使其有了价值，将其转卖与无势不得中盐的商人，每一千引卖银一百余，或七八十两，名曰“卖窝钱”。这样一来，实际上就剥夺了商人直接纳粮中盐的权利，正如弘治末年国子监祭酒章懋上疏所言，“商人不藉手于彼，即无由中纳于此，故费多而中盐者日少”。因此，商人要纳粮中盐，就先要从势豪之手获得行盐资格“窝”，既增加了纳粮的困难，又增加了中盐的成本。其结果是中盐者日少，官盐价日贵，官盐价贵，私盐盛行。私盐盛行，更使官盐难销，形成恶性循环。纳粮和行盐均困难重重，兼顾则更不可能，这就更促使纳粮边商和支盐内商的分化。正是在这种占窝卖窝日益成为纳粮行盐的常态，报中守支均日趋困难的情形下，边商、内商之分日益定型。</p>
<p>纳粮中盐的开中法正常运作，纳粮边地，商人角逐于边地，山陕商人较之徽商有优势。开中法败坏，纳粮凭窝，先要资格，商人角逐于上层甚至权力中央，徽州甲第连云，无论中央还是地方，身居要职者多，“善行媚权势”的徽商较之山陕商人有优势；下场支盐，角逐于淮扬地方，徽商有地理之便，也较山陕商人有优势。</p>
<p>此外，由于贩卖食盐利润巨大，走私越来越猖獗。正统末，三杨去世，法弛贿兴，走私日甚。成化时公然发展到武装走私，“结党朋，操利器，与官司捕役抗争夺利”。当时敢造“遮洋大船，列械贩盐”者已非中小商人，而是富商巨贾、名门世族、军卫土豪组成的走私集团，造成国家税收大量流失。
&gt;
三杨，指杨士奇、杨荣、杨溥。三人均历仕永乐、洪熙、宣德、正统四朝，先后位至台阁重臣，正统时加大学士衔辅政，人称“三杨”。</p>
<h4 id="边商和内商的形成">边商和内商的形成</h4>
<p>隆庆二年以总理江北等处屯盐都御史身份前往两淮改革盐政的庞尚鹏的奏折称：
&gt;
国初原无边商内商名色，自边商难于守支，故卖引于內商；內商难于报中，故买引于边商。一专报中、一专守支。其初盐法疏通，引可速卖、盐可速掣，彼此交易，两利俱全。今盐法不行，在內商有支盐上堆，数年而不得掣者，则其不乐于买引，原非得已也，势也；由是抑勒减价之弊生。而边商始蹙额矣。在边商有申引到司，数年而不得卖者，则其告掣河盐，亦非得已也，势也；由是展转增价之议兴，而內商始侧目矣。转相攻激。视为寇仇……已经札行兵备道，督同运、府等官，召集边內二商，从公酌议，将边商引价，着为三等。分拨见引：淮南定价玖钱，淮北定价捌钱；分拔起纸关引：淮南捌钱，淮北柒钱；分拨到司勘合：淮南柒钱，淮北陆钱。</p>
<p>庞尚鹏的奏折，清楚地交代了16世纪中叶两淮盐引市场的运作，以及政府对盐引市场的承认和控制。盐商分为专门输送粮食的“边商”、专门凭盐引兑换食盐的“内商”，边商把支取食盐所需的各种票据（勘合、盐引）等卖予内商，内商则凭着这些票据支取食盐。庞尚鹏对于这一系列显然违反“祖制”的现象，并不反对，反而予以承认，还规定边商、内商之间三种票据的交易价格。</p>
<figure>
<img
src="http://qiniup.louyanspine.com/2018-06-19-%E8%BE%B9%E5%95%86%E3%80%81%E5%86%85%E5%95%86%E4%B9%8B%E9%97%B4%E4%B8%89%E7%A7%8D%E7%A5%A8%E6%8D%AE%E7%9A%84%E4%BA%A4%E6%98%93%E4%BB%B7%E6%A0%BC.jpg"
alt="边商、内商之间三种票据的交易价格" />
<figcaption
aria-hidden="true">边商、内商之间三种票据的交易价格</figcaption>
</figure>
<p>###（二）折色开中法与运司纳银制
按照明代开中法的要求，商人必须把粮草等物资输送到边防卫所，以换
取“仓钞”，再按仓钞发派盐引，然后凭盐引到指定的盐场支盐，并在政府指定的范围内销售。无盐引而经销食盐，属于贩私盐，要受法律严惩。如果商人们输边交纳的是粮草等农产品，则称为“本色”，如果交纳的是银钱,则称为“折色”。明初边防物资以粮食为主，开中的形式主要为“本色”。到了明代成弘年间，随着白银的使用，盐法发生了重大变革，由纳“本色”改为纳“折色”，即由纳粮改为纳银。</p>
<p>最初的开中折色政策是政府为了吸引商人参与开中而出台的优惠政策。
据记载：天顺八年十一月，即宪宗即位尚未改元之时，明廷以报中商人稀少，下令降低当年八月在大同、宣府所开中引盐的价格，并规定“愿折银者听”，折银标准为淮盐每引折银五钱，其余盐种依中盐米数以次递减此时，运粮到边区开中的商人，也希望把纳粮开中改为纳银开中。在此之前内地盐商或纳粮输边或经营商囤以换取盐引，他们在洪武时期盐法通行之时不困守支、资金周转迅速，经营顺利。</p>
<p>自永乐以后盐法日坏，商人们苦于守支，不少内地盐商纷纷破产，视开中为畏途。在这种情况下，正当盐商无法获利，只有那些投靠权贵者例外。事实上，盐商若不投靠权贵而免于守支，一般是不敢冒险去开中的。对商人们来说，纳银开中，缩短了守支的时间，缩短了经营周期，其益处自然不言自明。纳银开中不但有利于商人，而且有利于政府。</p>
<p>当时白银已成为通用的货币，因而白银在财政上的运用较纳粮草为方便。很显然，在折色开中制下，商人向边关输送粮草改为折纳银两，实际上就失去了原来开中之本意。</p>
<p>“粟贵征粟，粟贱征银”，明政府不再着眼于巩固边防，而是把食盐专卖为财政搜刮的手段，致力于充实国库，增加帑银。但是，最初的折色制只是应急之策，对于朝廷来说，开中纳粮始终是“不可更改”的“祖宗成例”。开中折色政策的真正设立是“没官盐”的出售。“没官盐”，指被官府没收的私盐或者是批验所在秤掣官盐时所没收的超出规定数量的多余的食盐，也称为“掣割余盐。”《明宪宗实录》载，成化二年闰三月，巡视淮扬右副都御史林聪奏言：“凤阳诸处灾伤，措置赈济别无余策，査得两淮运司仪真批验盐引所见有没官盐二万余引，已行召商卖银支用。”</p>
<p>这是成化年间首例在盐场出售“没官盐”。虽然开卖的并非正额引盐,但这意味着开中盐制的禁条正在一步步地被解除，是对“祖宗成例”的又一冲击。“没官盐”的就地出售，在成化九年固定下来，规定每积至二万引即召商出售。不仅如此，也恰好在成化九年底，正额引盐也开始出现在盐场出售的情况。</p>
<p>成化九年十一月，巡抚山西右副都御史雷复上疏，要求“鬻河东运司盐四十万引，以济山西饥民。”得到允准。次年五月，经河东巡盐御史王臣建议，户部确定，今后河东盐凡幵中无商报中者，均就场开卖，所卖银两
由户部转拨边方。此后，就场幵卖引盐的事例不断出现，长芦盐、山东盐、四川盐、广东盐、福建盐、两浙盐，以至当时开中情况较好的两淮盐，都有了就场开卖的事例。至此，盐商不必纳粮边镇，也可获得经营引盐的权利。</p>
<p>折色制发展到到了成化末年，不但实行了纳银开中法，运司纳银制也已
经形成。随着内商经济实力的增长，他们日益感到运送白银赴边开中有很多不便，于是要求一种更简便的方法，以换取盐引，借此摆脱边商的控制。因此，运司纳银制出现了。在原来情况下，以陕西、山西商人为主的边商因其地利之便，经营商囤，开中纳粮获得盐引后加价转卖给内商，内商因有“远涉之虞”，不便直接开中得引，只好接受边商的盐引。</p>
<p>明朝的“南倭北虏”危机到弘治和嘉靖时全面暴露。军卫缺员，盐法阻滞。为了扭转危局，孝宗大力整顿盐茶、马政，决定从全国最大的两淮盐场入手清理盐法。</p>
<p>不久，户部左侍郎李嗣奏：两淮运司连年称过引盐一百余万，而商人所缴截角引目十无二三，如不严禁，则奸商投机不已，盐法更坏。这就说明户部宏观管理失控，换句话说，两淮盐场的引盐实际只有20%用于开中商人纳米中盐，其余大半已为官商影射侵夺。所以，户部建议各盐政机关，每年除将称过引盐数额造册上报外，必须将商人所缴截角骑缝引票同时造册缴部，防止盐政衙门欺上瞒下，搞两本账。
&gt; 截角，将角截掉</p>
<p>弘治四年（1491），明廷罢户部尚书李敏，升侍郎叶淇。叶淇上任后，变开中之法，“请召商纳银运司，类解太仓，分给各边”。此后，商人不再纳粮而是给盐运司交银，统一提解国库，每年通过财政转移支付方式，将饷银调拨到边镇发给将士籴买粮食。辩证地看，叶淇变法的利弊并生，一方面商人免去了先到边镇纳粮、再到盐场支盐的奔波，国家财政收入也骤增；另一方面，边地盐商举家内迁，商屯迅速破坏，粮价飞涨，边军粮食储备也因此大减。不难看出，边镇供给体制由纳米为主向纳银转变是变法的内核，但前提是国内市场兴盛，在边镇市场拿钱能买到粮食。至于粮价波动，势必受供求影响，也说明专制政体下盐政腐败难除，政府管理失控，只得借用市场手段。此外，叶淇变法违背了开中制的初衷：纳粮开中解决的是军粮问题，纳银开中解决的是国库收入问题。更重要的是，大明王朝为了这百万白银的眼前收入，把军粮问题抛诸脑后。</p>
<p><code>注：籴dí，买米，引申为买入之意</code></p>
<p>准许纳银解部以后，纳栗报中的重要性大大降低，这样一来，边商与内商两极分化。原来“输粟于边，利归边民”，开中折色后形势逆转，内商取得了对边商的压倒性优势。于是“西北商或徙家于淮以便盐，而边地为墟。”</p>
<p>商屯解体使边商中的富商纷纷改业内商，残留的边商资力日疲，不得不仰承内商之鼻息；而水商或为内商所雇，或为托荫于内商的江湖行贩，其所以取得专卖权皆仰承于人，更无实力同内商抗衡；而内商坐场掣盐，资本增殖很快，后来索性将售盐委托给代理人经营，或转售引他人，于是内商中又分化出水商。
&gt; 从内商手里批发到盐再转运各地的，叫水商。</p>
<p>以徽商和南迁的秦晋富豪为骨干的内商构成了明代盐商的主体。由此可见,三商的分化实质上是促使内商演变为盐商的主角，边、水二商不过是它的经济附庸。但内商决不会坐困守支、正常经营，而是将投托权贵“奏讨”包占的盐引“价增数倍”卖出，以“买窝卖窝”形式坐享其成，这种脱离盐业经营转手倒卖盐引的商人实为一种寄生阶层。其通过投托权贵，牟取厚利，经弘治到万历百余年的发展，终于成为内商中的巨富，囤户。</p>
<p>###（三）纲法 #### 边镇纳粟的差别
由于商屯在不同的边镇发展情况有差别，加大了各边镇开中纳粟的差距。开垦种植条件较好的地区，如陕西三边、山西诸边，商屯发达，中纳情况较好，而北京周围边镇，开垦种植条件较差，商屯难兴，开中纳粟就比较困难。极边地区如甘肃，极冲地区如大同、宣府、独石，开中纳粟仍不景气。国家只好用行政命令或其他手段进行调节。宣德中，因赴北京中盐的人少，规定召商纳中之盐“以十分为率，六分支与纳米京仓者，四分支与辽东、永平、山海、大同、宣府、万全已纳米者，他处中纳悉停之”。对于甘肃、宁夏、大同、宣府、独石、永平等道路险远、商人不乐赴中的地方，甚至允许“寓居官员及军余有粮之家纳米豆中盐”。
　 #### 解决守支问题的策略 1. 出钞给商，冲消盐引。如成化十六年（1480）：
&gt;
“令永乐、宣德、正统年间客商所中引盐、全未支者、各造册送部。於原籍有司关给资本钞。每引三十锭。景泰元年以後、未支引盐、愿关资本钞者、听。愿守支兑换者、两淮、兑福建山东。两浙、兑广东。俱每引加半引不愿者、听照旧守支”。</p>
<pre><code>`注：听，顺从，接受别人的意见。`</code></pre>
<ol start="2" type="1">
<li><p>对积欠时间不太长的盐引，给以加额的优惠，动员商人转场支盐，或兼场支盐。</p>
<blockquote>
<p>正统三年定，“客商中纳官盐支给不敷者，令两淮运司、云南提举司于河东、陕西、福建、广东各运司、提举司兑支。河间、长芦及河东、陕西运司于广东、海北盐课司兑支”。八年奏准，“永乐、洪熙、宣德年间客商原中淮、浙、长芦运司引盐愿兑支河东、山东、福建运司者
，每支一引支与二引 ，不愿者听其守支”。</p>
</blockquote></li>
<li><p>收买灶户余盐以充正引，供开中。</p>
<p>余盐就是指明代在官专卖制度下，政府为了管制盐的生产，建立了灶户制度，以特定的人户世代世袭制盐。官支给工本与生产手段，免除杂役，使灶户得尽力制造定额的盐课，以维持各场的产量。灶户生产的盐有一部分以盐课形式交给政府，称为正盐，一部分以从事正盐生产以外剩余劳动所生产的盐。此外，还将灶户应向国家交纳粮、草等科差也折以余盐交纳。灶户除了办盐外，也经营一些土地，这些土地的科差，通常是以粮草交纳的。这时为了增加边盐额，就把这些粮草也折为盐上纳，不分起运存留，每正粮米麦豆五斗，草五包束，各纳正盐一小引。
&gt; 盐课以引为单位，每引400斤，称大引，后改为小引，每引100斤或200斤。
&gt;<br />
&gt; 科差是指征收的代徭税。 &gt; &gt;
起运是指各司、府、州、县等按中央的指派定期定额将赋税运至中央及九边的仓库。
&gt; &gt;
存留：一部分赋税留于地方，用作党规支出。该项钱粮分别储存于司、府、州、县和卫所仓库。</p></li>
<li><p>定常股、存积之制，解决因盐引积滞影响紧急开中之弊。</p>
<p>《明实录》记载： &gt;
（正统五年四月癸巳）行在户部奏：盐商因守支年久，虽减轻开中，少有上纳者，恐误边储。请令云南、福建、四川、广东、河东盐，仍其旧。其两淮、两浙、长芦，每岁盐以十分为率，八分给守支客商，二分令巡按监察御史、按察司官，见数存积，遇边方急用粮日，召商中纳支给，庶官民两便，不致误事。从之。</p>
<p>综合以上《明实录》正统五年这两段记载，可知明朝政府一方面有意识地消化已经发行的两淮盐引，另一方面设立“存积”这种新名目的盐引。“存积”盐引是指政府为应付紧急财政开支而临时发行的债券，其价值由两淮每年食盐供应量的20％来保障，用债券制度的术语来说，这20％的食盐，就是“存积”盐引的抵押品；商人要认中“存积”盐，要付出更多的粮食，但好处是凭“存积”盐引，能够优先支取食盐。其余在非紧急情况下发行的两淮盐引，则被称为“常股”盐引，其价值由两淮每年食盐供应量的80％来保障。商人认中“常股”盐，付出的粮食较少，但坏处是凭“常股”盐引支取食盐的速度比未有“常股”、“存积”名目的时代更慢，因为“常股”盐引的持有者将不断被“存积”盐引的持有者抢先插队。于是“存积”盐引成为两淮盐引债券市场的新宠，《明史·食货志》提供了证据，“凡中常股者价轻，中存积者价重，然人甚苦守支，争趋存积，而常股壅矣”。</p></li>
</ol>
<h4 id="推行纲法来消化积压的盐引">推行纲法来消化积压的盐引</h4>
<p>在1617年纲法成立前夕，两淮盐政陷入困局。万历年间，两淮每年必须兑换90万张盐引，其中淮南盐引占68万张，淮北盐引占22万张，因此为户部太仓库带来60万两的余盐银。但是，由于政府发行盐引、征收盐税后，不能及时用盐来兑换已经发行的盐引(时称旧引)，以至于积压了约250—260万张两淮盐引。假如政府把两淮所有的盐来兑换这批旧引，以两淮每年兑换约90万张的速度计算，约三年就可以全部兑换，但政府从两淮征收的盐税，也将停收三年，仅对户部的财政损失就达180万两:而北部边防军因连续三年无商人运送粮草所造成的损失尚未计算在内。</p>
<p>万历四十五年（1617），负责整顿盐政的袁世振开始推行“纲法”来消化积压的盐引。袁世振的纲法，是将在1617年之前持淮南盐引的内商，组成十纲;持淮北盐引的内商，组成十四纲。每年，淮南十纲中，以一纲兑换历年旧引，其余九纲兑换当年新引;淮北十四纲中，也同样以一纲兑换历年旧引，其余十三纲兑换当年新引。这样，政府就可以不大幅增加盐产，而又能够继续征收盐税，并且逐渐兑换旧引。当时，淮南十纲，每年共兑换48万张新引和20万张旧引;淮北十四纲，每年共兑换15万张新引和7万张旧引，合共仍然维持两淮每年兑换90万张盐引的定额。为使盐商接受这个方案，袁世振答应:凡愿意参与纲法的盐商，名字登记在纲册上，给予永久专卖权(永永百年，据为窝本)，成为纲商。在纲册无名者要参与盐业，也必须寄在纲册有名者的名下。</p>
<p>其后，官不收盐，令盐户将应纳课额，按引缴银，谓之“仓盐折价”。官府卖引，由商人自行赴场收运，政府将食盐收买运销之权悉归商人。</p>
<h2 id="二清代">二、清代</h2>
<p>清初为了笼络人心，免除各种盐税附加，推行纲法，也叫引岸制，是一种官督商销的形式，由政府给引票于商人，按引购盐，贩卖到特定区域（引地）。同时还实行官运官销，即政府运盐到栈，自行买卖，寓税于价；官运商销，即盐场生产出来的盐，由政府统一收购，储运于官设的盐栈，由商人购买运销，盐课含于价内或于购运时交纳；一些偏僻的产盐地区，还允许民间自制自用，政府征收盐税。</p>
<p>　清初沿袭了明代的盐法。盐商运销食盐，须先向盐运司交纳盐课，领取盐引，然后到指定的产盐区向灶户买盐，再贩往指定的行盐区（叫做“引岸”）销售。然而盐引并不能随便领取，商人必须以引窝为据，证明自己拥有运销食盐特权。为了得到引窝，商人又必须事先“认窝”，也就是交纳巨额银两取得官府授予的垄断经营权。</p>
<p>　在盐法的实际运行过程中，盐商的角色发生了分裂，出现了窝商、运商、场商、总商等名目，他们在食盐的流通过程中各有不同的职能。窝商，也叫业商。清初本来没有窝商、运商之分，凡是有引窝的盐商都是自己运销食盐。之后，因为一些有引窝的盐商缺乏资本无力贩运，就将引窝租给无窝的商人经营，于是便有了窝商、运商之分。</p>
<p>　窝商自己不经营盐业，而是纯粹靠出租引窝坐收巨利，是盐业垄断性的最突出的表现。运商，也叫租商。运商想要贩卖食盐，必须先向窝商缴付“窝价”，租取引窝，然后到盐运司衙门纳课领引，他们在食盐的流通过程中起着产地与销售地之间的桥梁作用。场商，是在指定的盐场向灶户收购食盐再转卖给运商的商人。他们攫取了收购盐场全部产盐的特权，所以往往采取不等价交换的手段，残酷剥削生产者。</p>
<p>　明清时期的盐法采取这种“纲商引岸”制，背后有种种复杂的原因，但是最直接的原因在于明清时期的国家没有太多的力量直接控制社会经济，所以倾向于采取“包”的形式，抓住实力雄厚之人，责成他们承包到底。这一点，在总商的设置上表现得特别明显。总商，又名商总，是运商中家道殷实、资本雄厚的人，盐运司衙门指定他们为总商，把散商分隶于他们名下。每年征课办引的时候，总商要监督完成，还要负责查禁私盐，朝廷如有盐政方面的举措，也往往要与总商协商。</p>
<p>　除垄断经营权之外，朝廷还给盐商以很多其他优惠条件。如允许他们“加价”（提高官定售盐价格）、“加耗”（增加每引的斤数）以及“借帑”（即从国库里借钱营运）。有了这样的保证，盐商可以说是坐收暴利。</p>
<p>　在盐的收购、运输与销售各个环节，相关官员无不伸出贪婪的手</p>
<p>　盐商虽然手握垄断经营权，可以牟取暴利，但是朝廷和官府并不是白给他们这些好处，而是指着他们增加财政收入，因此，他们的负担也很沉重。按照道光年间的两江总督兼两淮盐政陶澍的说法：清朝初年，两淮盐区（行销的地方包括今天的河南、江苏、江西、安徽、湖北、湖南六省）的正纲盐课银原有90余万两，加上其他杂款，也只有180余万两。但是到了乾隆年间，这个数字已经达到400余万两银，是原额的好几倍。而到了嘉庆二十年（1815）之后，两淮盐区每年需要交纳的款项竟然达到800余万两之多。</p>
<p>　盐商的负担还不止于行盐纳课，他们还要承受官员的额外盘剥。朝廷为了加强对盐课的征收，设置了各种机构和官员，这些官员除了领取俸禄之外，还有一笔丰厚的养廉银，目的就是为了避免他们的贪污腐败行为。但是，他们仍然把盐商视为圈里的猪羊任意宰割，明勒暗扣，无止无休。</p>
<p>　在盐的收购、运输与销售各个环节，相关官员无不伸出贪婪的手，雁过拔毛。道光朝的包世臣说：“淮商办运，纳请引、呈纲、力听钱粮，在运司一衙门，设收支、广盈、架阁、承发四房，出入各五、六次，遍历经、库、知、巡四首领，皆商厮名走司者主之，故商命每悬走司之手。然后转历分司、场员、坝员、监掣、批验、子盐各衙门，然后盐得上船赴岸。凡经一署，投一房，则有一次费。合计所费，殆浮正杂，而迂曲备至。”可见盐政衙门内部机构复杂，官员们层层盘剥，商人自有其苦衷。</p>
<p>　当时有人指出，在所有需要与官府打交道的事情里，没有比盐商办盐更艰难繁重的了。合计下来，商人暗里支出的费用几乎相当于成本的一半。雍正时期，皇帝厉行改革，把很多陋规都进行透明化处理，确定下来，免得官员浮收。两淮盐区规定盐商要以“公务”的名义送给盐政每年8万两白银，以“薪水”的名义送给盐运司每年4万两白银。</p>
<p>　此外，每逢盐运使有离任或外调的，盐商也都要照例馈赠一笔重金。盐官的收入如此丰厚，难怪大家都抢着要做。如巡盐御史一职，初时只有六品，却是人人艳羡的肥差，而且一般还轮不到别人，只能由相当于皇帝家奴的“内务府”官员担任。康熙朝时，内务府官员李煦长期担任两淮盐政，离任时他还恋恋不舍，一再上奏皇帝，请求再留一任。</p>
<p>　需要指出的是，皇帝虽然屡次下旨严禁官员贪污腐败，但是实际上他们自己加给盐商的摊派是最大的。乾隆皇帝前后6次南巡，他口头上虽然说“一切出自内府，无烦有司供亿”，但是主要花费的都是长芦、两淮盐商的钱。盐商们争先恐后，各出奇招，以博皇帝的欢心，用度无算。</p>
<p>　乾隆年间爆发的两淮盐引案，亏空达1000多万两，其中就包括“备办南巡出差银”。不仅如此，康乾以来，朝廷每次遇到重大军需、庆典、赈务、工程，需要花钱的时候，盐商们都得踊跃捐输，多则数百万，少则数十万。乾嘉年间，各地盐商报效捐输军需就达白银3000万两之多，其中两淮盐商为支持朝廷镇压川楚白莲教起义，从嘉庆四年（1799）到八年的短短4年之间连续6次捐输，共计白银550万两。</p>
<p>　盐商引领奢侈生活方式，据说远在北京的西太后梳头时也要模仿扬州的妓女</p>
<p>　盐商基本上垄断了全国的食盐销售，因此他们可以任意压低买价，抬高卖价，获取巨额利润。但是，由于传统经济与政治等方面的原因，他们倾向于用赚来的钱购买土地或者捐纳官职，而不是扩大再生产。此外他们会把大量的钱投入奢侈的生活消费中，其中尤以居住在扬州的两淮盐商为甚。</p>
<p>　扬州是两淮盐运司衙门所在地，盐商多聚集于此。据《清稗类钞》记载，黄均太是当时两淮八大商总之首。他吃一碗蛋炒饭需要耗银50两。之所以这么贵，是因为这碗蛋炒饭要保证每粒米都是完整，且必须粒粒分开，每粒米都要泡透蛋汁，炒出来外面金黄的，内心雪白。与这碗饭相配的是百鱼汤，汤里包括鲫鱼舌、鲢鱼脑、鲤鱼白、斑鱼肝、黄鱼膘、鲨鱼翅、鳖鱼裙、鳝鱼血、鳊鱼划水、乌鱼片，等等，极尽精致之能事。更令人咋舌的是，据说他吃的鸡蛋并非一般的鸡下的，而是吃了人参、苍术等药物的鸡下的，所以味道特别好。</p>
<p>　清人李斗的《扬州画舫录》一书是扬州盐商奢靡之风的全面记录，吃喝玩乐就不必说了，据说盐商会想出各种各样的花招来消遣。例如，选美活动搞腻了就选丑，把大姑娘的脸上涂了酱油在太阳底下暴晒，看谁更丑。又如，为了比谁更有钱，大家纷纷在金箔上刻上自己的名字，跑到镇江金山的宝塔上把金箔往外扔，看谁的金箔第一个飘到扬州。</p>
<p>　盐商过着非常悠闲的生活，他们修建楼台馆榭，养戏班开戏院，琢磨精致的菜肴，逛妓院养“瘦马”，调脂弄粉。盐商的生活方式深刻地影响了扬州的社会风气，当时市面上游逛着大量闲人，他们不事生产，无所事事，“早上皮包水，晚上水包皮”，在茶馆和澡堂之间流连。扬州盐商的生活方式还具有领导时尚的作用，据说远在北京的西太后梳头时也要模仿扬州的妓女，否则就嫌不够新潮。</p>
<p>　两淮盐商的豪奢，不仅是为了满足自己的欲望，在某种程度上，它也是服务于拉拢贿赂官员的需要的。盐商尽管不满于各级官员的巧取豪夺，但他们又需要这些官员的庇护，因此他们往往要竭力备办令官员满意的物品。</p>
<p>　两淮盐政高恒出身内务府，是真正的纨绔子弟，盐政事务完全不在心上，只知道聚敛财物。盐商针对其好色贪财的特点，物色美女，搜集珍玩，馈赠于他，结果正中下怀，高恒甚至可以答应将以往的亏空一笔勾销。</p>
<p>　两淮盐运使卢见曾是位名士，风流自赏，对于黄白之物只觉得俗不可耐。盐商投其所好，花重金购买善本图书碑帖献上。卢见曾感觉这个贿赂很不俗，就欣然笑纳，之后还不断收受，乐此不疲。总之，两淮盐商用心揣摩官员的爱好，又用自己的生活方式感染官员，使他们“入吾彀中”，豪奢风气下掩盖的是官员的贪污腐败和官商的勾结共谋。</p>
<p>　破除垄断的新制度逐渐取代了旧制度，盐商的风光不再，没落已成定局</p>
<p>　清中期以后，盐商报效捐的压力渐渐增大，又要品尝“借帑还息”的苦果，加上官吏勒索，自己生活豪奢，很多人都陷入外强中干，入不敷出的境地。为了克服危机，他们只有不断抬高盐价一条路，以致于民间出现了百姓被迫淡食的局面，民怨沸腾。而私盐则趁机大行其道，几乎占据了官盐一半的市场。</p>
<p>　官盐发生严重滞销，商人开始欠缴盐课，直接影响了朝廷的财政收入。为了增加盐课收入，清廷决心对盐法进行改革。道光十二年（1832）两江总督陶澍议准将两淮盐务改归两江总督兼管，以统一事权。之后，他大刀阔斧地将淮北引盐为票盐，也就是在那些交通不便、引商不肯前往的地方，允许资本较小的商人经营，他们不必认窝，只要缴纳盐课就给据官票，让他们凭票贩盐。陶澍的这一举措很快收到了实效，既方便了百姓，也增加了朝廷收入。道光三十年，两江总督陆建瀛又将此法推行于淮南。以后，票盐法渐渐向福建、两浙、长芦等盐区推进。</p>
<p>　纲法改为票法，从根本上取消了盐商对盐业的垄断，深刻地触犯了盐商的既得利益，引起他们的强烈不满。据说，当时的盐商对陶澍恨之入骨，设计了一种新的纸牌规则。他们增加了两张新牌，一张是“桃树”，拿到这张牌的人“虽全胜亦全负”，所以一旦拈到此牌无不痛骂。另一张是“陶小姐”，暗喻陶澍的女儿，“得之者虽全负亦全胜”，所以拿到这张牌的人无不欢喜雀跃，并且“浪语谑词，猥亵无比”。但是，无论如何痛恨，新制度逐渐取代了旧制度，盐商的风光不再，没落已成定局。</p>
<p>　纵观清代盐商的盛衰过程，可以看到，他们的垄断经营权同时也是官府牟利的工具，这正是他们悲剧命运的深刻原因。</p>
<p>　（作者系中国政法大学法律古籍所副教授）</p>
<p>　资料链接</p>
<p>　盐引：又称“盐钞”，是宋代的取盐凭证，“引”是指有价证券，可以作为“代币”流通。明朝时期，如果想要合法贩盐，商人必须先向政府取得“盐引”。每引一号，分前后两卷，盖印后从中间分成两份，后卷给商人的，叫“引纸”——盐引；前卷存根叫“引根”。商人凭盐引到盐场支盐，又到指定销盐区卖盐。</p>
<p>　两淮盐引案：乾隆三十三年（1768），新任“盐政”查账，发现在他之前的20年里，“盐政”的官吏们私自“超发”盐引，从中克扣、提留“引银”竟达1000多万两。乾隆大怒，许多官吏和徽州大盐商都被抓捕至北京问罪，其中包括纪晓岚等知名“要员”（纪因此受到牵连，而被发配新疆）。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/59/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/59/">59</a><span class="page-number current">60</span><a class="page-number" href="/page/61/">61</a><span class="space">&hellip;</span><a class="page-number" href="/page/63/">63</a><a class="extend next" rel="next" href="/page/61/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Louyan</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">625</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2649</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Louyan</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
